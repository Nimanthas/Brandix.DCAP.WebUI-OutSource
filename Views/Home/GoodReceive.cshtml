@{
    Layout = "_Layout";
}

<script type="text/javascript">
    var selectedDate = null;
    var fromdatePicker = null;
    var todatePicker = null;
    var scheduleObject = null;
    var operationList = null;
    var todayDate = null;
    var scrapItems = [];
    var SoberSheetMode = false;
    var SSheetSCHNo = null;
    var SSheetSCHId = null;
    var SSAlreadySaved = false;

    //views
    var createNewTag = null;
    var addShedulesGrid = null;
    var isvalidbarcode = false;
    var sacanComplete = false;

    var errorbeforestauscomplete = null;
    var scannedBarcode = null;
    var previousSelectedLoc = null;

    var locationSummaryWindow = null;
    var locationWiseBagSummaryWindow = null;

    var resetedBackupLocation = null;
    var dispatchSummaryWindow = null;

    var isValidClient = null;
    var clientconfig = null;
    var userPermissionList = null;
    var clientIP = null;

    var sheduleHighlightBackupData = [];

    var pickinglist = null;
    var addShedulesGrid = null;
    var checkedIds = {};
    var printpdfwindow = null;
    var bgColour = null;

    getSessionInfo();

    $(document).ready(function () {
        $('#sitebody').removeClass('body-login');
        $("#sitebody").append(
            '<div id="ajaxBusy" class="ajaxBusy"></div>'
        );
        $("#ajaxBusy").hide();
        checkLoginStatus();
        $('#pageTitleBar').html('<i class="fas fa-barcode pageMainIcon"></i><span class="pageTitle">DCap - Receiving Goods</span>');

        initializeControls();
        initializeFunctionKeys();
        renderLocations();

        checkIdle();

        if (isValidClient == Answer.Null) {
            window.location.href = "Login";
        }
        else if (isValidClient != null && clientconfig.dataCaptureMode != DataCaptureMode.Bulk) {
            if (clientconfig.dataCaptureMode == DataCaptureMode.Barcode) {
                msgBox.show('මෙම යන්ත්‍රයට බල්ක් අප්ඩේට් කිරීම සඳහා අවසර නැත.', 'This device is not authorized for Bulk update', 'අවවාදයයි / Warning', 'BU01', 'Warning', function () {
                    if (clientconfig.dataCaptureMode == DataCaptureMode.Barcode) {
                        window.location.href = "Menu";
                    }
                });
            }
        }

        $("#scanBagBarodeSearch").focus();
        $("#scanBagBarodeSearch").select();
    });
    
    function resetControllers() {
        $("#btnSearch").attr('disabled', 'disabled');
        $("#btnSearch").attr('disabled', 'disabled');
        $("#btnSearch").attr('disabled', 'disabled');
    }

    function getSessionInfo() {
        isValidClient = sessionStorage.getItem("IsValidClient");
        clientconfig = JSON.parse(sessionStorage.getItem("Clientconfig"));
        console.log(clientconfig);
        userPermissionList = JSON.parse(sessionStorage.getItem("UserPermissionList"));
        clientIP = sessionStorage.getItem("ClientIP");
    }

    function checkLoginStatus() {
        if (sessionStorage.getItem("UserId") != "") {
            $("#toolBarLoggedinUser").html(sessionStorage.getItem("UserId"));
        } else {
            $("#toolBarLoggedinUser").html("");
        }
        if (sessionStorage.getItem("IsSignedIn") == Answer.Null || sessionStorage.getItem("IsSignedIn") == Answer.No) {
            $("#loginBar").hide();
            window.location.href = "Login";
        } else {
            $("#loginBar").show();
        }
    }

    function initializeFunctionKeys() {
        shortcut.add("F5", function () {
            confirmSuccess();
        });

        shortcut.add("F8", function () {
            openpickinglist();
        });
    }

    function initializeControls() {
        
        $("#scanBagBarodeSearch").keydown(function (e) {
            if (e.keyCode == 13) {
                searchBarcode();
            }
        });

        //Main Table: START
        console.log(clientconfig);
         $.ajax({
            url: '@ViewBag.APIURL/Lookup/GetLocaionsByUserFactory?faccode=' + clientconfig.facCode,
            type: 'GET',
            dataType: 'json',
            async: false,
            contentType: 'application/json',
            beforeSend: function () {
                $("#ajaxBusy").show();
            },
            complete: function () {
                $("#ajaxBusy").hide();
            },
            success: function (response) {
                $("#unloading-location").kendoDropDownList({"dataSource": response,filter: "contains","dataTextField": "warLocName","dataValueField": "warLocCode","optionLabel": "Select a Warehouse Location..."});
            },
            error: function (jqXHR, textStatus, errorThrown) {
                formatErrorMessage(jqXHR, errorThrown, "Dispatch");
            }
        });

        $("#bag-items-grid").kendoGrid({
            toolbar: ["pdf", "excel"],
            pdf: {
                allPages: true,
                author: JSON.parse(sessionStorage.getItem("Clientconfig")).clientId,
                creator: JSON.parse(sessionStorage.getItem("Clientconfig")).clientId,
                date: (new Date()).toLocaleDateString('en-US', { month: '2-digit', day: '2-digit', year: 'numeric'}),
                fileName: "rejected items summary"
            },
            excel: {
                allPages: true,
                fileName: "dispatch-items.xlsx",
                filterable: true
            },
            dataSource: {
                schema: {
                    model: {
                        id: "BagBarcode",
                        fields: {
                            Key: { type: "string", editable: false },
                            Seq: { type: "number", editable: false },
                            BagBarcode: { type: "string", editable: false },
                            TxnMode: { type: "number", editable: false },
                            ControlId: { type: "string", editable: false },
                            TxnStatus: { type: "number", editable: false },
                            L1id: { type: "number", editable: false },
                            Style: { type: "string", editable: false },
                            L2id: { type: "number", editable: false },
                            Shedule: { type: "string", editable: false },
                            PO: { type: "string", editable: false },
                            ZFeature: { type: "string", editable: false },
                            L4id: { type: "number", editable: false },
                            Color: { type: "string", editable: false },
                            Quantity: { type: "number", editable: false },
                            Action: { type: "string", editable: false },
                        },
                    }
                },
                batch: true,
                group: {
                        field: "ControlId", aggregates: [
                            { field: "Style", aggregate: "count" },
                            { field: "Quantity", aggregate: "sum"},
                            { field: "ControlId", aggregate: "count" }
                        ]
                    },
                aggregate: [ { field: "Style", aggregate: "count" },
                             { field: "Quantity", aggregate: "sum" },
                             { field: "ControlId", aggregate: "min" },
                             { field: "ControlId", aggregate: "max" }]
            },
            scrollable: true,      
            sortable: true,
            filterable: true,
            columns:[
                        {field:"Key",width:"0px", hidden: true },
                        {title:"Seq",field:"Seq",width:"145px",hidden:true},
                        {title:"Bag Barcode",field:"BagBarcode",width:"145px"},
                        {title:"TxnStatus",field:"TxnStatus",width:"145px",hidden:true},
                        {title:"Dispatch ID",field:"ControlId",width:"145px",hidden:true},
                        {title:"TxnMode",field:"TxnMode",width:"145px",hidden:true},
                        {title:"L1id",field:"L1id",width:"145px",hidden:true},
                        {title:"Style",field:"Style",width:"125px"},
                        {title:"L2id",field:"L2id",width:"145px",hidden:true},
                        {title:"Shedule",field:"Shedule",width:"125px"},
                        {title:"PO",field:"PO",width:"125px"},
                        {title:"Z-Feature",field:"ZFeature",width:"145px"},
                        {title:"L4id",field:"L4id",width:"145px",hidden:true},
                        {title:"Color",field:"Color",width:"155px", footerTemplate: "Total", groupFooterTemplate: "Sub Total"},
                        {title:"Quantity",field:"Quantity",width:"105px", aggregates: ["sum"], groupFooterTemplate: "#=sum#", footerTemplate: "#=sum#"}
                    ],
        });
        //Main Table: END

        //Location summary table
        $("#expand-location-summary-grid").kendoGrid({
            toolbar: ["pdf", "excel"],
            pdf: {
                allPages: true,
                author: JSON.parse(sessionStorage.getItem("Clientconfig")).clientId,
                creator: JSON.parse(sessionStorage.getItem("Clientconfig")).clientId,
                date: (new Date()).toLocaleDateString('en-US', { month: '2-digit', day: '2-digit', year: 'numeric'}),
                fileName: "location summary"
            },
            excel: {
                allPages: true,
                fileName: "location summary.xlsx",
                filterable: true
            },
            dataSource: {
                schema: {
                    model: {
                        id: "bag_Barcode",
                        fields: {
                            Key: { type: "string", editable: false },
                            ProductionWarehouse: { type: "string", editable: false },
                            Bag_Barcode: { type: "string", editable: false },
                            Mode: { type: "string", editable: false },
                            Style: { type: "string", editable: false },
                            Shedule: { type: "string", editable: false },
                            Color: { type: "string", editable: false },
                            Size: { type: "string", editable: false },
                            Quantity: { type: "number", editable: true },
                            ModifiedDateTime: { type: "date", editable: true },
                            ModifiedTime: { type: "string", editable: true },
                        },
                    }
                },
                batch: true,
                group: {
                        field: "Key", aggregates: [
                            { field: "Style", aggregate: "count" },
                            { field: "Quantity", aggregate: "sum"},
                            { field: "Key", aggregate: "count" }
                        ]
                    },
                aggregate: [ { field: "Style", aggregate: "count" },
                             { field: "Quantity", aggregate: "sum" },
                             { field: "Key", aggregate: "min" },
                             { field: "Key", aggregate: "max" }]
            },
            navigatable: true,
            scrollable: true,
            persistSelection: true,        
            sortable: true,
            filterable: {mode: "row"},
            resizable: true,
            editable: true,
            columns: [
                { field:"Key", width:"5px", hidden: true },
                { field: "ProductionWarehouse", title: "Factory", width: "40px", editable: false },
                { field: "Bag_Barcode", title: "Barcode", width: "50px", editable: false },
                { field: "Mode", title: "Mode", width: "35px", editable: false, template: "#if (Mode == '1' ) {# <div>Bag" + 
                        "</div> #} else if (Mode == '2'){ # <div>Travel Tag" +
                        "</div> #} else if (Mode == '3'){ # <div>Buddy Tag" +
                        "</div> #}#"  },
                { field: "Style", title: "Style", width: "45px", editable: false },
                { field: "Shedule", title: "Shedule", width: "40px", editable: false },
                { field: "Color", title: "Color", width: "50px", editable: false, groupFooterTemplate: "Sub Total", footerTemplate: "Total" },
                { field: "Size", title: "Size", width: "40px", editable: false, hidden: true },
                { field: "Quantity", title: "Qty", width: "35px", editable: false, aggregates: ["sum"], groupFooterTemplate: "#=sum#", footerTemplate: "#=sum#", filterable: false },
                { field: "ModifiedDateTime", title: "Received date", width: "30px", editable: false, filterable: false  },
                { field: "ModifiedTime", title: "Received time", width: "25px", editable: false, filterable: false }
            ],
            editable: "inline"
        });

        //Location wise bag summary table
        $("#expand-location-wise-bag-summary-grid").kendoGrid({
            toolbar: ["pdf", "excel"],
            pdf: {
                allPages: true,
                author: JSON.parse(sessionStorage.getItem("Clientconfig")).clientId,
                creator: JSON.parse(sessionStorage.getItem("Clientconfig")).clientId,
                date: (new Date()).toLocaleDateString('en-US', { month: '2-digit', day: '2-digit', year: 'numeric'}),
                fileName: "location wise bag summary"
            },
            excel: {
                allPages: true,
                fileName: "location wise bag summary.xlsx",
                filterable: {mode: "row"},
            },
            dataSource: {
                schema: {
                    model: {
                        id: "bag_Barcode",
                        fields: {
                            Key: { type: "string", editable: false },
                            ProductionWarehouse: { type: "string", editable: false },
                            Location: { type: "string", editable: false },
                            Bag_Barcode: { type: "string", editable: false },
                            Mode: { type: "string", editable: false },
                            Style: { type: "string", editable: false },
                            Shedule: { type: "string", editable: false },
                            Color: { type: "string", editable: false },
                            Size: { type: "string", editable: false },
                            Quantity: { type: "number", editable: true },
                            ModifiedDateTime: { type: "date", editable: true },
                            ModifiedTime: { type: "string", editable: true },
                        },
                    }
                },
                batch: true,
                group: {
                        field: "Key", aggregates: [
                            { field: "Location", aggregate: "count" },
                            { field: "Style", aggregate: "count" },
                            { field: "Quantity", aggregate: "sum"},
                            { field: "Key", aggregate: "count" }
                        ]
                    },
                aggregate: [ { field: "Style", aggregate: "count" },
                             { field: "Quantity", aggregate: "sum" },
                             { field: "Key", aggregate: "min" },
                             { field: "Key", aggregate: "max" }]
            },
            navigatable: true,
            scrollable: true,
            persistSelection: true,        
            sortable: true,
            filterable: {mode: "row"},
            resizable: true,
            editable: true,
            columns: [
                { field:"Key", width:"5px", hidden: true },
                { field: "ProductionWarehouse", title: "Factory", width: "40px", editable: false },
                { field: "Location", title: "Location", width: "30px", editable: false },
                { field: "Bag_Barcode", title: "Barcode", width: "50px", editable: false },
                { field: "Mode", title: "Mode", width: "35px", editable: false, template: "#if (Mode == '1' ) {# <div>Bag" + 
                        "</div> #} else if (Mode == '2'){ # <div>Travel Tag" +
                        "</div> #} else if (Mode == '3'){ # <div>Buddy Tag" +
                        "</div> #}#"  },
                { field: "Style", title: "Style", width: "45px", editable: false },
                { field: "Shedule", title: "Shedule", width: "40px", editable: false },
                { field: "Color", title: "Color", width: "50px", editable: false, groupFooterTemplate: "Sub Total", footerTemplate: "Total" },
                { field: "Size", title: "Size", width: "40px", editable: false, hidden: true },
                { field: "Quantity", title: "Qty", width: "35px", editable: false, aggregates: ["sum"], groupFooterTemplate: "#=sum#", footerTemplate: "#=sum#", filterable: false },
                { field: "ModifiedDateTime", title: "Received date", width: "30px", editable: false, filterable: false  },
                { field: "ModifiedTime", title: "Received time", width: "25px", editable: false, filterable: false }
            ],
            editable: "inline"
        });

        $("#expand-dispatch-wise-bag-summary-grid").kendoGrid({
            toolbar: ["pdf", "excel"],
            pdf: {
                allPages: true,
                author: JSON.parse(sessionStorage.getItem("Clientconfig")).clientId,
                creator: JSON.parse(sessionStorage.getItem("Clientconfig")).clientId,
                date: (new Date()).toLocaleDateString('en-US', { month: '2-digit', day: '2-digit', year: 'numeric'}),
                fileName: "dispatch bag summary"
            },
            excel: {
                allPages: true,
                fileName: "dispatch bag summary.xlsx",
                filterable: {mode: "row"},
            },
            dataSource: {
                schema: {
                    model: {
                        id: "bag_Barcode",
                        fields: {
                            Key: { type: "string", editable: false },
                            Location: { type: "string", editable: false },
                            Bag_Barcode: { type: "string", editable: false },
                            Mode: { type: "string", editable: false },
                            Style: { type: "string", editable: false },
                            PO: { type: "string", editable: false },
                            Z_Feature: { type: "string", editable: false },
                            Color: { type: "string", editable: false },
                            Status: { type: "string", editable: false },
                            Quantity: { type: "number", editable: true },
                        },
                    }
                },
                batch: true,
                group: {
                        field: "Key", aggregates: [
                            { field: "Location", aggregate: "count" },
                            { field: "Style", aggregate: "count" },
                            { field: "Quantity", aggregate: "sum"},
                            { field: "Key", aggregate: "count" }
                        ]
                    },
                aggregate: [ { field: "Style", aggregate: "count" },
                             { field: "Quantity", aggregate: "sum" },
                             { field: "Key", aggregate: "min" },
                             { field: "Key", aggregate: "max" }]
            },
            navigatable: true,
            scrollable: true,
            persistSelection: true,        
            sortable: true,
            filterable: {mode: "row"},
            resizable: true,
            editable: true,
            columns: [
                { field:"Key", width:"0px", hidden: true },
                { field: "Location", title: "Location", width: "100px", editable: false },
                { field: "Bag_Barcode", title: "Barcode", width: "100px", editable: false },
                { field: "Mode", title: "Mode", width: "50px", editable: false, template: "#if (Mode == '1' ) {# <div>Bag" + 
                        "</div> #} else if (Mode == '2'){ # <div>Travel Tag" +
                        "</div> #} else if (Mode == '3'){ # <div>Buddy Tag" +
                        "</div> #}#"  },
                { field: "Style", title: "Style", width: "100px", editable: false },
                { field: "Shedule", title: "Shedule", width: "100px", editable: false },
                { field: "PO", title: "PO", width: "100px", editable: false },
                { field: "Z_Feature", title: "Z-Feature", width: "100px", editable: false },
                { field: "Color", title: "Color", width: "100px", editable: false, groupFooterTemplate: "Sub Total", footerTemplate: "Total" },
                { title:"Status",field:"Status",width:"150px", filterable: false, template: "#if (Status == '1' ) {# <div class='mb-2 mr-2 badge badge-primary const-width-badge' style='width: 90%; height: 22px; font-size: 18px;'>Pending Approval" + 
                        "</div> #} else if (Status == '2'){ # <div class='mb-2 mr-2 badge badge-secondary const-width-badge' style='width: 90%; height: 22px; font-size: 18px;'>Approved - Not Send" +
                        "</div> #} else if (Status == '3'){ # <div class='mb-2 mr-2 badge badge-success const-width-badge' style='width: 90%; height: 22px; font-size: 18px;'>Security Passed" +
                        "</div> #} else if (Status == '4'){ # <div class='mb-2 mr-2 badge badge-info const-width-badge' style='width: 90%; height: 22px; font-size: 18px;'>Security Recevied" +
                        "</div> #} else if (Status == '5'){ # <div class='mb-2 mr-2 badge badge-warning const-width-badge' style='width: 90%; height: 22px; font-size: 18px;'>Closed" +
                        "</div> #}#" },
                { field: "Quantity", title: "Qty", width: "50px", editable: false, aggregates: ["sum"], groupFooterTemplate: "#=sum#", footerTemplate: "#=sum#"}
            ],
            editable: "inline"
        });

        $("#subViewLoc").kendoDropDownList({dataSource:[{"Text":"Without Size","Value":"1"},
                                                    {"Text":"With Size","Value":"2"}],
                                                    "dataTextField":"Text","dataValueField":"Value"});
    }

    function searchBarcode() {
        
        $("#styleDataLabel").html('');
        $("#poDataLabel").html('');
        $("#cutLetterLabel").html('');
        $("#sheduleDataLabel").html('');
        $("#colorDataLabel").html('');
        $("#quantityDataLabel").html('');

        $('#control-id').html('');
        $("#control-id-text").val('');

        scannedBarcode = null;
        resetedBackupLocation = null;
        
        if($("#scanBagBarodeSearch").val() == undefined || $("#scanBagBarodeSearch").val() == "" ) {
            msgBox.show('ස්කෑන් තීරු කේත දෝෂයකි.', 'Scan barcode error.' , 'Warning', 'BU05', 'Warning', null);
        } else {
            var gridData = [];
            $.ajax({
                    url: '@ViewBag.APIURL/Lookup/GetGroupBarcodeDetailsbyGroupBarcode?barcode=' + $("#scanBagBarodeSearch").val() + '&faccode=' + clientconfig.facCode,
                    type: 'GET',
                    dataType: 'json',
                    async: false,
                    contentType: 'application/json',
                    beforeSend: function () {
                        $("#ajaxBusy").show();
                    },
                    complete: function () {
                        $("#ajaxBusy").hide();
                    },  
                    success: function (data) {
                        //console.log(data);
                        if (data.length != 0) {
                            scannedBarcode = data[0];
                            if(scannedBarcode.txnStatus == 5) {
                                msgBoxConfirm.show('මෙම අයිතමය දැනටමත් ලැබුනු ලෙස සලකුණු කර ඇත. වත්මන් බෑග් තත්ත්වය : Confirmed. ඔබට ස්ථානය වෙනස් කිරීමට අවශ්‍යද ..?',
                                                    'This item is already marked as Recevied. Current Bag Status : Confirmed, Do you want to change the location..?',
                                                    'තහවුරු කරන්න / Confirm',
                                                    'BS24',
                                                    'Confirm',
                                                    function () {
                                                        getandSetLocationofBarcode();

                                                        $('#styleDataLabel').html(scannedBarcode.styleDesc);
                                                        $('#poDataLabel').html(scannedBarcode.poNo);
                                                        $('#cutLetterLabel').html(scannedBarcode.zfeature);
                                                        $('#sheduleDataLabel').html(scannedBarcode.scheduleDesc);
                                                        $('#colorDataLabel').html(scannedBarcode.colorDesc);
                                                        $('#quantityDataLabel').html(scannedBarcode.qty01);

                                                        $('#control-id').html(scannedBarcode.controlId);
                                                        $("#control-id-text").val(scannedBarcode.controlId);

                                                        resetSheduleLocation(scannedBarcode.styleId, scannedBarcode.scheduleId, scannedBarcode.colorId);
                                                    },
                                                    function () {
                                                        $('#scanBagBarodeSearch').val('');
                                                        $('#scanBagBarodeSearch').select();

                                                        
                                                        $('#styleDataLabel').html(scannedBarcode.styleDesc);
                                                        $('#poDataLabel').html(scannedBarcode.poNo);
                                                        $('#cutLetterLabel').html(scannedBarcode.zfeature);
                                                        $('#sheduleDataLabel').html(scannedBarcode.scheduleDesc);
                                                        $('#colorDataLabel').html(scannedBarcode.colorDesc);
                                                        $('#quantityDataLabel').html(scannedBarcode.qty01);

                                                        $('#control-id').html(scannedBarcode.controlId);
                                                        $("#control-id-text").val(scannedBarcode.controlId);
                                                        return;
                                                    });
                            } else {
                                $('#styleDataLabel').html(scannedBarcode.styleDesc);
                                $('#poDataLabel').html(scannedBarcode.poNo);
                                $('#cutLetterLabel').html(scannedBarcode.zfeature);
                                $('#sheduleDataLabel').html(scannedBarcode.scheduleDesc);
                                $('#colorDataLabel').html(scannedBarcode.colorDesc);
                                $('#quantityDataLabel').html(scannedBarcode.qty01);

                                $('#control-id').html(scannedBarcode.controlId);
                                $("#control-id-text").val(scannedBarcode.controlId);

                                resetSheduleLocation(scannedBarcode.styleId, scannedBarcode.scheduleId, scannedBarcode.colorId);
                            }

                        } else {
                            isValidBarcode = false;
                            msgBox.show('මෙම තීරු කේතය ඔබගේ ස්ථානයේ වලංගු නොවේ.', 'This barcode is not valid at your location.', 'අවවාදයයි / Warning', 'BS12', 'Warning', function () {
                                scannedBarcode = null;
                                $("#scanBagBarodeSearch").val("");
                                $("#scanBagBarodeSearch").focus();
                                errorbeforestauscomplete = errorbeforestauscomplete + ' ' + 'This barcode is not valid.'
                                sacanComplete = false;
                                EnableControllers();
                            });
                        }       
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        formatErrorMessage(jqXHR, errorThrown, "Menu");
                        EnableControllers();
                    }
            });
        }
    }

    function getandSetLocationofBarcode() {
        $.ajax({
            url: '@ViewBag.APIURL/Lookup/GetLocationByBarcode?Barcode=' + scannedBarcode.bagBarCode + '&ControlId=' + scannedBarcode.controlId,
            type: 'GET',
            dataType: 'json',
            async: false,
            contentType: 'application/json',
            beforeSend: function () {
                $("#ajaxBusy").show();
            },
            complete: function () {
                $("#ajaxBusy").hide();
            },  
            success: function (data) {
                //console.log(data.warLocCode);
                resetedBackupLocation = data.warLocCode;
                setLocation(data.warLocCode);
            },
            error: function (jqXHR, textStatus, errorThrown) {
                formatErrorMessage(jqXHR, errorThrown, "Menu");
            }
        });
    }

    function OnGridDataBound(e) {
        var grid = $("#request-grid").data().kendoGrid; 
        var gridData = grid.dataSource.view();

        for (var i = 0; i < gridData.length; i++) {
            var currentUid = gridData[i].uid;
            if (gridData[i].success == true) {
                var currentRow = grid.table.find("tr[data-uid='" + currentUid + "']");
                currentRow.css('background-color', 'lightgreen');
            }
        }

        var grid = e.sender;
        var rows = grid.tbody.find("[role='row']");

        rows.unbind("click");
        rows.on("click", onClick)
    }

    function onClick(e) {
        if ($(e.target).hasClass("k-checkbox-label")) {
            return;
        }
        var row = $(e.target).closest("tr");
        var checkbox = $(row).find(".k-checkbox");

        checkbox.click();
    };

    function confirmSuccess() {
        if (true) {//userPermissionList.some(permission => permission.functionId === AccessibleFunctions.GoodReceive)
            DisableControllers();
            var warloc = $("#location-id").html();
            var dataItem = scannedBarcode
            //console.log(dataItem);
            if(dataItem != null) {
                    if(dataItem.txnStatus >= 4) {
                        if(warloc != "" && warloc != null) {
                                var tableRowData = {
                                            ControlId: dataItem.controlId,
                                            Seq: dataItem.seq,
                                            BagBarCode: dataItem.bagBarCode,
                                            TxnMode: dataItem.txnMode,
                                            StyleId: dataItem.styleId,
                                            ScheduleId: dataItem.scheduleId,
                                            ColorId: dataItem.colorId, 
                                            BagStatus: dataItem.Action == 1 ? 0 : 1,
                                            TxnStatus: dataItem.TxnStatus,
                                            WarLocCode: dataItem.Action == 1 ? "" : warloc,
                                            EnteredBy : JSON.parse(sessionStorage.getItem("Clientconfig")).clientId,
                                }
                                //console.log(tableRowData);

                                if (tableRowData != null) {
                                    var gridData = [];
                                    $.ajax({
                                        url: '@ViewBag.APIURL/BusinessLogics/UpdateDispatchSuccessStatusofBags',
                                        type: 'POST',
                                        dataType: 'json',
                                        async: false,
                                        data: JSON.stringify(tableRowData),
                                        contentType: 'application/json; charset=utf-8',
                                        beforeSend: function () {
                                            $("#ajaxBusy").show();
                                        },
                                        complete: function () {
                                            $("#ajaxBusy").hide();
                                        },
                                        success: function (response) {
                                            EnableControllers();
                                            //console.log(response);
                                            if(response != null){
                                                if(dataItem.txnStatus != 5) {
                                                    var gridData = $("#bag-items-grid").data('kendoGrid').dataSource.data();

                                                        var object = {
                                                            Key: dataItem.controlId,
                                                            Seq: dataItem.seq,
                                                            BagBarcode: dataItem.bagBarCode,
                                                            ControlId: dataItem.controlId,
                                                            TxnStatus: dataItem.txnStatus,
                                                            TxnMode: dataItem.txnMode,
                                                            L1id: dataItem.styleId,
                                                            Style: dataItem.styleDesc,
                                                            L2id: dataItem.scheduleId,
                                                            Shedule: dataItem.scheduleDesc,
                                                            PO: dataItem.poNo,
                                                            ZFeature: dataItem.zfeature,
                                                            L4id: dataItem.colorId,
                                                            Color: dataItem.colorDesc,
                                                            Quantity: dataItem.qty01,
                                                            Action: dataItem.bagStatus,
                                                        }
                                                        gridData.push(object);

                                                    $("#bag-items-grid").data('kendoGrid').dataSource.data(gridData);
                                                }
                                                else 
                                                {
                                                    resetLocationQuantitiy(resetedBackupLocation)
                                                }

                                                resetLocationQuantitiy(response.warLocCode);
                                            }
                                            
                                            resetSheduleLocations();
                                            resettoStart();
                                        },
                                        error: function (jqXHR, textStatus, errorThrown) {
                                            formatErrorMessage(jqXHR, errorThrown, "Menu");
                                            EnableControllers();
                                        }
                                    });
                                }
                        } else {
                            EnableControllers();
                            msgBox.show('තහවුරු කිරීමට පෙර කරුණාකර බෑමේ ස්ථානයක් තෝරන්න.', 'please select a unloading location before confirm.', 'Warning', 'BU05', 'Warning', null);
                        }
                    } else {
                        EnableControllers();
                        msgBox.show('මෙම අයිතමය GRN සඳහා සූදානම් නැත. තත්ත්වය : ' + dataItem.txnStatus, 'This item is not ready to GRN. Status :' + dataItem.txnStatus , 'Warning', 'BU05', 'Warning', null);
                    }
            } else {
                EnableControllers();
                msgBox.show('ඉදිරියට යාමට පෙර කරුණාකර තීරු කේතයක් පරිලෝකනය කරන්න.', 'Please scan a barcode before proceed.' , 'Warning', 'BU05', 'Warning', null);
            }
        } else {
            EnableControllers();
            msgBox.show('භාණ්ඩ ලබා ගැනීමට ඔබට අවසර නැත.', 'You do not have permission to recive goods.' , 'Warning', 'BU05', 'Warning', null);
        }
    }

    function resettoStart(){
        //$("#bag-items-grid").data('kendoGrid').dataSource.data([]);
        $("#scanBagBarodeSearch").val('');
        $("#scanBagBarodeSearch").select();

        $("#styleDataLabel").html('');
        $("#poDataLabel").html('');
        $("#cutLetterLabel").html('');
        $("#sheduleDataLabel").html('');
        $("#colorDataLabel").html('');
        $("#quantityDataLabel").html('');

        $('#control-id').html('');
        $("#control-id-text").val('');

        scannedBarcode = null;
        resetedBackupLocation = null;
    }

    //Fletch Locations
    function renderLocations() {
        //console.log(clientconfig);
        $.ajax({
            url: '@ViewBag.APIURL/Lookup/GetAllLocaionsByUserFactory?faccode=' + clientconfig.facCode,
            type: 'GET',
            dataType: 'json',
            //async: false,
            contentType: 'application/json',
            beforeSend: function () {
                $("#ajaxBusy").show();
            },
            complete: function () {
                //$("#ajaxBusy").hide();
            },  
            success: function (data) {
                //console.log(data);
                if(data.length != 0) { 
                    var grid = ""; 
                    var div = "";
                    $.each(data, function (index, elements) {

                        var table = "";

                        $.each(elements, function (id, attribute) {
                            
                            //console.log('#E30D' + fromPercent(attribute.qty01));

                            table +=    '<tr id= "poCounterNumberDiv">' + 
                                            '<td class="counter-td counter-round invisible-background" style="padding-top: 5px;" id="Locationtd' + attribute.warLocCode + '">' + 
                                                '<button class="location-button box" style="background: ' + colorPicker(attribute.qty01) + ';" type="button" id="LocationBtn' + attribute.warLocCode + '" onClick="setLocation(' + ("'" + attribute.warLocCode + "'") + ')" title="Avilabel Quantity: ' + attribute.qty01 + '">' +
                                                    '<span id="' + (attribute.warLocCode) + '" class="watloc-code-text">' + attribute.warLocCode + '</span>' +
                                                    '<span id="quantitiy' + (attribute.warLocCode) + '" class="watloc-code-text" hidden="hidden">' + attribute.qty01 + '</span>' +
                                                '</button>' +
                                            '</td>' +
                                        '</tr>'
                        });

                        grid +=     
                                    '<td style="width='+ (98/data.length) + '% !important; padding-right: 5px;">' +
                                        '<table style="width: 100%" id="counter' + elements[0].warCode + '">'+
                                            '<tbody>' +
                                                table +
                                            '</tbody>' +
                                        '</table>' +
                                    '</td>'
                                            
                    });

                    div = '<div style="margin-left: 6px; margin-bottom: 6px;">' +
                            '<table style="width: 100% !important">' +
                                '<tbody>' +
                                    '<tr>' +
                                        grid +
                                    '</tr>' +
                                '</tbody>' +
                            '</table>' +
                          '</div>'
                                    
                    
                    $("#location-grid").html(div);
                    $("#ajaxBusy").hide();
                } else {
                    $("#location-grid").html('&nbsp&nbsp&nbspඔබගේ පහසුකමට අදාලව කිසිදු ස්ථානයක් නිර්වචනය කර නොමැත (' + clientconfig.facCode + '). No locations defined for your facility (' + clientconfig.facCode + ')');
                    $("#ajaxBusy").hide();
                }    
            },
            error: function (jqXHR, textStatus, errorThrown) {
                formatErrorMessage(jqXHR, errorThrown, "Menu");
                EnableControllers();
            }
        });
    }

    function resetLocationQuantitiy(LocCode){
        $.ajax({
                url: '@ViewBag.APIURL/Lookup/GetLocaionsByWarLocCode?warLocCode=' + LocCode,
                type: 'GET',
                dataType: 'json',
                async: false,
                contentType: 'application/json',
                beforeSend: function () {
                    $("#ajaxBusy").show();
                },
                complete: function () {
                    $("#ajaxBusy").hide();
                },  
                success: function (data) {
                    //console.log(data);
                    if(data.length != 0) {
                        $.each(data, function (index, preelements) {
                            $.each(preelements, function (index, elements) {
                                var table = "";
                                table += '<button class="location-button" style="background: ' + colorPicker(elements.qty01) + ';" type="button" id="LocationBtn' + elements.warLocCode + '" onClick="setLocation(' + ("'" + elements.warLocCode + "'") + ')" title="Avilabel Quantity: ' + (elements.qty01) + '">' +
                                            '<span id="' + (elements.warLocCode) + '" class="watloc-code-text">' + elements.warLocCode + '</span>' +
                                            '<span id="quantitiy' + (elements.warLocCode) + '" class="watloc-code-text" hidden="hidden">' + elements.warLocCode + '</span>' +
                                          '</button>'

                                $("#Locationtd" + elements.warLocCode).html(table);
                                setLocation(elements.warLocCode);
                            });
                        });
                    } else {

                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    formatErrorMessage(jqXHR, errorThrown, "Menu");
                    EnableControllers();
                }
            });
    }

    function resetSheduleLocation(styleid, sheduleid, colorid){
        resetSheduleLocations();
        $.ajax({
                url: '@ViewBag.APIURL/Lookup/GetWarlocCodeByShedule?styleid=' + styleid + '&sheduleid=' + sheduleid + '&colorid=' + colorid,
                type: 'GET',
                dataType: 'json',
                async: false,
                contentType: 'application/json',
                beforeSend: function () {
                    $("#ajaxBusy").show();
                },
                complete: function () {
                    $("#ajaxBusy").hide();
                },  
                success: function (data) {
                    //console.log(data);
                    if(data.length != 0) {
                        $.each(data, function (index, elements) {
                            $("#LocationBtn" + elements.warLocCode).addClass('shedule-border');
                        });
                        sheduleHighlightBackupData = data;
                    } else {

                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    formatErrorMessage(jqXHR, errorThrown, "Menu");
                    EnableControllers();
                }
            });
    }

    function resetSheduleLocations(){
        if(sheduleHighlightBackupData.length != 0){
            $.each(sheduleHighlightBackupData, function (index, elements) {
                $("#LocationBtn" + elements.warLocCode).removeClass('shedule-border');
            });
        }
    }

    function colorPicker(value){
        switch (true) {
            case (value == 0): bgColour = '#ffffff'; break;
            case (value < 10): bgColour = '#c5e1a5'; break;
            case (value < 25): bgColour = '#A5D6A7'; break;
            case (value < 50): bgColour = '#66BB6A'; break;
            case (value < 75): bgColour = '#4CAF50'; break;
            case (value < 100): bgColour = '#388E3C'; break;

            case (value < 125): bgColour = '#dce775'; break;
            case (value < 150): bgColour = '#cddc39'; break;
            case (value < 175): bgColour = '#c0ca33'; break;
            case (value < 200): bgColour = '#afb42b'; break;

            case (value < 225): bgColour = '#4FC3F7'; break;
            case (value < 250): bgColour = '#29b6f6'; break;
            case (value < 275): bgColour = '#039be5'; break;
            case (value < 300): bgColour = '#0288d1'; break;

            case (value < 325): bgColour = '#ffb74d'; break;
            case (value < 350): bgColour = '#ff9800'; break;
            case (value < 400): bgColour = '#fb8c00'; break;
            case (value < 425): bgColour = '#e57373'; break;
            case (value < 450): bgColour = '#ef5350'; break;
            case (value < 475): bgColour = '#e53935'; break;
            case (value < 500): bgColour = '#c62828'; break;
            case (value < 10000): bgColour = '#c62828'; break;
        }  
        return bgColour;
    }

    function fromPercent(valNum) {
        var decimalValue = Math.round(valNum*255/100);

        if (valNum < 7) {
            var hexValue = "0"+decimalValue.toString(16).toUpperCase();
        }
        else {
            var hexValue = decimalValue.toString(16).toUpperCase();
        }

        return hexValue;
    }

    function setLocation(arg) {
        //console.log(arg, "#LocationBtn" + arg, previousSelectedLoc);
        
        $("#location-id").html(arg);
        if(previousSelectedLoc != null){
            $("#LocationBtn" + previousSelectedLoc).removeClass('selected-location');
        }
        $("#LocationBtn" + arg).addClass('selected-location');

        previousSelectedLoc = arg;
    }

    function getLocationDetails() {
        var loc = $("#location-id").html();
        if(loc != null && loc != "") {
            var smode = $("#subViewLoc").val();

            if(smode == "") {
                smode = 1;
            }

            $.ajax({
                url: '@ViewBag.APIURL/Lookup/GetLocationDetailsbyLoccode?Loccode=' + loc + '&smode=' + smode + '&faccode=' + clientconfig.facCode,
                type: 'GET',
                dataType: 'json',
                async: false,
                contentType: 'application/json',
                beforeSend: function () {
                    $("#ajaxBusy").show();
                },
                complete: function () {
                    $("#ajaxBusy").hide();
                },  
                success: function (data) {
                    $("#expand-location-summary-grid").data('kendoGrid').dataSource.data([]);
                    //console.log(data);
                    if(data.length != 0) { 
                        var gridData = [];

                        $.each(data, function (index, elements) {
                            var object = {
                                Key: elements.wfIdDesc,
                                ProductionWarehouse: elements.wfIdDesc,
                                Bag_Barcode: elements.bagBarCode,
                                Mode: elements.txnMode,
                                Style: elements.styleDesc,
                                Shedule: elements.scheduleDesc,
                                Color: elements.colorDesc,
                                Size: elements.sizeDesc,
                                Quantity: elements.qty01,
                                ModifiedDateTime: (new Date(elements.modifiedDateTime)).toLocaleDateString("en-GB",{ month: '2-digit', day: '2-digit', year: 'numeric'}),
                                ModifiedTime: (new Date(elements.modifiedDateTime)).toLocaleTimeString("en-GB",{ hour: "2-digit", minute: "2-digit", second: "2-digit"}),
                            }

                        gridData.push(object);
                        //EnableInputs();
                        });

                        if(smode == 2) {
                            $("#expand-location-summary-grid").data('kendoGrid').showColumn("Size");
                        } else {
                            $("#expand-location-summary-grid").data('kendoGrid').hideColumn("Size");
                        }

                        $("#expand-location-summary-grid").data('kendoGrid').dataSource.data(gridData);

                        locationSummaryWindow = $("#expandedLocationSummaryWindow").kendoWindow({
                            width: "90%",
                            height: "80%",
                            title: "Location Bag Summary",
                            visible: false,
                            actions: ["Close"],
                            modal: true,
                            resizable: true,
                            draggable: true,
                            pinned: true,
                        }).data("kendoWindow");

                        var arrows = [38, 40];
                        locationSummaryWindow.open().center();
                    } else {
                        msgBox.show('තෝරාගත් ස්ථානයේ කිසිදු අයිතමයක් හමු නොවීය.', 'No items were found in selected location.', 'Warning', 'BU05', 'Warning', null);
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    formatErrorMessage(jqXHR, errorThrown, "Menu");
                    EnableControllers();
                }
            });
        }
    }

    function searchForDispatchItemDetail() {
        var controlid = $("#control-id-text").val();
        $("#expand-dispatch-wise-bag-summary-grid").data('kendoGrid').dataSource.data([]);
        if(controlid != "") {
            $.ajax({
                url: '@ViewBag.APIURL/Lookup/GetDetailsbyControlId?ControlId=' + controlid,
                type: 'GET',
                dataType: 'json',
                async: false,
                contentType: 'application/json',
                beforeSend: function () {
                    $("#ajaxBusy").show();
                },
                complete: function () {
                    $("#ajaxBusy").hide();
                },  
                success: function (data) {
                    $("#expand-dispatch-wise-bag-summary-grid").data('kendoGrid').dataSource.data([]);
                    //console.log(data);
                    if(data.length != 0) { 
                        var gridData = [];

                        $.each(data, function (index, elements) {
                            var object = {
                                Key: elements.warLocCode + "|" + elements.scheduleDesc,
                                Location: elements.warLocCode,
                                Bag_Barcode: elements.bagBarCode,
                                Mode: elements.txnMode,
                                Style: elements.styleDesc,
                                PO: elements.pONo,
                                Z_Feature: elements.zfeature,
                                Shedule: elements.scheduleDesc,
                                Color: elements.colorDesc,
                                Status: elements.txnStatus,
                                Quantity: elements.qty01,
                            }

                        gridData.push(object);
                        //EnableInputs();
                        });

                        $("#expand-dispatch-wise-bag-summary-grid").data('kendoGrid').dataSource.data(gridData);

                        dispatchSummaryWindow = $("#expandedDispatchWiseBagSummaryWindow").kendoWindow({
                            width: "90%",
                            height: "80%",
                            title: "Location Bag Summary",
                            visible: false,
                            actions: ["Close"],
                            modal: true,
                            resizable: true,
                            draggable: true,
                            pinned: true,
                        }).data("kendoWindow");

                        var arrows = [38, 40];
                        dispatchSummaryWindow.open().center();
                    } else {
                        msgBox.show('යැවීමේ හැඳුනුම්පත හිස් ය.', 'Dispatch ID is empty.', 'Warning', 'BU05', 'Warning', null);
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    formatErrorMessage(jqXHR, errorThrown, "Menu");
                    EnableControllers();
                }
            });
        } else {
            dispatchSummaryWindow = $("#expandedDispatchWiseBagSummaryWindow").kendoWindow({
                width: "90%",
                height: "80%",
                title: "Dispatch Bag Summary",
                visible: false,
                actions: ["Close"],
                close: function() { $('#control-id-text').val('');},
                modal: true,
                resizable: true,
                draggable: true,
                pinned: true,
            }).data("kendoWindow");

            var arrows = [38, 40];
            dispatchSummaryWindow.open().center();
        }
    }

    function getLocationWiseBagDetails() {
        $('#style-text').val('');
        $('#shedule-text').val('');
        $('#color-text').val('');

        $("#subView").kendoDropDownList({dataSource:[{"Text":"Without Size","Value":"1"},
                                                    {"Text":"With Size","Value":"2"}],
                                                    "dataTextField":"Text","dataValueField":"Value"});

        $.ajax({
            url: '@ViewBag.APIURL/Lookup/GetAllProductionWarehouses',
            type: 'GET',
            dataType: 'json',
            //async: false,
            contentType: 'application/json',
            beforeSend: function () {
                $("#ajaxBusy").show();
            },
            complete: function () {
                $("#ajaxBusy").hide();
            },
            success: function (response) {
                $("#prod-warehouse-text").kendoDropDownList({"dataSource": response, filter: "contains","dataTextField": "wfdesc","dataValueField": "wfid","optionLabel": "Select a factory..."});
            },
            error: function (jqXHR, textStatus, errorThrown) {
                formatErrorMessage(jqXHR, errorThrown, "BFLStockReport");
            }
        });

        $("#expand-location-wise-bag-summary-grid").data('kendoGrid').dataSource.data([]);

        locationWiseBagSummaryWindow = $("#expandedLocationWiseBagSummaryWindow").kendoWindow({
            width: "95%",
            height: "80%",
            title: "Location Wise Bag Summary",
            visible: false,
            actions: ["Close"],
            modal: true,
            resizable: true,
            draggable: true,
            pinned: true,
        }).data("kendoWindow");

        var arrows = [38, 40];
        locationWiseBagSummaryWindow.open().center();
    }

    function searchForLocationWiseBagDetails(){
        var style = $('#style-text').val();
        var shedule = $('#shedule-text').val();
        var color = $('#color-text').val();
        var smode = $("#subView").val();

        if(smode == "") {
            smode = 1;
        }

        var Wfid = $("#prod-warehouse-text").val() != "" ? $("#prod-warehouse-text").val() : 0;

        $.ajax({
                url: '@ViewBag.APIURL/Lookup/GetLocationBagDetails?style=' + style + '&shedule=' + shedule + '&color=' + color+ '&wfid=' + Wfid + '&smode=' + smode + '&faccode=' + clientconfig.facCode,
                type: 'GET',
                dataType: 'json',
                //async: false,
                contentType: 'application/json',
                beforeSend: function () {
                    $("#ajaxBusy").show();
                },
                complete: function () {
                    $("#ajaxBusy").hide();
                },  
                success: function (data) {
                    $("#expand-location-wise-bag-summary-grid").data('kendoGrid').dataSource.data([]);
                    //console.log(data);
                    if(data.length != 0) { 
                        var gridData = [];

                        $.each(data, function (index, elements) {
                            var object = {
                                Key: elements.wfIdDesc + " - " + elements.location,
                                ProductionWarehouse: elements.wfIdDesc,
                                Location: elements.location,
                                Bag_Barcode: elements.bagBarCode,
                                Mode: elements.txnMode,
                                Style: elements.styleDesc,
                                Shedule: elements.scheduleDesc,
                                Color: elements.colorDesc,
                                Size: elements.sizeDesc,
                                Quantity: elements.qty01,
                                ModifiedDateTime: (new Date(elements.modifiedDateTime)).toLocaleDateString("en-GB",{ month: '2-digit', day: '2-digit', year: 'numeric'}),
                                ModifiedTime: (new Date(elements.modifiedDateTime)).toLocaleTimeString("en-GB",{ hour: "2-digit", minute: "2-digit", second: "2-digit"}),
                            }

                        gridData.push(object);
                        //EnableInputs();
                        });

                        if(smode == 2) {
                            $("#expand-location-wise-bag-summary-grid").data('kendoGrid').showColumn("Size");
                        } else {
                            $("#expand-location-wise-bag-summary-grid").data('kendoGrid').hideColumn("Size");
                        }
                        $("#expand-location-wise-bag-summary-grid").data('kendoGrid').dataSource.data(gridData);

                    } else {
                        msgBox.show('කිසිදු අයිතමයක් හමු නොවීය.', 'No items were found.', 'Warning', 'BU05', 'Warning', null);
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    formatErrorMessage(jqXHR, errorThrown, "Menu");
                    EnableControllers();
                }
            });
    }

    //Handle Controllers
    function EnableControllers() {
        $("#scanActionAddBtn").removeAttr('disabled');
    }

    function DisableControllers() {
        $("#scanActionAddBtn").attr('disabled', 'disabled');
    }

    //picking list
    function openpickinglist() {
        //$("#selectedshedulenumbers").html('');
        pickinglist = $("#expandPickingList").kendoWindow({
                        width: "60%",
                        height: "90%",
                        title: "Picking List",
                        visible: false,
                        actions: ["Close"],
                        modal: true,
                        resizable: true,
                        draggable: true,
                        pinned: true,
                    }).data("kendoWindow");

        var arrows = [38, 40];
        pickinglist.open().center();
    }

    function openselectshedules() {
        var crudServiceBaseUrl = "@ViewBag.APIURL/Lookup",
            dataSource = new kendo.data.DataSource({
                batch: true,
                aggregate: [{ field: "Quantity", aggregate: "sum" }],
                schema: {
                    model: {
                        id: "Key",
                        fields: {
                            Key: { type: "string", editable: false },
                            Wfid: { type: "number", editable: false },
                            Factory: { type: "string", editable: false },
                            L1id: { type: "number", editable: false },
                            L2id: { type: "number", editable: false },
                            Shedule: { type: "string", editable: false }
                        }
                    }
                }
            });

        //Grid definition
        var grid = $("#add-items-grid-data").kendoGrid({
            dataSource: dataSource,
            scrollable: true,
            resizable: true,
            filterable: {mode: "row"},

            //define dataBound event handler
            dataBound: onDataBound,
            columns: [
                //define template column with checkbox and attach click event handler
                { field: "Key", width:"20px", hidden: true },
                { title: 'Select All',
                    headerTemplate: "<input type='checkbox' id='header-chb' class='k-checkbox header-checkbox'><label class='k-checkbox-label' for='header-chb'></label>",
                    template: function (dataItem) {
                        return "<input type='checkbox' id='" + dataItem.Key + "-" + dataItem.WfdepinstId + "' class='k-checkbox row-checkbox'><label class='k-checkbox-label' for='" + dataItem.Key + "-" + dataItem.WfdepinstId + "'></label>";
                    },
                    width: 15},
                { field: "Wfid", title: "Wfid", width: "50px", hidden: true, editable: false },
                { field: "Factory", title: "Factory", width: "100px", editable: false },
                { field: "L1id", title: "L1id", width: "50px", hidden: true, editable: false },
                { field: "L2id", title: "L2id", width: "50px", hidden: true, editable: false },
                { field: "Shedule", title: "Shedule", width: "100px", editable: false }
            ],
            editable: "inline"
        }).data("kendoGrid");

        //getAddItemData(null,null); //Fill Data to the table

        //bind click event to the checkbox
        grid.table.on("click", ".row-checkbox", selectRow);

        $('#header-chb').change(function (ev) {
            $("#ajaxBusy").show();
            var checked = ev.target.checked;
            $('.row-checkbox').each(function (idx, item) {
                if (checked) {
                    if (!($(item).closest('tr').is('.k-state-selected'))) {
                        $(item).click();
                    }
                } else {
                    if ($(item).closest('tr').is('.k-state-selected')) {
                        $(item).click();
                    }
                }
            });
            
            $("#ajaxBusy").hide();
        });

        //Add selected items to request-items-grid
        $("#item-add-button").bind("click", function () {
            $("#add-items-grid-data").data("kendoGrid").dataSource.filter({});
            $("#selectedshedulenumbers").html('');
            var allGridData = $("#add-items-grid-data").data("kendoGrid").dataSource.data();
            var grid = $("#add-items-grid-data").data("kendoGrid");
            var checkedItems = [];
            var shedules = "";
            var picklistitemdesc = "";
            var picklistitemrow = "";
            var count = 0;

            var data = grid.items();
            $.each(data, function (index, item) {
                setTimeout(() => {
                    if (($(item).hasClass("k-state-selected"))) {
                        $.ajax({
                                url: '@ViewBag.APIURL/Lookup/GetPickListByShedule?styleid=' + allGridData[index].L1id + '&sheduleid=' + allGridData[index].L2id,
                                type: 'GET',
                                dataType: 'json',
                                async: false,
                                contentType: 'application/json',
                                beforeSend: function () {
                                    $("#ajaxBusy").show();
                                },
                                complete: function () {
                                },
                                success: function (response) {
                                    //console.log(response);
                                    var prevKey = "";
                                    var picklist = ""
                        
                                    shedules +=    '<tr id= "shedule' + index + '">' + 
                                                        '<td class="counter-td counter-round invisible-background" style="padding-top: 5px;" id="Locationtd' + allGridData[index].Key + '">' + 
                                                            '<button class="location-button box" style="width: 278px; margin-left: 5px; background-color: #009688; !important" type="button" id="LocationBtn' + allGridData[index].Shedule + '" title="'+ allGridData[index].Shedule +'">' +
                                                                '<span id="' + (allGridData[index].Shedule) + '" class="watloc-code-text">' + allGridData[index].Shedule + '</span>' +
                                                            '</button>' +
                                                        '</td>' +
                                                    '</tr>'

                                    var facKey = allGridData[index].Shedule + " : " + allGridData[index].Factory;
                                    picklist +=    '<tr id= "shedule' + facKey + '">' + 
                                                        '<td class="counter-td counter-round invisible-background" style="padding-top: 5px;" id="Locationtd' + facKey + '">' + 
                                                            '<button class="shedule-button-header" id="LocationBtn' + facKey + '" title="'+ facKey +'">' +
                                                                '<span id="' + (facKey) + '" class="shedule-span-header">' + facKey + '</span>' +
                                                            '</button>' +
                                                        '</td>' +
                                                    '</tr>'
                                    
                                    picklist +=    '<tr id= "shedule' + index + '">' + 
                                                        '<td class="counter-td counter-round invisible-background" style="padding-top: 5px;" id="Locationtd' + facKey + "text" + '">' + 
                                                            '<button class="pick-list-col-button-header" type="button" id="LocationBtn' + facKey + "text" + '" title="'+ "" +'">' +
                                                                '<span id="' + (facKey + " : " + "text") + '" class="pick-list-col-label-header">Barcode</span>' +
                                                            '</button>' +
                                                            '<button class="pick-list-col-button-header" type="button" id="LocationBtn' + facKey + "text1" + '" title="'+ "" +'">' +
                                                                '<span id="' + (facKey + " : " + "text1") + '" class="pick-list-col-label-header">Quantity</span>' +
                                                            '</button>' +
                                                        '</td>' +
                                                    '</tr>'

                                    $.each(response, function (index, elements) {
                                            var Key = elements.warLocCode + " : " + elements.colorDesc
                                            if(prevKey = "" || prevKey != Key){
                                                picklist +=    '<tr id= "shedule' + index + '">' + 
                                                                    '<td class="counter-td counter-round invisible-background" style="padding-top: 1px;" id="Locationtd' + Key + '">' + 
                                                                        '<button class="pick-list-col-button-sub-header" type="button" id="LocationBtn' + Key + '" title="'+ elements.bagBarCode +'">' +
                                                                            '<span id="' + (Key) + '" class="pick-list-col-label-sub-header">' + Key + '</span>' +
                                                                        '</button>' +
                                                                    '</td>' +
                                                                '</tr>'
                                                
                                                picklist +=    '<tr id= "shedule' + index + '">' + 
                                                                    '<td class="counter-td counter-round invisible-background" style="padding-top: 1px;" id="Locationtd' + Key + '">' + 
                                                                        '<button class="pick-list-td-button-sub-header" type="button" id="LocationBtn' + Key + '" title="'+ elements.bagBarCode +'">' +
                                                                            '<span id="' + (Key + " : " + elements.bagBarCode) + '" class="pick-list-td-label-sub-header">' + elements.bagBarCode + '</span>' +
                                                                        '</button>' +
                                                                        '<button class="pick-list-td-button-sub-header" type="button" id="LocationBtn' + Key + '" title="'+ elements.qty01 +'">' +
                                                                            '<span id="' + (Key + " : " + elements.qty01) + '" class="pick-list-td-label-sub-header">' + elements.qty01 + '</span>' +
                                                                        '</button>' +
                                                                    '</td>' +
                                                                '</tr>'
                                                prevKey = Key;
                                            } else {
                                                picklist +=    '<tr id= "shedule' + index + '">' + 
                                                                    '<td class="counter-td counter-round invisible-background" style="padding-top: 1px;" id="Locationtd' + Key + '">' + 
                                                                        '<button class="pick-list-td-button-sub-header" type="button" id="LocationBtn' + Key + '" title="'+ elements.bagBarCode +'">' +
                                                                            '<span id="' + (Key + " : " + elements.bagBarCode) + '" class="pick-list-td-label-sub-header">' + elements.bagBarCode + '</span>' +
                                                                        '</button>' +
                                                                        '<button class="pick-list-td-button-sub-header" id="LocationBtn' + Key + '" title="'+ elements.qty01 +'">' +
                                                                            '<span id="' + (Key + " : " + elements.qty01) + '" class="pick-list-td-label-sub-header">' + elements.qty01 + '</span>' +
                                                                        '</button>' +
                                                                    '</td>' +
                                                                '</tr>'
                                                prevKey = Key;
                                            }
                                    });
                                    
                                    picklistitemdesc += '<td id= "sheduletd' + index + '">' +
                                                            '<div class="picklist-item-box" style="width: 200px;">' +
                                                                '<table id= "sheduletree' + index + '" style="margin: 3px;">' + 
                                                                    '<tbody id="1212' + index + '">' +
                                                                        picklist +
                                                                    '</tbody>' +
                                                                '</table>' +
                                                            '</div>' +
                                                        '</td>'

                                    /*if(count <= 3) {
                                        picklistitemrow += '<tr id= "sheduleTable' + index + ":" + allGridData[index].Shedule + '">' + 
                                                                picklistitemdesc +
                                                            '</tr>'
                                        
                                    } else {*/
                                        //console.log("inner",data.length, index, count);
                                        if(count == 2){
                                            picklistitemrow += '<tr id= "sheduleTable' + index + ":" + allGridData[index].Shedule + '">' + 
                                                                    picklistitemdesc +
                                                                '</tr>'
                                            picklistitemdesc = "";
                                            count = -1;
                                        }
                                        if(data.length == (index+1) && count != 2){
                                            picklistitemrow += '<tr id= "sheduleTable' + index + ":" + allGridData[index].Shedule + '">' + 
                                                                    picklistitemdesc +
                                                                '</tr>'
                                            picklistitemdesc = "";
                                            count = -1;
                                        }
                                    //}
                                    
                                    $("#ajaxBusy").hide();
                                    EnableInputs();
                                },
                                error: function (jqXHR, textStatus, errorThrown) {
                                    formatErrorMessage(jqXHR, errorThrown, "Menu");
                                    $("#ajaxBusy").hide();
                                    EnableInputs();
                                }
                        });
                        
                        count += 1;
                    } else {
                        //console.log("else", data.length, index, count);
                        if(data.length == (index +1) && count > 0 && count <= 2){
                            picklistitemrow += '<tr id= "sheduleTable' + index + ":" + allGridData[index].Shedule + '">' + 
                                                                    picklistitemdesc +
                                                                '</tr>'
                            picklistitemdesc = "";
                            count = 0;
                        }
                    }
                    
                    if(data.length <= (index+1)){
                        $("#selectedsheduletables").html(picklistitemrow);
                        $("#selectedshedulenumbers").html(shedules);
                    }
                });
            });
            
            addShedulesGrid.close();
        });

        $("#search-button").bind("click", function () {
            $("#add-items-grid-data").data("kendoGrid").dataSource.filter({});
            $("#add-items-grid-data").data('kendoGrid').dataSource.data([]);
            getShedules();
        });

        $("#cancel-button").bind("click", function () {
            $("#request-items-grid").data('kendoGrid').dataSource.data([]);
            checkedIds = {};
            addShedulesGrid.close();
            $("#header-chb")[0].checked = false;
        });
        //End of Item Grid

        addShedulesGrid = $("#add-items-grid").kendoWindow({
            width: "40%",
            title: "Add Items",
            visible: false,
            actions: ["Close"],
            modal: true,
            resizable: true,
            draggable: true,
            pinned: true,
        }).data("kendoWindow");

        var arrows = [38, 40];
        addShedulesGrid.open().center();
        EnableInputs();
    }

    function onDataBound(e) {
        var dataItems = this.dataSource.view();
        for (var i = 0; i < dataItems.length; i++) {
            
            if (dataItems[i].get("BagStatus") == 0) {
                e.sender.tbody.find("[data-uid='" + dataItems[i].uid + "']").addClass("unpre");
            } else {
                e.sender.tbody.find("[data-uid='" + dataItems[i].uid + "']").addClass("pre");
            }

            if (checkedIds[dataItems[i].id]) {
                this.tbody.find("tr[data-uid='" + dataItems[i].uid + "']")
                    .addClass("k-state-selected")
                    .find(".k-checkbox")
                    .attr("checked", "checked");
            }
        }
    }

    function selectRow() {
        DisableInputs();
        var checked = this.checked,
        row = $(this).closest("tr"),
        grid = $("#add-items-grid-data").data("kendoGrid"),
        dataItem = grid.dataItem(row);
        
        checkedIds[dataItem.id] = checked;
        
        if (checked) {
            //-select the row
            row.addClass("k-state-selected");

            var checkHeader = true;

            $.each(grid.items(), function (index, item) {
                if (!($(item).hasClass("k-state-selected"))) {
                    checkHeader = false;
                }
            });

            $("#header-chb")[0].checked = checkHeader;
        } else {
            //-remove selection
            row.removeClass("k-state-selected");
            $("#header-chb")[0].checked = false;
        }
        EnableInputs();
    }

    function getShedules() {
        //$("#add-items-grid-data").data('kendoGrid').dataSource.data([]);
        var gridData = [];
        $.ajax({
                url: '@ViewBag.APIURL/Lookup/GetAllShedulesofUnaloocatedGroupBarcodes?faccode=' + clientconfig.facCode,
                type: 'GET',
                dataType: 'json',
                async: false,
                contentType: 'application/json',
                beforeSend: function () {
                    $("#ajaxBusy").show();
                },
                complete: function () {
                },
                success: function (response) {
                    //console.log(response);
                    $.each(response, function (index, elements) {
                        var object = {
                            Key: elements.wfIdBag + "|" + elements.l1idBag + "|" + elements.l2idBag + "|" + elements.scheduleDesc,
                            Wfid: elements.wfIdBag,
                            Factory: elements.wfIdDesc,
                            L1id: elements.l1idBag,
                            L2id: elements.l2idBag,
                            Shedule: elements.scheduleDesc
                        }
                        gridData.push(object);
                        EnableInputs();
                    });
                    //console.log(gridData);
                    $("#add-items-grid-data").data('kendoGrid').dataSource.data(gridData);
                    $("#ajaxBusy").hide();
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    formatErrorMessage(jqXHR, errorThrown, "Menu");
                    $("#ajaxBusy").hide();
                    EnableInputs();
                }
        });
    }
    //end picking list

    //print pick list
    //Print Controllers
    function openPrintWindow() {
        DisableInputs();
        var tables = $("#loadedshedulesTables").html();
        //Print Page Contrrolers
        if(tables != null){
            printpdfwindow = null;
            $("#printpicklisttables").html(tables);

            printpdfwindow = $("#printpdf").kendoWindow({
                        height: "75%",
                        title: "Print Picking List",
                        visible: false,
                        actions: ["Close"],
                        scrollable: true,
                        modal: true,
                        resizable: true,
                        draggable: true,
                        pinned: true,
                    }).data("kendoWindow");

                var arrows = [38, 40];
                printpdfwindow.open().center(); 
        } else {

        }
        EnableInputs();
    }

    function colsePrintWindow() {
        if(printpdfwindow != ""){
            printpdfwindow.close();
        }
    }
    
    function getPDF(selector) {
      kendo.drawing.drawDOM($(selector), {
           //forcePageBreak: ".items-page-break",
           paperSize: "A4",
           allPages: true,
           avoidLinks: true,
           paperSize: "A4",
           margin: { top: "0cm", left: "0cm", right: "1cm", bottom: "0cm" },
           repeatHeaders: true,
           scale: 0.9
      }).then(function (group) {
            kendo.drawing.pdf.saveAs(group, "Picking List" + "" + ".pdf");
        });
    }


    //Input controllers
    function DisableInputs() {
    }

    function EnableInputs() {
    }
    
</script>


<div id="main">
    <div style="margin-top: 5px; margin-left: 5px;">
        <div class="row">
            <div class="col-xs-5">
                <div class="row roundCornerGroupBox" style="margin-left: -20px !important; height: 141px !important;">
                    <label class="col-xs-2 control-label control-label-main" style="width: 23%; font-size: 22px !important; margin-top: 20px !important;">Scan Group Barcode :</label>
                    <div class="col-xs-7"  style="margin-bottom: 4.05%;">
                        <input type="textarea" id="scanBagBarodeSearch" class="form-control textbox-barcode" maxlength="20" placeholder="Scan Group Barcode">
                    </div>
                </div>
            </div>
            <div class="col-xs-7">
                <div class="row  roundCornerGroupBox" style="height: 141px !important; margin-right: 5px;">                            
                    <div class="col-xs-6" style="padding-left: 0px;">                                 
                        <div class="row" style="height: 40px; overflow: auto;">                                                         
                            <label class="control-label col-xs-3">Style :</label>               
                            <label class="bcInfoDataLabel col-xs-8" style="font-size: 20px !important;" id="styleDataLabel" ></label>                                        
                        </div>                                 
                        <div class="row" style="height: 40px; overflow: auto;">
                            <label class="control-label col-xs-3">PO :</label>               
                            <label class="bcInfoDataLabel col-xs-8" style="font-size: 20px !important;" id="poDataLabel" ></label>                    
                        </div>
                        <div class="row" style="height: 40px; overflow: auto;">
                            <label class="control-label col-xs-3" style="width: 155px;">Cut Letter :</label>               
                            <label class="bcInfoDataLabel col-xs-8" style="font-size: 20px !important;" id="cutLetterLabel" ></label>                                   
                        </div> 
                    </div>
                    <div class="col-xs-6" style="padding-left: 0px;">
                        <div class="row" style="height: 40px; overflow: auto;">                                                    
                            <label class="control-label col-xs-4" style="padding-left: 0px;">Schedule :</label>               
                            <label class="bcInfoDataLabel col-xs-3" style="font-size: 20px !important;" style="width:140px;" id="sheduleDataLabel" ></label>
                        </div>
                        <div class="row" style="height: 40px; overflow: auto;">             
                            <label class="control-label col-xs-4" style="padding-left: 0px;">Color :</label>               
                            <label class="bcInfoDataLabel col-xs-3" style="font-size: 20px !important; width: 55%;" id="colorDataLabel" ></label>
                        </div>  
                        <div class="row" style="height: 40px; overflow: auto;">           
                            <label class="control-label col-xs-4" style="padding-left: 0px; width:155px;">Quantity :</label>               
                            <label class="bcInfoDataLabel col-xs-3" style="font-size: 20px !important;" id="quantityDataLabel" ></label>
                        </div>                       
                    </div>  
                </div> 
            </div>
        </div>

        <!--DETAILS PAGE GRID: BEGIN -->
        <div class="row">
            <div class="col-xs-5">
                <div class="row roundCornerGroupBox" style="margin-left: -20px !important; height: 110px !important;">
                    <label class="control-label-submitbtn">
                        <button type="button" id="scanActionAddBtn" onClick="confirmSuccess()" class="btn bs-btn-primary-action submitButton" title="Add" style="margin-left: 10px; font-weight: 600 !important; width: 110px !important;">
                            <span>Add<span style="font-size: 10px;"> (F5)</span></span>                            
                        </button>
                    </label>
                    <label class="location-text">
                        <button type="button" id="locationAddBtn" onClick="getLocationDetails()" class="btn bs-btn-primary-action submitButton" title="show location details" style="margin-left: 10px; background-color: #ff5722; border: #E91E63; font-weight: 600 !important; color: black;">
                            <span id="location-id"></span>                            
                        </button>
                    </label>
                    <label class="dispatch-wise-bag-text">
                        <button type="button" id="dispatchWiseBagAddBtn" onClick="searchForDispatchItemDetail()" class="btn bs-btn-primary-action submitButton" title="show dispatch bag summary" style="margin-left: 5%;; width: 200px !important;">
                            <span id="control-id"></span>                            
                        </button>
                    </label> 
                    <label class="location-wise-bag-text">
                        <button type="button" id="locationWiseBagAddBtn" onClick="getLocationWiseBagDetails()" class="btn bs-btn-primary-action submitButton" title="show location wise bag summary" style="margin-left: 20%;; width: 220px !important;">
                            <span id="location-wise-id">Location Wise Bag</span>                            
                        </button>
                    </label> 
                </div>
                <div class="row roundCornerGroupBox" style="margin-left: -20px !important; height: 515px !important; overflow-y: auto;">
                    <!-- REQUEST ITEMS GRID: BEGIN -->
                    <div id="bag-items-grid" style="margin-top: 5px; border-radius: 3px; margin: -2px;">
                    </div>
                </div>
                <div class="row roundCornerGroupBox" style="margin-left: -20px !important; height: 110px !important; margin-top: 14px;">
                    <label class="control-label-submitbtn">
                        <button type="button" id="scanActionAddBtn" onClick="openpickinglist()" class="btn bs-btn-primary-action submitButton" title="Add" style="margin-left: 10px; font-weight: 600 !important; width: 212px !important;">
                            <span>PICKING LIST<span style="font-size: 10px;"> (F8)</span></span>                            
                        </button>
                    </label>
                </div>
            </div>

            <div class="col-xs-7">
                <div class="row  roundCornerGroupBox" style="margin: 5px !important;">
                    <table style="width: 100%">
                        <tbody>
                            <tr>
                                <td class="color-label" style="text-align: center; background-color: #ffffff; color: black;">0</td>
                                <td class="color-label" style="text-align: right; background-color: #c5e1a5;">&nbsp&nbsp</td>
                                <td class="color-label" style="text-align: right; background-color: #A5D6A7;">&nbsp&nbsp&nbsp</td>
                                <td class="color-label" style="text-align: right; background-color: #66BB6A;">50</td>
                                <td class="color-label" style="text-align: right; background-color: #4CAF50;">&nbsp&nbsp&nbsp</td>
                                <td class="color-label" style="text-align: right; background-color: #388E3C;">100</td>

                                <td class="color-label" style="text-align: right; background-color: #dce775;">&nbsp&nbsp&nbsp</td>
                                <td class="color-label" style="text-align: right; background-color: #cddc39;">150</td>
                                <td class="color-label" style="text-align: right; background-color: #c0ca33;">&nbsp&nbsp&nbsp</td>
                                <td class="color-label" style="text-align: right; background-color: #afb42b;">200</td>

                                <td class="color-label" style="text-align: right; background-color: #4FC3F7;">&nbsp&nbsp&nbsp</td>
                                <td class="color-label" style="text-align: right; background-color: #29b6f6;">250</td>
                                <td class="color-label" style="text-align: right; background-color: #039be5;">&nbsp&nbsp&nbsp</td>
                                <td class="color-label" style="text-align: right; background-color: #0288d1;">300</td>

                                <td class="color-label" style="text-align: right; background-color: #ffb74d;">&nbsp&nbsp&nbsp</td>
                                <td class="color-label" style="text-align: right; background-color: #ff9800;">350</td>
                                <td class="color-label" style="text-align: right; background-color: #fb8c00;">&nbsp&nbsp&nbsp</td>
                                <td class="color-label" style="text-align: right; background-color: #e57373;">400</td>
                                <td class="color-label" style="text-align: right; background-color: #ef5350;">&nbsp&nbsp&nbsp</td>
                                <td class="color-label" style="text-align: right; background-color: #e53935;">450</td>
                                <td class="color-label" style="text-align: right; background-color: #c62828;">&nbsp&nbsp&nbsp</td>
                                <td class="color-label" style="text-align: right; background-color: #c62828;">500&nbsp</td>
                            </tr>
                        </tbody>
                    </table> 
                </div>
                <div class="row  roundCornerGroupBox" style="margin: 5px !important; overflow-y: auto; height: 727px !important;"> 
                    <!-- LOCATION GRID: BEGIN -->
                    <div id="location-grid" style="margin-top: 5px;">
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-xs-5">
                
            </div>
        </div>

    </div>
</div>

<!--Expanded Table for location Summary Window: START-->
<div id="expandedLocationSummaryWindow" style="height: 95%;" hidden="hidden">
    <div class="row">
    <div style="clear:both;">
        <div style="float: left; height: 35px; margin-right: 10px;">
            <div style="float: left; width: 110px; margin-right: 10px; text-align: right; font-weight: bold;">
                <label for="subViewLoc" class="expand-search-label">
                    Size
                </label>
            </div>
            <div style="float: left;">
                <input id="subViewLoc" class="expand-search-input bu-form-control" style="width:180px"/>
            </div>
        </div>
        <div style="float: left; height: 35px; margin-right: 10px;">
            <div style="float: left;">
                <button id="filterGatePassRequestButton" class="expand-search-button k-button" style="width: 180px; height: 45px; font-size: 20px !important;" onclick="getLocationDetails()">
                    <span class="k-icon k-i-search" style="margin-right: 7px; text-align:left;"></span><span>Search</span>
                </button>
            </div>
        </div>
    </div>
    </div>
    <div class="row">
    <div style="clear:both;">
        <!-- REQUEST ITEMS GRID -->
        <div id="expand-location-summary-grid" style="margin-top: 5px;">
        </div>
    </div>
    </div>
</div>
<!--Expanded Table Window: END-->

<!--Expanded Table For Location Wise Bag Summary Window: START-->
<div id="expandedLocationWiseBagSummaryWindow" style="height: 95%;" hidden="hidden">
    <div style="width: 100%;">
        <div style="margin: 5px; margin-bottom: 10px !important; width: 96%;">
            <div class="row">
                <div class="col-lg-12">
                    <div style="float: left; height: 35px; margin-right: 10px; margin-bottom: 25px; margin-left: -48px;">
                        <div style="float: left; width: 110px; margin-right: 10px; text-align: right; font-weight: bold;">
                            <label for="style-text" class="expand-search-label">
                                Style
                            </label>
                        </div>
                        <div style="float: left;">
                            <input id="style-text" class="expand-search-input bu-form-control" style="width:180px"/>
                        </div>
                    </div>
                    <div style="float: left; height: 35px; margin-right: 10px;">
                        <div style="float: left; width: 110px; margin-right: 10px; text-align: right; font-weight: bold;">
                            <label for="shedule-text" class="expand-search-label">
                                Shedule
                            </label>
                        </div>
                        <div style="float: left;">
                            <input id="shedule-text" class="expand-search-input bu-form-control" style="width:180px"/>
                        </div>
                    </div>
                    <div style="float: left; height: 35px; margin-right: 10px;">
                        <div style="float: left; width: 110px; margin-right: 10px; text-align: right; font-weight: bold;">
                            <label for="color-text" class="expand-search-label">
                                Color
                            </label>
                        </div>
                        <div style="float: left;">
                            <input id="color-text" class="expand-search-input bu-form-control" style="width:180px"/>
                        </div>
                    </div>
                    <div style="float: left; height: 35px; margin-right: 10px;">
                        <div style="float: left; width: 161px; margin-right: 10px; text-align: right; font-weight: bold;">
                            <label for="prod-warehouse-text" class="expand-search-label">
                                Factory
                            </label>
                        </div>
                        <div style="float: left;">
                            <input id="prod-warehouse-text" class="expand-search-input bu-form-control" style="width:180px"/>
                        </div>
                    </div>
                    <div style="float: left; height: 35px; margin-right: 10px;">
                        <div style="float: left; width: 110px; margin-right: 10px; text-align: right; font-weight: bold;">
                            <label for="subView" class="expand-search-label">
                                Size
                            </label>
                        </div>
                        <div style="float: left;">
                            <input id="subView" class="expand-search-input bu-form-control" style="width:180px"/>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <div style="float: left; height: 35px; margin-right: 10px;">
                        <div style="float: left;">
                            <button id="filterGatePassRequestButton" class="expand-search-button k-button" style="width: 180px; height: 45px; font-size: 20px !important;" onclick="searchForLocationWiseBagDetails()">
                                <span class="k-icon k-i-search" style="margin-right: 7px; text-align:left;"></span><span>Search</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <div style="clear:both;">
                        <!-- REQUEST ITEMS GRID -->
                        <div id="expand-location-wise-bag-summary-grid" style="margin-top: 5px;">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--Expanded Table Window: END-->

<!--Expanded Table For Location Wise Bag Summary Window: START-->
<div id="expandedDispatchWiseBagSummaryWindow" style="height: 95%;" hidden="hidden">
    <div style="margin: 5px; margin-bottom: 10px !important">
            <div>
                <div style="float: left; height: 35px; margin-right: 10px; margin-bottom: 25px; margin-left: -48px;">
                    <div style="float: left; width: 189px; margin-right: 10px; text-align: right; font-weight: bold;">
                        <label for="control-id-text" class="expand-search-label">
                            Dispatch Id
                        </label>
                    </div>
                    <div style="float: left;">
                        <input id="control-id-text" class="expand-search-input bu-form-control" style="width:180px"/>
                    </div>
                </div>
                <div style="float: left; height: 35px; margin-right: 10px;">
                    <div style="float: left; width: 110px; margin-right: 10px; visibility: hidden;">
                        Invisible text
                    </div>
                    <div style="float: left;">
                        <button id="filterGatePassRequestButton" class="expand-search-button k-button" style="width: 180px; height: 45px; font-size: 20px !important;" onclick="searchForDispatchItemDetail()">
                            <span class="k-icon k-i-search" style="margin-right: 7px; text-align:left;"></span><span>Search</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    <div style="clear:both;">
        <!-- REQUEST ITEMS GRID -->
        <div id="expand-dispatch-wise-bag-summary-grid" style="margin-top: 5px;">
        </div>
    </div>
</div>
<!--Expanded Table Window: END-->

<!--picking list: start-->
<div id="expandPickingList" style="height: 95%;" hidden="hidden">
    <div style="margin-top: 5px; margin-left: 5px;">
        <div class="row">
            <div class="col-xs-3">
                <div class="row roundCornerGroupBox" style="margin-left: -20px !important; height: 100px !important;">
                    <div style="float: left; margin-right: 30px;">
                        <button id="new-request-button" class="k-button" style="background-color: #FFA000; border: none; font-size: 17px; font-weight: 600; color: #000000; margin-left: 5px;margin-left: 5px; margin-top: 10px; width: 287px;" onclick="openselectshedules()">
                            <span class="k-icon k-i-plus" style="margin-right: 7px;"></span><span>select shedules</span>
                        </button>
                    </div>
                    <div style="float: left; margin-right: 30px;">
                        <button id="new-request-button" class="k-button" style="background-color: #26c6da; border: none; font-size: 17px; font-weight: 600; color: #000000; margin-left: 5px;margin-left: 5px; margin-top: 10px; width: 287px;" onclick="openPrintWindow()">
                            <span class="k-icon k-i-print" style="margin-right: 7px;"></span><span>print</span>
                        </button>
                    </div>
                </div>
                <div class="row roundCornerGroupBox" style="margin-left: -20px !important; height: 700px !important; margin-top: 10px;">
                    <div id="loadedshedules">
                        <table>
                            <thead>
                                <tr>
                                    <th style="font-size: 17px;">
                                        <label style="margin-left: 55px; margin-top: 5px; margin-bottom: 2px;">Selected Shedules</label>
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="selectedshedulenumbers">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-xs-8">
                <div class="row  roundCornerGroupBox" style="height: 815px !important; margin-right: 5px; overflow-y: scroll;">                            
                     <div class="size-a4" id="loadedshedulesTables" style="margin-left: 15px; margin-top: 20px;">
                        <table class="picklist-table" style="width: 600px;">
                            <tbody id="selectedsheduletables">
                            </tbody>
                        </table>
                    </div>
                </div> 
            </div>
        </div>
    </div>
</div>
<!--picking list: end-->

<!--ADD ITEMS PAGE: BEGIN -->
<div id="add-items-grid" hidden="hidden">
    <div style="height: 505px; max-height: 505px; overflow: hidden; ">
        <div style="float: left; margin-right: 10px;">
            <input id="search-button" type="button" class="k-button button-done" value="Search" style="width: 120px;">
        </div>
        <!-- REQUEST ITEMS GRID: BEGIN -->
        <div id="add-items-grid-data" style="margin-top: 40px !important; max-height: 420px !important; height: 420px;">   
        <!--END: Remove Request item window -->
        <!-- REQUEST ITEMS GRID: END -->
        </div>
        <div style="height: 50px"></div>
    </div>
    <div style="clear: both; height: 35px; margin-top: 20px; position: absolute; top: 10; bottom: 0; height: 7%;">
        <div style="float: left; margin-right: 10px;">
            <input id="item-add-button" type="button" class="k-button button-done" value="Add" style="width: 100px;">
        </div>
        <div style="float: left; margin-right: 10px;">
            <input id="cancel-button" type="button" class="k-button button-cancel" value="Cancel" style="width: 100px;">
        </div>
    </div>
</div>
<!--ADD ITEMS PAGE: END -->

<!-- Print Dispatch Window: START -->
<div id="printpdf" hidden="hidden"> <!-- hidden="hidden" -->
    <div id="example">
        <div class="box wide hidden-on-narrow">
            <div style="height: 35px; margin-top: 2px;">
                <div style="float: left; width: 120px; margin-right: 10px; margin-left: 4px; text-align: left; font-weight: bold;">
                    <label for="return">Select Page Size</label>
                </div>
                <div style="float: left;">
                    <select id="paper" style="width: 100px;">
                        <option value="size-a4" selected>A4</option>
                        <option value="size-letter">Letter</option>
                        <option value="size-executive">Executive</option>
                    </select>
                </div>
                <div style="float: left;">
                    <span id="approvers-requried-sign" style="margin-left: 5px; color: Red;">
                        *
                    </span>
                </div>
                <div style="float: left;  margin-left: 20px; text-align: left; font-weight: bold;">
                    <button class="export-pdf k-button" onclick="getPDF('.pdf-page')">Export</button>
                </div>
                <div style="float: left;">
                    <button class="export-pdf k-button" style="font-weight: 600; margin-left: 4px" onclick="colsePrintWindow()">Close</button>
                </div>
            </div>
        </div>

        <div class="page-container hidden-on-narrow">
            <div class="pdf-page size-a4">
                <div class="inner-page" style="margin-top: -20px;">
                    <div class="pdf-header">
                        <span class="company-logo">
                            <img src="../images/logo.png" style="width: 70px; margin-bottom: -17px;"/>
                        </span>
                        <span style="margin-left: 127px; font-size: 15px; font-weight: 600;">PICKING LIST</span>
                    </div>
                    <div class="pdf-footer">
                        <p>
                            <label style="font-size: 9px;" id="time-stamp"></label>
                            <label style="font-size: 12px; text-align: right; font-weight: bold" id="copy"></label>
                        </p>
                    </div>

                    <!--Security Copy-->
                    <div class="addresses" id="printpicklisttables" style="margin-left: -10px;">
                    </div>
                </div>
            </div>
        </div>

        <div class="responsive-message"></div>

        <!-- Load Pako ZLIB library to enable PDF compression -->
    </div>
</div>
<!-- End Print Dispatch Window: END -->

<style>
    .k-grid-header th.k-header{
        background-color: #757878;
    }

    .k-grid tr td {
        background-color: #b8b8be;
    }

    .k-header {
        background-color: #242424;
    }
</style>

<!--Page Styles: START-->
<Style>
    /* Scroll Bar */
    /* width */
    ::-webkit-scrollbar {
    width: 10px;
    height: 15px;
    margin-bottom: 7px;
    }

    /* Track */
    ::-webkit-scrollbar-track {
    background: #49505700;
    }
    
    /* Handle */
    ::-webkit-scrollbar-thumb {
    background: #888; 
    border-top-left-radius: 8px;
    border-top-right-radius: 8px;
    border-bottom-right-radius: 8px;
    border-bottom-left-radius: 8px;
    }

    /* Handle on hover */
    ::-webkit-scrollbar-thumb:hover {
    background: #555; 
    }

    /*trans border*/

    /*color label*/
    .color-label{
        font-size: 13px;
        font-weight: 600;
        color: black;
    }

    /*Pick ist*/
    .picklist-table {
        margin: 9px;
    }

    .picklist-table > tbody > tr > td {
        border: 1px solid;
    }

    .shedule-button-header {
        width: 173px;
        margin-left: 5px;
        background-color: #E6EE9C !important: ;
        border: 1px solid #43A047;
        border: none;
        border-radius: 7px;
        font-size: 13px !important; 
    }

    .shedule-span-header {
        color: black;
        font-weight: 600;
        font-size: 12px !important;
    }

    .pick-list-col-button-header {
        width: 77px; 
        margin-left: 5px; 
        background-color: #b2b1b1c7 !important; 
        border: 1px solid;
        border-radius: 7px;
        font-size: 12px !important; 
    }

    .pick-list-col-label-header {
        color: black; font-size: 11px !important; font-weight: 600;
    }

    .pick-list-col-button-sub-header {
        width: 173px; margin-left: 5px; background-color: #C5E1A5; !important; border: 1px solid #43A047;
        border-radius: 7px;
        font-size: 10px !important; 
    }

    .pick-list-col-label-sub-header {
        color: black;
        font-weight: 600;
        font-size: 9px !important;
    }

    .pick-list-td-button-sub-header {
        width: 77px; margin-left: 5px; background-color: #bf360c00; !important; border: 1px solid;
        border-radius: 7px;
        font-size: 10px !important; 
    }

    .pick-list-td-label-sub-header {
        color: black;
        font-size: 9px !important;
    }
    
</Style>
<!--Page Styles: END-->