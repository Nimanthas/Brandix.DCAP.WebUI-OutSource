@{
Layout = "_Layout";
}
<script type="text/javascript">
    //Declare variable for Models and status
    var isValidClient = Answer.Null;
    var clientconfig = null;
    var userPermissionList = null;   
    var selectedScanOption = ScanOption.Non;
    var selectedTxnMode = TransactionMode.Non;
    var selectedScanAction = Action.Non;
    var selectedFunction = Answer.Null;
    var scannedCount = 0; 
    var scannedStatus = ScannedStatus.Non;
    var isScanCompleted = false; 
    var clientIP = null; 
    var txUser = null;   
    var styleDataSource = null;
    var selectedGroupTag = null;
    var selectedScrapReason = null;
    var selectedDefectOpp = null;
    var selectedWfConfig = null;      
    var selectedGroupTagNo = null;
    var selectedGroupDesc = null;
    var selectedScanCounterId = null;

    var TotalQuantitiy = 0;

    // var selectedScanCounterPO = null;    
    // var selectedScanCounterVal = null; 

    var wfid = null;
    var goodQty = 0;
    var scrapQty = 0;
    var reworkQty = 0;
    var flag = true;

    var validateBarcodeCount = 0;

    var groupTagSearchGrid = null;
    var groupTagSearchWindow = null;
    var scrapReasonSearchGrid = null;
    var scrapReasonSearchWindow = null;
    var poCounterResetWindow = null;
    var tagValidateWindow = null;
    var colorSearchWindow = null;
    var colorSearchGrid = null;
    var scannedBarcode = null;
    var POCounters = null;
    var isValidBarcode = false;  
    var WFDEPInstId = 0;

    var ScanDataBackup = null;
    var tagDataBackup = null;
    var ScanBackupWholeData = null;
    var ValidateAlreadyScannedBarcodes = [];
    var scanMode = 0;

    var sacanComplete = true;
    var errorbeforestauscomplete = null;

    var runningPOCounters = [];
    var lastUpdatedCounterId = null;
    var haltsystem = false;

    var previoushour = null;

    var ScanDataBackupForScanType = null;
    var ScanDataBackupForValidate = null;
    var ProdScanTypeWindow = null;
    var resultView = null;
    var ProdScanType = 0;
    //SMode varables
    //var SMode = 0;
    var sModeQuantitiyWindow = 0;
    var selectedGroupSize = null;
    var tagSizeSearchGrid = null;
    var tagSizeSearchWindow = null;


    //Page Load Event
    $(document).ready(function () {
        $('#main').show();
        getSessionInfo();
        refreshmsgBoxHeaderStyle();
        EnableControllers();
        setClientConfigInfo();
        sacanComplete = true;
        errorbeforestauscomplete = '';

        $('#tagSearchBtn').focus();
        $("#sitebody").append(
            '<div id="ajaxBusy" class="ajaxBusy"></div>'
        );
        $("#ajaxBusy").hide();

        $(document.body).keydown(function (e) {
            if (e.altKey && e.keyCode == 87) {
                $('#groupTagSearchGrid').data("kendoGrid").table.focus();
            }
        });

        $(document).on('keydown', disableFunctionKeys);
        (function blink() {
            $('.blinktext').fadeOut(150).fadeIn(150, blink);
        })();
        $('#pageTitleBar').html('<i class="fas fa-barcode pageMainIcon"></i><span class="pageTitle">DCap - Barcode Scan</span>');

        initializeControlEvents();
        checkLoginStatus();
        checkIdle();
        setPageControlsStartupStatus();
        initializeFunctionKeys();
        populatePermissionList();
        initializeControlers();

        //Enable barcode scan in the begging
        //$("#barcodeBcodeTxt").removeAttr("disabled"); 
        //$("#barcodeBcodeTxt").focus();

        //SMode Divisions
        $("#BarcodeScanRow").show();
        $("#OSQuantitiyRow").hide();
        $("#tagSizes").hide();

        $("#ddlMainOperation").data("kendoDropDownList").dataSource.data([]);  
        $("#groupTag").hide();      
        getOperation();
        setMainOperationVisibility();
        $('#sitebody').removeClass('body-login');
        initilaizeScanOption();
        refresValues();

        if (isValidClient == Answer.Null) {
            window.location.href = "Login";
        } else if (false) {//!userPermissionList.some(permission => permission.functionId === AccessibleFunctions.TravelTagOperationUpdate)
            msgBox.show('සංචාරක ටැග් ක්‍රියාකාරිත්වය යාවත්කාලීන කිරීමට ඔබට අවසර නැත.', 'you dont ave permission to update travel tag operation.', 'අවවාදයයි / Warning', 'BS01', 'Warning', function(){window.location.href = "BFLProductionBarcode";});
        }
        else if (isValidClient != Answer.Null && clientconfig.dataCaptureMode != DataCaptureMode.Washing) {
            msgBox.show('මෙම යන්ත්‍රයට බාර්කෝඩ් ස්කෑන් කිරීම සඳහා අවසර නැත.', 'This device is not authorized for Bar-code Scan.', 'අවවාදයයි / Warning', 'BS01', 'Warning', function () {
                if (clientconfig.dataCaptureMode == DataCaptureMode.Bulk) {
                    window.location.href = "Bulk";
                } else if (clientconfig.dataCaptureMode == DataCaptureMode.Barcode) {
                    window.location.href = "Barcode";
                } else {
                    window.location.href = "BFLProductionBarcode"; 
                }
            });
        }
    });

    function disableFunctionKeys(e) {
        var functionKeys = new Array(112, 113, 114, 115, 117, 118, 119, 120, 121);
        if (functionKeys.indexOf(e.keyCode) > -1 || functionKeys.indexOf(e.which) > -1) {
            e.preventDefault();
        }
    }

    function initializeControlers(){
        $("#finalResultTableData").kendoGrid({
            reorderable: true,
            resizable: true,    
            pageable: true,
            dataSource: {
                schema: {
                    model: {
                        id: "ControlId",
                        fields: {
                            Style: { type: "string", editable: false },
                            Shedule: { type: "string", editable: false },
                            Color: { type: "string", editable: false },
                            PO: { type: "string", editable: false },
                            Size: { type: "string", editable: false },
                            Quantity: { type: "string", editable: false },
                            Status: { type: "string", editable: false },
                            Remark: { type: "string", editable: false }
                        },
                    }
                },
                batch: true,
            },
            toolbar: ["excel"],
            excel: {
                allPages: true,
                fileName: $("#barcodeBcodeTxt").val() + " barcode scan error report - " + (new Date()).toLocaleDateString('en-US', { month: '2-digit', day: '2-digit', year: 'numeric'})  + ".xlsx",
                filterable: true
            },
            columns:[
                        {title:"Style",field:"Style",width:"100px"},
                        {title:"Shedule",field:"Shedule",width:"100px"},
                        {title:"Color",field:"Color",width:"100px"},
                        {title:"PO",field:"PO",width:"100px", hidden: true},
                        {title:"Size",field:"Size",width:"100px"},
                        {title:"Quantity",field:"Quantity",width:"100px"},
                        {title:"Status",field:"Status",width:"165px"},
                        {title:"Remark",field:"Remark",width:"275px"},
                    ],
        });
    }

    function checkLoginStatus() {
        //console.log('Called checkLoginStatus method. IsSignedIn = ' + sessionStorage.getItem("IsSignedIn"));
        if (sessionStorage.getItem("UserId") != "") {
            $("#toolBarLoggedinUser").html(sessionStorage.getItem("UserId"));
        } else {
            $("#toolBarLoggedinUser").html("");
        }
        if (sessionStorage.getItem("IsSignedIn") == Answer.Null || sessionStorage.getItem("IsSignedIn") == Answer.No) {
            $("#loginBar").hide();
            window.location.href = "Login";
        } else {
            $("#loginBar").show();
        }
    }

    function initializeControlEvents() {
        refreshmsgBoxHeaderStyle();

        $('#tagSearchBtn').click(function () {
            if (selectedScanOption != ScanOption.Non) {
                resetControls();
                setPageControlsStartupStatus();
            }

            groupTagSearchWindow = $("#groupTagSearchWindow").kendoWindow({
                width: "80%",
                height: "60%",
                title: "Tag Search",
                actions: [
                    "Close"
                ],
                modal: true,
                resizable: false,
                draggable: false,
                pinned: true,
                activate: function () {
                    $("#groupTagSearchWindowStyleTxt").select();
                },
                close: onGroupTagSearchClose
            }).data("kendoWindow");

            groupTagSearchWindow.wrapper.find('.k-window-titlebar').css({
                'background-color': 'black',
                'font-size': '18px',
                'color': 'white'
            });

            groupTagSearchGrid = $("#groupTagSearchGrid").kendoGrid({
                autoBind: false,
                dataSource: {
                    transport: {
                        read: '@ViewBag.APIURL/Lookup/GetTravelTagHeaderDetails'
                    },
                    schema: {
                        model: {
                            fields: {
                                wfId: { type: "number" },
                                travelBarCodeNo: { type: "string" },
                                sMode: { type: "number" },
                                color: { type: "string" },
                                qty01: { type: "number" },
                            }
                        }
                    },
                    type: "json"
                },
                height: "75%",
                width: "90%",
                scrollable: true,
                change: onChangeGroupTag,
                navigatable: true,
                selectable: "multiple cell",
                dataBound: function (e) {
                    var cell = this.tbody.find("tr[role='row'] td:first");
                    this.current(cell);
                },
                columns: [
                    { field: "wfId", title: "wfId", width: "60%", hidden: true },
                    { field: "sMode", title: "sMode", width: "60%", hidden: true },
                    { field: "travelBarCodeNo", title: "Tag No", width: "30%" },
                    { field: "color", title: "Color", width: "60%" },
                    { field: "qty01", title: "qty01", width: "10%" }
                ]
            }).data("kendoGrid");

            var arrows = [38, 40];
            groupTagSearchGrid.table.on("keydown", function (e) {
                if (arrows.indexOf(e.keyCode) >= 0) {
                    setTimeout(function () {
                        groupTagSearchGrid.select($("#rowSelection_active_cell").closest("tr"));
                    }, 10);
                }
            });

            groupTagSearchWindow.one("activate", function () {
                groupTagSearchGrid.resize();
            });
            groupTagSearchWindow.open().center();
            $("#groupTagSearchWindowStyleTxt").keydown(function (e) {
                if (e.keyCode == 13) {
                    groupTagSearchGrid.table.focus();
                }
            });
        });

        $('#tagSizeBtn').click(function () {
            if (selectedScanOption != ScanOption.Non) {
                //resetControls();
                //setPageControlsStartupStatus();
            }

            tagSizeSearchWindow = $("#tagSizeSearchWindow").kendoWindow({
                width: "80%",
                height: "60%",
                title: "Tag Size Search",
                actions: [
                    "Close"
                ],
                modal: true,
                resizable: false,
                draggable: false,
                pinned: true,
                activate: function () {
                    $("#tagSizeSearchWindowStyleTxt").select();
                },
                close: onGroupTagSizeSearchClose
            }).data("kendoWindow");

            tagSizeSearchWindow.wrapper.find('.k-window-titlebar').css({
                'background-color': 'black',
                'font-size': '18px',
                'color': 'white'
            });

            tagSizeSearchGrid = $("#tagSizeSearchGrid").kendoGrid({
                autoBind: true,
                dataSource: {
                    transport: {
                        read: '@ViewBag.APIURL/Lookup/GetTravelTagSizeDetailsOutSource?traveltagId=' + selectedGroupTag.travelBarCodeNo,
                    },
                    schema: {
                        model: {
                            fields: {
                                l1id: { type: "number" },
                                l2id: { type: "number" },
                                l3id: { type: "number" },
                                l4id: { type: "number" },
                                l5id: { type: "number" },
                                l5no: { type: "string" },
                                l5desc: { type: "string" },
                            }
                        }
                    },
                    type: "json"
                },
                height: "75%",
                width: "90%",
                scrollable: true,
                change: onChangeTagSize,
                navigatable: true,
                selectable: "multiple cell",
                dataBound: function (e) {
                    var cell = this.tbody.find("tr[role='row'] td:first");
                    this.current(cell);
                },
                columns: [
                    { field: "l1id", title: "l1id", width: "60%", hidden: true },
                    { field: "l2id", title: "l2id", width: "60%", hidden: true },
                    { field: "l3id", title: "l3id", width: "60%", hidden: true },
                    { field: "l4id", title: "l4id", width: "60%", hidden: true },
                    { field: "l5id", title: "l5id", width: "60%", hidden: true },
                    { field: "l5no", title: "Size No.", width: "40%" },
                    { field: "l5desc", title: "Size Description", width: "60%" }
                ]
            }).data("kendoGrid");

            var arrows = [38, 40];
            tagSizeSearchGrid.table.on("keydown", function (e) {
                if (arrows.indexOf(e.keyCode) >= 0) {
                    setTimeout(function () {
                        tagSizeSearchGrid.select($("#rowSelection_active_cell").closest("tr"));
                    }, 10);
                }
            });

            tagSizeSearchWindow.one("activate", function () {
                tagSizeSearchGrid.resize();
            });
            tagSizeSearchWindow.open().center();
            $("#tagSizeSearchWindowStyleTxt").keydown(function (e) {
                if (e.keyCode == 13) {
                    tagSizeSearchGrid.table.focus();
                }
            });
        });

        $("#scrapReasonSearchBtn").click(function () {
            scrapReasonSearchWindow = $("#scrapReasonSearchWindow").kendoWindow({
                width: "80%",
                height: "60%",
                title: "Scrap Reason Search",
                visible: false,
                actions: [
                    "Close"
                ],
                modal: true,
                resizable: false,
                draggable: false,
                pinned: true,
                activate: function () {
                    $("#scrapReasonSearchWindowScrapTxt").select();
                },
                open: function (e) { $("html, body").css("overflow", "hidden"); },
                close: onScrapReasonSearchClose
            }).data("kendoWindow");

            scrapReasonSearchWindow.wrapper.find('.k-window-titlebar').css({
                'background-color': 'black',
                'font-size': '18px',
                'color': 'white'
            });

            scrapReasonSearchGrid = $("#scrapReasonSearchGrid").kendoGrid({
                autoBind: true,
                dataSource: {
                    transport: {
                        read: {
                            url: '@ViewBag.APIURL/Lookup/GetRejectReasonsBFL',
                            type: 'GET',
                            dataType: 'json',
                            async: false,
                            contentType: 'application/json; charset=utf-8'
                        }
                    },
                    schema: {
                        model: {
                            fields: {
                                rrid: { type: "string" },
                                scode: { type: "string" },
                                rrname: { type: "string" },
                                rrdesc: { type: "string" },
                                rrdescSin: { type: "string" },
                                rrdescTem: { type: "string" }
                            }
                        }
                    }
                },
                height: "75%",
                width: "90%",
                scrollable: true,
                change: onChangeScrapReason,
                navigatable: true,
                selectable: "multiple cell",
                dataBound: function (e) {
                    var cell = this.tbody.find("tr[role='row'] td:first");
                    this.current(cell);
                },
                columns: [
                    { field: "rrid", title: "Scrap Reason Id", hidden: true },
                    { field: "scode", title: "Short Code", width: "20%" },
                    { field: "rrname", title: "Scrap Reason Name", width: "20%" },
                    { field: "rrdesc", title: "Scrap Reason Description", width: "20%" },
                    { field: "rrdescSin", title: "Scrap Reason Sin", width: "20%" },
                    { field: "rrdescTem", title: "Scrap Reason Tam", width: "20%" }
                ]
            }).data("kendoGrid");

            var arrows = [38, 40];
            scrapReasonSearchGrid.table.on("keydown", function (e) {
                if (arrows.indexOf(e.keyCode) >= 0) {
                    setTimeout(function () {
                        scrapReasonSearchGrid.select($("#rowSelection_active_cell").closest("tr"));
                    }, 10);
                }
            });

            scrapReasonSearchWindow.one("activate", function () {
                scrapReasonSearchGrid.resize();
            });
            scrapReasonSearchWindow.open().center();
            $("#scrapReasonSearchWindowScrapTxt").keydown(function (e) {
                if (e.keyCode == 13) {
                    scrapReasonSearchGrid.table.focus();
                }
            });

            if(selectedScrapReason == null) {
                $("#trxModeReworkBtn").attr("disabled", "disabled");
                $("#trxModeGoodBtn").attr("disabled", "disabled");
            }

        });
        //Added following function //Nalinda
        // Rework Reason selection pannel 
        $("#reworkReasonSearchBtn").click(function () {
            defectOppSearchWindow = $("#defectOppSearchWindow").kendoWindow({
                width: "90%",
                height: "80%",
                title: "Defect Operation Search",
                visible: false,
                actions: [
                    "Close"
                ],
                modal: true,
                resizable: false,
                draggable: false,
                pinned: true,
                activate: function () {
                    $("#defectOppSearchWindowTxt").select();
                },
                open: function (e) { $("html, body").css("overflow", "hidden"); },
                close: onDefectOppsSearchClose
            }).data("kendoWindow");

            defectOppSearchWindow.wrapper.find('.k-window-titlebar').css({
                'background-color': 'red',
                'font-size': '18px',
                'color': 'white'
            });

            // GetDefectOpps();
            defectOppSearchGrid = $("#defectOppSearchGrid").kendoGrid({
                autoBind: true,
                dataSource: {
                    transport: {
                        read: {
                            url: '@ViewBag.APIURL/Lookup/GetDefectOperatiosBFL?operationCode=' + clientconfig.opCode1,
                            type: 'GET',
                            dataType: 'json',
                            async: false,
                            contentType: 'application/json; charset=utf-8'
                        }
                    },
                    schema: {
                        model: {
                            fields: {
                                dopsId: { type: "string" },
                                dopsScode: { type: "string" },
                                dopsName: { type: "string" },
                                dopsDesc: { type: "string" }
                            }
                        }
                    }
                },
                height: "80%",
                width: "90%",
                scrollable: true,
                change: onChangeDefectOpps,
                navigatable: true,
                selectable: "multiple cell",
                dataBound: function (e) {
                    var cell = this.tbody.find("tr[role='row'] td:first");
                    this.current(cell);
                },
                columns: [
                    { field: "dopsId", title: "Defect Opp Id", hidden: true },
                    { field: "dopsScode", title: "Short Code", width: "20%" },
                    { field: "dopsName", title: "Defect Opp Name", width: "20%" },
                    { field: "dopsDesc", title: "Defect Opp Description", width: "20%" }
                ]
            }).data("kendoGrid");

            var arrows = [38, 40];
            defectOppSearchGrid.table.on("keydown", function (e) {
                if (arrows.indexOf(e.keyCode) >= 0) {
                    setTimeout(function () {
                        defectOppSearchGrid.select($("#rowSelection_active_cell").closest("tr"));
                    }, 10);
                }
            });

            defectOppSearchWindow.one("activate", function () {
                defectOppSearchGrid.resize();
            });
            defectOppSearchWindow.open().center();
            $("#defectOppSearchWindowTxt").keydown(function (e) {
                if (e.keyCode == 13) {
                    defectOppSearchGrid.table.focus();
                }
            });

            if(selectedScrapReason == null) {
                $("#trxModeScrapBtn").attr("disabled", "disabled");
                $("#trxModeGoodBtn").attr("disabled", "disabled");
            }
        });

        //Tags are searched in Tag Search window on the fly
        $("#groupTagSearchWindowStyleTxt").keyup(function () {
            $('#barcodeBcodeTxt').val("");
            if ($("#groupTagSearchWindowStyleTxt").val().length > 0) {
                groupTagSearchGrid.dataSource.read({ traveltagId: $("#groupTagSearchWindowStyleTxt").val(), opcode: clientconfig.opCode1 });
            } else {
                groupTagSearchGrid.dataSource.data([]);
            }
        });

        //Tags are searched in Tag Search window on the fly
        $("#tagSizeSearchWindowStyleTxt").keyup(function () {
            $('#barcodeBcodeTxt').val("");
            if ($("#tagSizeSearchWindowStyleTxt").val().length > 0) {
                tagSizeSearchGrid.dataSource.read({ sizeno: $("#tagSizeSearchWindowStyleTxt").val() });
            } else {
                tagSizeSearchGrid.dataSource.data([]);
            }
        });

        //Scrap reason are searched in Scrap reason key change
        $("#scrapReasonSearchWindowScrapTxt").keyup(function () {
            scrapReasonSearchGrid.dataSource.read({ RRCode: $("#scrapReasonSearchWindowScrapTxt").val() });
        });

        //Rework reason are searched in Rework reason key change
        $("#reworkReasonSearchWindowScrapTxt").keyup(function () {
            reworkReasonSearchGrid.dataSource.read({ SCode: $("#reworkReasonSearchWindowScrapTxt").val() });
            $("#ddlScrapReason").data("kendoDropDownList").text("");
        });

        //Defect Operation are searched in Defect Operation key change
        $("#defectOppSearchWindowTxt").keyup(function () {
            defectOppSearchGrid.dataSource.read({ DOpsSCode: $("#defectOppSearchWindowTxt").val() });
        });

        $("#barcodeBcodeTxt").keydown(function (e) {
            if (e.keyCode == 13) {
                if ($('#barcodeBcodeTxt').val() != ""){
                    checkBarcodeIsValid();
                    return;         
                }   
            }
        });

        $("#quantitiyTxt").keydown(function (e) {
            if (e.keyCode == 13) {
                if ($('#quantitiyTxt').val() != ""){
                    checkQuantitiyIsValid();
                    return;         
                }   
            }
        });

        $("#sModeRejectedQtyTxt").keydown(function (e) {
            if (e.keyCode == 13) {
                if ($('#sModeRejectedQtyTxt').val() != ""){
                    setSModeRejectQuantitiy();
                    return;         
                }   
            }
        });

        $('#trxModeGoodBtn').click(function () {
            
            $('#divScrapReason').hide();
            $("#barcodeScrapReasonTxt").val("");
            selectedScrapReason = null;
            selectedDefectOpp = null;
            selectedTxnMode = TransactionMode.Non;
            
            selectTrxModeGood();
            
            if (selectedScanOption == ScanOption.After && isValidBarcode) {
                updateBarcodeScan();
                return;
            }
            if (selectedScanOption == ScanOption.Continue) {
                $("#barcodeBcodeTxt").removeAttr("disabled");
                $("#barcodeBcodeTxt").focus();
                return;
            }
        });

        $('#trxModeScrapBtn').click(function () {

            if (selectedScanOption == ScanOption.After && isValidBarcode) {
                if (selectedScanAction == Action.Reverse) {
                    selectTrxModeScrap();
                    updateBarcodeScan();
                    return;
                } else if (selectedTxnMode == TransactionMode.Scrap && selectedScrapReason != null) {
                    updateBarcodeScan();
                    return;
                }
            }
            
            selectTrxModeScrap();

            if (selectedScanOption == ScanOption.Continue) {
                $("#barcodeBcodeTxt").focus();
                if ($("#barcodeBcodeTxt").val() != "" && selectedScanAction != Action.Reverse) {
                    checkBarcodeIsValid();
                }
            }
        });

        //When Rework button clicked
        $('#trxModeReworkBtn').click(function () {
            
            if (selectedScanOption == ScanOption.After && isValidBarcode) {
                if (selectedScanAction == Action.Reverse) {
                    selectTrxModeRework();
                    updateBarcodeScan();
                    return;
                } else if (selectedTxnMode == TransactionMode.Rework && selectedScrapReason != null) {
                    updateBarcodeScan();
                    return;
                }
            }

            selectTrxModeRework();

            if (selectedScanOption == ScanOption.Continue) {
                $("#barcodeBcodeTxt").removeAttr("disabled");
                $("#barcodeBcodeTxt").focus();
                return;
            }
        });


        $('#scanActionAddBtn').click(function () {
            selectActionAdd();
            if (selectedScanOption == ScanOption.Continue) {
                $("#barcodeBcodeTxt").removeAttr("disabled");
                $("#barcodeBcodeTxt").focus();
                return;
            }
        });

        $('#scanActionReverseBtn').click(function () {
            selectActionReverse();
            if (selectedScanOption == ScanOption.Continue) {
                $("#barcodeBcodeTxt").removeAttr("disabled");
                $("#barcodeBcodeTxt").focus();
                return;
            }
        });

        $('#resetBtn').click(function () {
            resetControls();
            $('#lastBarcodeDataLabel').html("");
            $('#lastTxMode').html("");
            $('#lastAction').html("");
            $('#scannedStatusDataLabel').html("");
        });

        $('#resetCounterBtn').click(function () {
            //console.log('Calling ResetCounter API by wfdepinstId:' + clientconfig.wfdepinstId);
            $.ajax({
                url: '@ViewBag.APIURL/BusinessLogics/ResetCounter?wfdepinstId=' + clientconfig.wfdepinstId,
                type: 'POST',
                dataType: 'json',
                async: false,
                contentType: 'application/json; charset=utf-8',
                beforeSend: function () {
                    $("#ajaxBusy").show();
                },
                complete: function () {
                    $("#ajaxBusy").hide();
                },
                success: function (date) {
                    //console.log('Calling ResetCounter API succeded.');
                    $('#dataLabelScanCounter').html("0");
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    formatErrorMessage(jqXHR, errorThrown, "BFLProductionBarcode");
                }
            });
        });

        var data = [];
        $("#ddlMainOperation").kendoDropDownList({
            dataTextField: "text",
            dataValueField: "value",
            dataSource: data,
            index: 0,

        });

        //PO Counter Bag Controllers: START
        $('#BAGBtnClear').click(function () {
            DisableInputs()
            var validation = false;
            var bagqty = parseInt($("#bagSizeTxt").val());
            var currentqty = parseInt($("#currentQuantityNumber").html());

            //console.log(bagqty, currentqty);
            if (Number.isInteger($('#bagSizeTxt').val())) {
                msgBox.show('නීති විරෝධී අක්ෂර.', 'Illegal characters in path. (Bag Size)', 'අවවාදයයි / Warning', 'BS13', 'Warning', function () {
                $('#bagSizeTxt').focus();
                validationSuccess = false;
                $("#BAGBtnReset").removeAttr('disabled');
                });
                return;
            }
            

            if(bagqty > currentqty) {
                msgBoxConfirm.show('ඔබට පුරවා නැති Buddy Tagය වසා දැමීමට අවශ්‍යද?.',
                                'Do you want to close the unfilled buddy tag.',
                                'තහවුරු කරන්න / Confirm',
                                'BS24',
                                'Confirm',
                                function () { 
                                        closeTheBag();
                                        validation = true;
                                        EnableInputs();
                                    },
                                function () { 
                                    validation = false;
                                    EnableInputs();
                                    return;
                                });

            } else if(0 >= currentqty) {
                msgBox.show('බෑගයේ ප්‍රමාණය 0 විය. කරුණාකර පරීක්ෂා කරන්න.','The bag quantity was 0. Please check.','තහවුරු කරන්න / Confirm','BS24','Confirm',null);
            } else {
                closeTheBag();
                EnableInputs();
            }
        });

        $('#BAGBtnReset').click(function () {
            DisableInputs();
            var bagqty = parseInt($("#bagSizeTxt").val());

            if(isNaN($("#bagSizeTxt").val())) {
                msgBox.show('නීති විරෝධී අක්ෂර.', 'Illegal characters in path. (Bag Size)', 'අවවාදයයි / Warning', 'BS13', 'Warning', function () {
                $('#bagBarcodeBcodeTxt').focus();
                validationSuccess = false;
                $("#BAGBtnReset").removeAttr('disabled');
                });
                return;
            }

            var bagbarcode = $("#bagBarcodeBcodeTxt").val();

            if(isNaN($("#bagBarcodeBcodeTxt").val())) {
                msgBox.show('නීති විරෝධී අක්ෂර.', 'Illegal characters in path. (Bag Barcode)', 'අවවාදයයි / Warning', 'BS13', 'Warning', function () {
                $('#bagBarcodeBcodeTxt').focus();
                validationSuccess = false;
                $("#BAGBtnReset").removeAttr('disabled');
                });
                return;
            }

            var currentqty = parseInt($("#currentQuantityNumber").html());
            var cutqty = $("#cutQuantityTxt").html() == "-" ? "-" : parseInt($("#cutQuantityTxt").html());

            if ($("#CounterID").html() == "new counter") {
                currentqty = 0;
            }
            //console.log("QUANTITES for bag: ", bagqty, currentqty, cutqty);

            if(true) {//(cutqty != "-" ? bagqty <= cutqty : true)
                if(bagqty > currentqty) {
                    var UserInList = [];
                    var validationSuccess = true;
                    if( selectedScanCounterId == "new counter" ){
                        if (bagbarcode == "") {
                            msgBox.show('කරුණාකර තීරු කේතය ඇතුළත් කරන්න.', 'Please enter the barcode.', 'අවවාදයයි / Warning', 'BS13', 'Warning', function () {
                            $('#bagBarcodeBcodeTxt').focus();
                            validationSuccess = false;
                            $("#BAGBtnReset").removeAttr('disabled');
                            });
                            return;
                        }
                        if (bagqty == "" || bagqty == 0) {
                            msgBox.show('කරුණාකර නිවැරදි බෑග් ප්‍රමාණය ඇතුළත් කරන්න.', 'bag size error.', 'අවවාදයයි / Warning', 'BS13', 'Warning', function () {
                            $('#bagBarcodeBcodeTxt').focus();
                            validationSuccess = false;
                            $("#BAGBtnReset").removeAttr('disabled');
                            });
                            return;
                        }

                        var isbarcodevalid = checkForBagBarcodeExistence();
                        if(isbarcodevalid == false) {
                            msgBox.show('Buddy තීරු කේතය දැනටමත් භාවිතා කර ඇත.', 'The budy barcode is already in used.', 'අවවාදයයි / Warning', 'BS13', 'Warning', function () {
                            $('#bagBarcodeBcodeTxt').focus();
                            validationSuccess = false;
                            $("#BAGBtnReset").removeAttr('disabled');
                            });
                            return;
                        }

                        if(validationSuccess){
                            ScanDataBackup.BagBarCodeNo = $("#bagBarcodeBcodeTxt").val();
                            ScanDataBackup.BagSize = $("#bagSizeTxt").val();
                            ScanDataBackup.CounterNumber = $("#counterNumber").val();

                            var UserInList = [];
                            UserInList.push(ScanDataBackup);

                            if(poCounterResetWindow != null) {
                                poCounterResetWindow.close();}
                            EnableInputs();

                            sentToDCAPdb(UserInList);
                            
                        }
                    }
                    else {
                        if(bagbarcode != null && bagbarcode != "") {
                            var BagSize = $("#bagSizeTxt").val();
                            var counterNumber = $("#counterNumber").val();
                            var validationSuccess = true;
                            //console.log(BagSize, counterNumber,Number.isInteger(BagSize));
                            if (BagSize == "" || BagSize == 0) {
                                msgBox.show('කරුණාකර නිවැරදි බෑග් ප්‍රමාණය ඇතුළත් කරන්න.', 'bag size error.', 'අවවාදයයි / Warning', 'BS13', 'Warning', function () {
                                $('#bagSizeTxt').focus();
                                validationSuccess = false;
                                $("#BAGBtnReset").removeAttr('disabled');
                                });
                                return;
                            }

                            if(validationSuccess){
                                resetTheBag(BagSize, bagbarcode);
                                haltsystem = false;
                            }
                        } else {
                            msgBox.show('බෑග් තීරු කේතය වලංගු එකක් නොවේ.', 'The bag barcode is not a valid one. allocation failed.', 'අවවාදයයි / Warning', 'BS13', 'Warning', null)
                            $("#BAGBtnReset").removeAttr('disabled'); 
                        }
                    }
                } else {
                    msgBox.show('නිර්වචනය කරන ලද බෑග් ප්‍රමාණ වත්මන් ප්‍රමාණයට වඩා අඩුය. වෙන් කිරීම අසාර්ථක විය.', 'Defined bag quantitiy is less than current quantitiy. allocation failed.', 'අවවාදයයි / Warning', 'BS13', 'Warning', null)
                    $("#BAGBtnReset").removeAttr('disabled');
                }
            } else {
                msgBox.show('නිර්වචනය කරන ලද බෑග් ප්‍රමාණය මැහුම් ප්‍රමාණවලට වඩා වැඩිය. වෙන් කිරීම අසාර්ථක විය.', 'Defined bag quantitiy is greater than sweing wip quantitiy. allocation failed.', 'අවවාදයයි / Warning', 'BS13', 'Warning', null)
                 $("#BAGBtnReset").removeAttr('disabled');
            }
        });
        //PO Counter Bag Controllers: END

        $('#POBtnClear').click(function () {
            DisableInputs()
            msgBoxConfirm.show('ඔබට මෙම කවුන්ටරය වැසීමට අවශ්‍යද ?.',
                                'Do you want to close this counter ?.',
                                'තහවුරු කරන්න / Confirm',
                                'BS24',
                                'Confirm',
                                function () { 
                                        $.ajax({
                                            url: '@ViewBag.APIURL/BusinessLogics/UpdatePOCounterForPO?CounterId=' + $("#CounterID").html() + '&Action=1&WfdepinstId=' + clientconfig.wfdepinstId,
                                            type: 'POST',
                                            dataType: 'json',
                                            async: false,
                                            contentType: 'application/json; charset=utf-8',
                                            beforeSend: function () {
                                                $("#ajaxBusy").show();
                                            },
                                            complete: function () {
                                                $("#ajaxBusy").hide();
                                            },
                                            success: function (response) {
                                                //console.log('Calling Remove PO Counter API succeded.');
                                                if(!response){
                                                    msgBox.show('වෙන් කිරීම අසාර්ථක විය.', 'Update failed.', 'අවවාදයයි / Warning', 'BS13', 'Warning', null)
                                                }
                                                if(poCounterResetWindow != null) {
                                                    poCounterResetWindow.close();}
                                                EnableInputs();
                                                loadPOcounterValues();
                                            },
                                            error: function (jqXHR, textStatus, errorThrown) {
                                                formatErrorMessage(jqXHR, errorThrown, "BFLProductionBarcode");
                                            }
                                        });
                                    },
                                function () { 
                                    EnableInputs();
                                    return;
                                });
        });

        $('#POBtnReset').click(function () {
            DisableInputs();
            $.ajax({
                url: '@ViewBag.APIURL/BusinessLogics/UpdatePOCounterForPO?CounterId=' + $("#CounterID").html() + '&Action=2&WfdepinstId=' + clientconfig.wfdepinstId,
                type: 'POST',
                dataType: 'json',
                async: false,
                contentType: 'application/json; charset=utf-8',
                beforeSend: function () {
                    $("#ajaxBusy").show();
                },
                complete: function () {
                    $("#ajaxBusy").hide();
                },
                success: function (response) {
                    //console.log('Calling Remove PO Counter API succeded.');
                    if(!response){
                        msgBox.show('වෙන් කිරීම අසාර්ථක විය.', 'Update failed.', 'අවවාදයයි / Warning', 'BS13', 'Warning', null)
                    }
                    if(poCounterResetWindow != null) {
                        poCounterResetWindow.close();}
                        EnableInputs();
                        loadPOcounterValues();
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    formatErrorMessage(jqXHR, errorThrown, "BFLProductionBarcode");
                }
            });
        });

        //On Bag Barcode value set
        $("#bagBarcodeBcodeTxt").keydown(function (e) {
            if (e.keyCode == 13) {
                $("#bagBarcodeBcodeTxt").attr('disabled', 'disabled');
                $("#bagSizeTxt").focus();
                $("#bagSizeTxt").select();
            }
        });

        $("#validateBarcodeBcodeTxt").keydown(function (e) {
            if (e.keyCode == 13) {
                scanValidateBarcodeTxt();
            }
        });

        $("#tagScanOk").removeAttr("disabled");
        $("#tagScanOk").attr("disabled", "disabled");
    }

    function initializeFunctionKeys() {
        shortcut.add("F1", function () {

            if (selectedScanOption == ScanOption.After && isValidBarcode && (selectedTxnMode == TransactionMode.Good || selectedTxnMode == 0)) {
                selectTrxModeGood();
                updateBarcodeScan();
            }
            else if (selectedScanOption == ScanOption.Continue) {
                if (selectedScrapReason != null && selectedTxnMode != null && selectedTxnMode == TransactionMode.Scrap) {
                    return;
                }
                selectTrxModeGood();
                $("#barcodeBcodeTxt").focus();
            }
        });
        shortcut.add("F2", function () {

            if (selectedScanOption == ScanOption.After && isValidBarcode && (selectedTxnMode == TransactionMode.Scrap || selectedTxnMode == 0)) {
                selectTrxModeScrap();
                updateBarcodeScan();
            }
            else if (selectedScanOption == ScanOption.Continue) {
                selectTrxModeScrap();
                $("#barcodeBcodeTxt").focus();
                if ($("#barcodeBcodeTxt").val() != "" && selectedScanAction != Action.Reverse) {
                    checkBarcodeIsValid();
                }
            }

        });
        shortcut.add("F3", function () {

            if (selectedScanOption == ScanOption.After && isValidBarcode && (selectedTxnMode == TransactionMode.Rework || selectedTxnMode == 0)) {
                selectTrxModeRework();
                updateBarcodeScan();
            }
            else if (selectedScanOption == ScanOption.Continue) {
                selectTrxModeRework();
                $("#barcodeBcodeTxt").focus();
                if ($("#barcodeBcodeTxt").val() != "" && selectedScanAction != Action.Reverse) {
                    checkBarcodeIsValid();
                }
            }
        });
        shortcut.add("F5", function () {
            selectActionAdd();
            if (selectedScanOption == ScanOption.Continue) {
                $("#barcodeBcodeTxt").focus();
            }
        });
        shortcut.add("F6", function () {
            selectActionReverse();
            if (selectedScanOption == ScanOption.Continue) {
                $("#barcodeBcodeTxt").focus();
            }
        });
        shortcut.add("F10", function () {
            $('#resetBtn').trigger('click');
        });
    }

    function initializeDivisons() {

        if(selectedWfConfig.poCounterEnable == 1){
            $("#pocounterdiv").show();
        } else {
           $("#pocounterdiv").hide(); 
        }

        if(selectedWfConfig.poCounterNumber == 0) {
            $("#bagbarcode-row").hide();
            $("#bagqty-row").hide();

            $("#pocounter-action-buttons").show();
            $("#bagcounter-action-buttons").hide();
        } else {
            $("#bagbarcode-row").show();
            $("#bagqty-row").show();

            $("#pocounter-action-buttons").hide();
            $("#bagcounter-action-buttons").show();
        }
    }

    function selectScanMode(n) {
        scanMode = n; //0 = bulk, 1 = individual
        //console.log(n);

        if(scanMode == 0) {
            $("#groupTag").hide();
            selectedGroupTag != null
            sModeTagSelectDivisionRender(null);
            GetClientByWF((clientconfig.wfid == undefined ? clientconfig.wfId : clientconfig.wfid), scanMode);
            resetControls();
            setPageControlsStartupStatus();
            //refresValues();
        } else {
            $("#groupTag").show();
            selectedGroupTag != null
            sModeTagSelectDivisionRender(null);
            GetClientByWF((clientconfig.wfid == undefined ? clientconfig.wfId : clientconfig.wfid), scanMode);
            resetControls();
            setPageControlsStartupStatus();
        }
    }

    function initilaizeScanOption() {
        $("#garmentSelectDiv").hide();
        $("#bulkSelectDiv").hide();

        if ((userPermissionList.some(permission => permission.functionId === AccessibleFunctions.ScrapAdd)) ||
                (userPermissionList.some(permission => permission.functionId === AccessibleFunctions.ScrapReverse))
            ) {
                $("#garmentSelectDiv").show();
                $("input:radio[name=radio1]")[1].checked = true;
                //selectScanMode(1); //0 = bulk, 1 = individual
            }
        if ((userPermissionList.some(permission => permission.functionId === AccessibleFunctions.ReworkAdd)) ||
                (userPermissionList.some(permission => permission.functionId === AccessibleFunctions.ReworkReverse))
            ) {
                $("#garmentSelectDiv").show();
                $("input:radio[name=radio1]")[1].checked = true;
                //selectScanMode(1); //0 = bulk, 1 = individual
            }
        if ((userPermissionList.some(permission => permission.functionId === AccessibleFunctions.GoodAdd)) ||
            (userPermissionList.some(permission => permission.functionId === AccessibleFunctions.GoodReverse))
            ) {
                $("#bulkSelectDiv").show();
                $("bulk").attr('checked','ckecked');
                $("input:radio[name=radio1]")[0].checked = true;
                //selectScanMode(0); //0 = bulk, 1 = individual
            }
    }

    function selectTrxModeGood() {
        refreshmsgBoxHeaderStyle();
        if (scanMode == 1) //0 = bulk, 1 = individual
            return;

        if ($('#divScrapReason').is(':visible'))
            scrapReasonSearchWindow.close();

        if (selectedScanOption == ScanOption.After) {
            if ((userPermissionList.some(permission => permission.functionId === AccessibleFunctions.GoodAdd)) ||
                (userPermissionList.some(permission => permission.functionId === AccessibleFunctions.GoodReverse))
            ) {
                selectedTxnMode = TransactionMode.Good;
                $('#trxModeGoodBtn').addClass('bs-buttonPressed-good');
                $('#trxModeScrapBtn').removeClass('bs-buttonPressed-scrap');
                $('#trxModeReworkBtn').removeClass('bs-buttonPressed-rework');
            }
            else {
                msgBox.show('ඔබට ගුඩ් ස්කෑන් කිරීම සඳහා අවසර නැත.', 'You do not have permission for scanning "Good".', 'අවවාදයයි / Warning', 'BS02', 'Warning', null);
            }
            return;
        }

        if (selectedScanOption == ScanOption.Continue) {
            if ((userPermissionList.some(permission => permission.functionId === AccessibleFunctions.GoodAdd)) ||
                (userPermissionList.some(permission => permission.functionId === AccessibleFunctions.GoodReverse))
            ) {
                selectedTxnMode = TransactionMode.Good;
                $('#trxModeGoodBtn').addClass('bs-buttonPressed-good');
                $('#trxModeScrapBtn').removeClass('bs-buttonPressed-scrap');
                $('#trxModeReworkBtn').removeClass('bs-buttonPressed-rework');
                $("#barcodeBcodeTxt").removeAttr("disabled");
                $("#barcodeBcodeTxt").focus();
            }
            else {
                msgBox.show('ඔබට ගුඩ් ස්කෑන් කිරීම සඳහා අවසර නැත.', 'You do not have permission for scanning "Good".', 'අවවාදයයි / Warning', 'BS03', 'Warning', null);
            }
            return;
        }
    }

    function selectTrxModeScrap() {
        refreshmsgBoxHeaderStyle();
        if (scanMode == 0) //0 = bulk, 1 = individual
           return;

        $('#scrapReasonLabel').html('Scrap Reason :');
        $('#scrapReasonSearchBtn').show();
        $('#reworkReasonSearchBtn').hide();
        

        if (selectedScanOption == ScanOption.After) {
            if ((userPermissionList.some(permission => permission.functionId === AccessibleFunctions.ScrapAdd)) ||
                (userPermissionList.some(permission => permission.functionId === AccessibleFunctions.ScrapReverse))
            ) {
                $('#trxModeScrapBtn').addClass('bs-buttonPressed-scrap');
                $('#trxModeGoodBtn').removeClass('bs-buttonPressed-good');
                $('#trxModeReworkBtn').removeClass('bs-buttonPressed-rework');
                $("#barcodeScrapReasonTxt").val("");

                if (selectedScrapReason == null && selectedScanAction != Action.Reverse) {
                    $('#divScrapReason').show();
                    $('#scrapReasonSearchBtn').trigger('click');
                }

                if (selectedScrapReason != null && selectedTxnMode != TransactionMode.Scrap && selectedScanAction != Action.Reverse) {
                    $('#divScrapReason').show();
                    $('#scrapReasonSearchBtn').trigger('click');
                }

                selectedTxnMode = TransactionMode.Scrap;
            }
            else {
                msgBox.show('ඔබට ස්ක්‍රැප් ස්කෑන් කිරීම සඳහා අවසර නැත.', 'You do not have permission for scanning "Scrap".', 'අවවාදයයි / Warning', 'BS04', 'Warning', null);
            }
        }
        else if (selectedScanOption == ScanOption.Continue) {
            if ((userPermissionList.some(permission => permission.functionId === AccessibleFunctions.ScrapAdd)) ||
                (userPermissionList.some(permission => permission.functionId === AccessibleFunctions.ScrapReverse))
            ) {
                $('#trxModeScrapBtn').addClass('bs-buttonPressed-scrap');
                $('#trxModeGoodBtn').removeClass('bs-buttonPressed-good');
                $('#trxModeReworkBtn').removeClass('bs-buttonPressed-rework');
                $("#barcodeScrapReasonTxt").val("");
                selectedTxnMode = TransactionMode.Scrap;
            }
            else {
                msgBox.show('ඔබට ස්ක්‍රැප් ස්කෑන් කිරීම සඳහා අවසර නැත.', 'You do not have permission for scanning "Scrap".', 'අවවාදයයි / Warning', 'BS05', 'Warning', null);
            }
        }
    }

    function selectTrxModeRework() {
        refreshmsgBoxHeaderStyle();
        if (scanMode == 0)
           return;
        
        $('#scrapReasonLabel').html('Rework Reason :');
        $('#scrapReasonSearchBtn').hide();
        $('#reworkReasonSearchBtn').show();

        if (selectedScanOption == ScanOption.After) {
            if ((userPermissionList.some(permission => permission.functionId === AccessibleFunctions.ReworkAdd)) ||
                (userPermissionList.some(permission => permission.functionId === AccessibleFunctions.ReworkReverse))
            ) {
                //If not already clicked, set the current trx mode to Rework
                //selectedTxnMode = TransactionMode.Rework;

                //Change trx Mode buttons clicked/unclicked styling effect
                $('#trxModeReworkBtn').addClass('bs-buttonPressed-rework');
                $('#trxModeGoodBtn').removeClass('bs-buttonPressed-good');
                $('#trxModeScrapBtn').removeClass('bs-buttonPressed-scrap');

                if (selectedScrapReason == null && selectedScanAction != Action.Reverse) {
                    $('#divScrapReason').show();
                    $('#reworkReasonSearchBtn').trigger('click');
                }

                if (selectedScrapReason != null && selectedTxnMode != TransactionMode.Rework && selectedScanAction != Action.Reverse) {
                    $('#divScrapReason').show();
                    $('#reworkReasonSearchBtn').trigger('click');
                }

                selectedTxnMode = TransactionMode.Rework;
            }
            else {
                msgBox.show('ඔබට රීවර්ක් ස්කෑන් කිරීම සඳහා අවසර නැත.', 'You do not have permission for scanning "Rework".', 'අවවාදයයි / Warning', 'BS06', 'Warning', null);
            }
        }
        else if (selectedScanOption == ScanOption.Continue) {
            if ((userPermissionList.some(permission => permission.functionId === AccessibleFunctions.ReworkAdd)) ||
                (userPermissionList.some(permission => permission.functionId === AccessibleFunctions.ReworkReverse))
            ) {
                //If not already clicked, set the current trx mode to Rework
                selectedTxnMode = TransactionMode.Rework;

                //Change trx Mode buttons clicked/unclicked styling effect
                $('#trxModeReworkBtn').addClass('bs-buttonPressed-rework');
                $('#trxModeGoodBtn').removeClass('bs-buttonPressed-good');
                $('#trxModeScrapBtn').removeClass('bs-buttonPressed-scrap');
            }
            else {
                msgBox.show('ඔබට රීවර්ක් ස්කෑන් කිරීම සඳහා අවසර නැත.', 'You do not have permission for scanning "Rework".', 'අවවාදයයි / Warning', 'BS07', 'Warning', null);
            }
        }
    }

    function selectActionAdd() {
        refreshmsgBoxHeaderStyle();
        /*if (scanMode == 1 && selectedGroupTag == null)
            return;*/

        if ((userPermissionList.some(permission => permission.functionId === AccessibleFunctions.GoodAdd)) ||
            (userPermissionList.some(permission => permission.functionId === AccessibleFunctions.ScrapAdd)) ||
            (userPermissionList.some(permission => permission.functionId === AccessibleFunctions.ReworkAdd))
        ) {
            $('#scanActionAddBtn').addClass('bs-buttonPressed-action');
            $('#scanActionAddBtn').removeClass('bs-btn-primary-action');
            $('#scanActionReverseBtn').addClass('bs-btn-primary-action');
            $('#scanActionReverseBtn').removeClass('bs-buttonPressed-action');

            selectedScanAction = Action.Add;
        }
        else {
            msgBox.show('ඔබට ඇඩ් කිරීම සඳහා අවසර නැත.', 'You do not have permission for "Add".', 'අවවාදයයි / Warning', 'BS08', 'Warning', null);
        }
    }

    function selectActionReverse() {
        refreshmsgBoxHeaderStyle();
        /*if (scanMode == 1 && selectedGroupTag == null)
            return;*/

        if ((userPermissionList.some(permission => permission.functionId === AccessibleFunctions.GoodReverse)) ||
            (userPermissionList.some(permission => permission.functionId === AccessibleFunctions.ScrapReverse)) ||
            (userPermissionList.some(permission => permission.functionId === AccessibleFunctions.ReworkReverse))) {

            $('#scanActionAddBtn').addClass('bs-btn-primary-action');
            $('#scanActionAddBtn').removeClass('bs-buttonPressed-action');
            $('#scanActionReverseBtn').addClass('bs-buttonPressed-action');
            $('#scanActionReverseBtn').removeClass('bs-btn-primary-action');

            selectedScanAction = Action.Reverse;

            selectedScrapReason = Answer.Null;
            $('#divScrapReason').hide();
            $("#barcodeScrapReasonTxt").val("");
        }
        else {
            msgBox.show('ඔබට රිවර්ස් කිරීම සඳහා අවසර නැත.', 'You do not have permission for "Reverse".', 'අවවාදයයි / Warning', 'BS09', 'Warning', null);
        }
    } 

    //SMode Control
    function checkQuantitiyIsValid() {
        TotalQuantitiy = 0;
        $("#ajaxBusy").show();
        DisableControllers();
        if(!haltsystem) {
            refreshmsgBoxHeaderStyle();
            sacanComplete = true;
            errorbeforestauscomplete = '';
            var StyleNo = "";
            //console.log('Calling GetColorSheduleByTravelBarcode API by Barcode:' + $("#barcodeBcodeTxt").val());
            //scanmode: 0 = bulk, 1 = individual
        
            $.ajax({
                url: '@ViewBag.APIURL/Lookup/GetColorSheduleByTravelBarcode?Barcode=' + $("#barcodeGroupTagTxt").val() + "&Option=0",
                type: 'GET',
                dataType: 'json',
                //async: false,
                contentType: 'application/json; charset=utf-8',
                beforeSend: function () {
                    $("#ajaxBusy").show();
                },
                complete: function () {
                    $("#ajaxBusy").hide();
                },
                success: function (response) {
                    //console.log("Calling GetStyleScheduleByBarcode API succeded")
                    //If the barcode is exist in the db
                    if (response.length != 0) {
                        //console.log('Barcode ' + $("#barcodeBcodeTxt").val() + ' exists. Returned value..');
                        //console.log(response);
                        var qty01 = 0;
                        var qty02 = 0;
                        var qty03 = 0;

                        //scanmode: 0 = bulk, 1 = individual
                        var ttwfid = response[0].wfId;
                        
                        //GetClientByWF(response[0].wfId, scanMode);
                        if (ttwfid != null){ 
                            $.ajax({
                            url: '@ViewBag.APIURL/Security/GetClientByWfIdandIP?clientIP=' + clientconfig.clientIP + '&wfid=' + ttwfid + '&clientId=' + clientconfig.clientId + '&scanmode=' + scanMode,
                            type: 'GET',
                            dataType: 'json',
                            async: false,
                            contentType: 'application/json',
                            beforeSend: function () {
                                $("#ajaxBusy").show();
                            },
                            complete: function () {
                                $("#ajaxBusy").hide();
                            },
                            success: function (response2) {
                                if (response2 != null) {
                                var temwfdepinstId = clientconfig.wfdepinstId;

                                    clientconfig = {
                                            "userid": response2.userid,
                                            "clientId": response2.clientId,
                                            "dataCaptureMode": response2.dataCaptureMode,
                                            "facName": response2.facName,
                                            "loginMode": response2.loginMode,
                                            "opCode1": response2.opCode1,
                                            "opCode2": response2.opCode2,
                                            "operationName": response2.operationName,
                                            "recStatus": response2.recStatus,
                                            "selectMode": response2.selectMode,
                                            "teamId": response2.teamId,
                                            "teamName": response2.teamName,
                                            "facName": response2.facName,
                                            "wfdepinstId": response2.wfdepinstId,
                                            "wfId": ttwfid,
                                            "clientIP": clientconfig.clientIP
                                        };   
                                    
            
                                        if (clientconfig.teamId == 0 || clientconfig.teamId == null) {
                                            setMainOperationVisibility();
                                        }

                                        if(temwfdepinstId !=  clientconfig.wfdepinstId) {
                                            if (clientconfig.wfdepinstId != 0){
                                                // console.log('Calling GetWFConfigurationbyWFOpp by WFId:' + wfid + ', OperationCode:' + clientconfig.opCode1 + ', TeamId:' + clientconfig.teamId);
                                                $.ajax({
                                                    url: '@ViewBag.APIURL/Lookup/GetConfigurationWFDEPInstId?WFDEPInstId=' + clientconfig.wfdepinstId,  
                                                    //url: '@ViewBag.APIURL/Lookup/GetWFConfigurationbyWFOpp?WFId=' + wfid + '&OperationCode=' + clientconfig.opCode1 + '&TeamId=' + clientconfig.teamId,
                                                    type: 'GET',
                                                    dataType: 'json',
                                                    async: false,
                                                    contentType: 'application/json; charset=utf-8',
                                                    beforeSend: function () {
                                                        $("#ajaxBusy").show();
                                                    },
                                                    complete: function () {
                                                        $("#ajaxBusy").hide();
                                                    },
                                                    success: function (data2) {
                                                        //Check whether barcode is exist in the db
                                                        //console.log('Calling GetWFConfigurationbyWFOpp succeded.');
                                                        if (data2 != null) {
                                                            //console.log('GetWFConfigurationbyWFOpp API result received from DCAP db..');
                                                            //console.log(data);
                                                            sessionStorage.setItem("ScanOpMode", data2.scanOpMode);
                                                            selectedWfConfig = data2;

                                                            $('#dataLabelScanCounter').html(selectedWfConfig.scanCounter);
                                                            
                                                            initializeDivisons();

                                                            clientconfig = {
                                                                "clientId": clientconfig.clientId,
                                                                "dataCaptureMode": clientconfig.dataCaptureMode,
                                                                "pocounterNumber" : clientconfig.pocounterNumber,
                                                                "facName": clientconfig.facName,
                                                                "loginMode": clientconfig.loginMode,
                                                                "opCode1": clientconfig.opCode1,
                                                                "opCode2": clientconfig.opCode2,
                                                                "operationName": clientconfig.operationName,
                                                                "recStatus": clientconfig.recStatus,
                                                                "selectMode": clientconfig.selectMode,
                                                                "teamId": clientconfig.teamId,
                                                                "teamName": clientconfig.teamName,
                                                                "facName": clientconfig.facName,
                                                                "wfdepinstId": selectedWfConfig.wfdepinstId,
                                                                "wfId": clientconfig.wfId,
                                                                "clientIP": clientconfig.clientIP
                                                            };


                                                            setClientConfigInfo();

                                                            if (data2.scanOpMode == ScanOption.Continue) {
                                                                selectedScanOption = ScanOption.Continue;
                                                                $('#trxModeBtnPanel').show();
                                                                $('#scanActionButton').show();
                                                                //$('#dataLabelScanOpt').html('Continue');
                                                                var LblVal = clientconfig.operationName + ' / Continue'
                                                                $('#dataLabelOperation').html(LblVal);
                                                                $('#helpSin').html("ස්කෑන් කිරීමට පෙර ස්කෑන් ක්‍රමය සහ ස්කෑන් අකාරය තෝරන්න.");
                                                                $('#helpEng').html("Select Scan Action and Transaction before scanning the barcode.");
                                                                $('#barcodeBcodeTxt').attr("disabled", "disabled");
                                                                scanMode == 0 ? selectTrxModeGood() : selectTrxModeScrap(); //0 = bulk, 1 = individual
                                                            }
                                                            else if (data2.scanOpMode == ScanOption.Before) {
                                                                selectedScanOption = ScanOption.Before;
                                                                $('#trxModeBtnPanel').show();
                                                                $('#scanActionButton').show();
                                                                //$('#dataLabelScanOpt').html('Before'); 
                                                                var LblVal1 = clientconfig.operationName + ' / Before'
                                                                $('#dataLabelOperation').html(LblVal1);
                                                                $('#helpSin').html("ස්කෑන් කිරීමට පෙර ස්කෑන් ක්‍රමය සහ ස්කෑන් අකාරය තෝරන්න.");
                                                                $('#helpEng').html("Select Scan Action and Transaction before scanning the barcode.");
                                                            }
                                                            else if (data2.scanOpMode == ScanOption.After) {
                                                                selectedScanOption = ScanOption.After;
                                                                $('#trxModeBtnPanel').show();
                                                                $('#scanActionButton').show();
                                                                //$('#dataLabelScanOpt').html('After');
                                                                var LblVal2 = clientconfig.operationName + ' / After'
                                                                $('#dataLabelOperation').html(LblVal2);
                                                                $('#trxModeReworkBtn').attr("disabled", "disabled");
                                                                $('#trxModeGoodBtn').attr("disabled", "disabled");
                                                                $('#trxModeScrapBtn').attr("disabled", "disabled");
                                                                //$('#helpSin').html("ස්කෑන් කිරීමෙන් පසු ස්කෑන් ක්‍රමය සහ ස්කෑන් අකාරය තෝරන්න.");
                                                                //$('#helpEng').html("Select Scan Action and Transaction after scanning the barcode.");
                                                                $("#barcodeBcodeTxt").removeAttr("disabled");
                                                                $("#barcodeBcodeTxt").select();
                                                                $("#barcodeBcodeTxt").focus();
                                                            }

                                                            if (data2.poCounterEnable == 1) {
                                                                $('#counterLables').show();
                                                                loadPOcounterValues();
                                                            }
                                                            else {
                                                                $('#counterLables').hide();
                                                            }

                                                            //Don't change below order as default has to be set for "Add"
                                                            if (userPermissionList.some(permission => permission.functionId === AccessibleFunctions.GoodReverse)) {
                                                                $('#trxModeGoodBtn').show();
                                                                $('#scanActionReverseBtn').show();

                                                                selectActionReverse();
                                                            }
                                                            if (userPermissionList.some(permission => permission.functionId === AccessibleFunctions.GoodAdd)) {
                                                                $('#trxModeGoodBtn').show();
                                                                $('#scanActionAddBtn').show();

                                                                selectActionAdd();
                                                            }
                                                            if (userPermissionList.some(permission => permission.functionId === AccessibleFunctions.ScrapReverse)) {
                                                                $('#trxModeScrapBtn').show();
                                                                $('#scanActionReverseBtn').show();

                                                                selectActionReverse();
                                                            }
                                                            if (userPermissionList.some(permission => permission.functionId === AccessibleFunctions.ScrapAdd)) {
                                                                $('#trxModeScrapBtn').show();
                                                                $('#scanActionAddBtn').show();

                                                                selectActionAdd();
                                                            }
                                                            if (userPermissionList.some(permission => permission.functionId === AccessibleFunctions.ReworkReverse)) {
                                                                $('#trxModeReworkBtn').show();
                                                                $('#scanActionReverseBtn').show();

                                                                selectActionReverse();
                                                            }

                                                            if (userPermissionList.some(permission => permission.functionId === AccessibleFunctions.ReworkAdd)) {
                                                                $('#trxModeReworkBtn').show();
                                                                $('#scanActionAddBtn').show();

                                                                selectActionAdd();
                                                            }
                                                            //console.log('Calling GetWFDetailByID API by wfid:' + wfid);
                                                            if(wfid == null)
                                                                wfid = clientconfig.wfId

                                                            $.ajax({
                                                                url: '@ViewBag.APIURL/Lookup/GetWFDetailByID?WFId=' + wfid,
                                                                type: 'GET',
                                                                dataType: 'json',
                                                                async: false,
                                                                contentType: 'application/json; charset=utf-8',
                                                                beforeSend: function () {
                                                                    $("#ajaxBusy").show();
                                                                },
                                                                complete: function () {
                                                                    $("#ajaxBusy").hide();
                                                                },
                                                                success: function (data3) {
                                                                    //console.log('Calling GetWFDetailByID API succeded.');
                                                                    if (data3 != null) {
                                                                        //console.log('GetWFDetailByID API result received from DCAP db..');
                                                                        selectedWorkflow = data3;
                                                                        //console.log(selectedWorkflow);
                                                                    }
                                                                    else {
                                                                        msgBox.show('කාර්ය ප්‍රවාහයට අදාල තොරතුරු නැත. කරුණාකර තොරතුරු තාක්ෂණ නිලධාරියෙකු අමතන්න.',
                                                                            'Workflow details not found. Please contact a IT helpdesk officer',
                                                                            'අවවාදයයි / Warning',
                                                                            'BS22',
                                                                            'Warning',
                                                                            null);
                                                                    }

                                                                },
                                                                error: function (jqXHR, textStatus, errorThrown) {
                                                                    formatErrorMessage(jqXHR, errorThrown, "BFLProductionBarcode");
                                                                }
                                                            });
                                                        }
                                                        else {
                                                            //console.log('No configuration details available for selected style.');
                                                            msgBox.show('තෝරන ලද ස්ටයිල් සඳහා වින්‍යාස තොරතුරු නොමැත. කරුණාකර තොරතුරු තාක්ෂණ නිලධාරියෙකු අමතන්න.',
                                                                'No configuration details available for selected style. Please contact a IT helpdesk officer',
                                                                'අවවාදයයි / Warning',
                                                                'BS23',
                                                                'Warning',
                                                                null);
                                                        }
                                                    },
                                                    error: function (jqXHR, textStatus, errorThrown) {
                                                        formatErrorMessage(jqXHR, errorThrown, "BFLProductionBarcode");
                                                    }
                                                });
                                            }
                                        }

                                        setClientConfigInfo();
                                        wfidsetcomplete = true;
                                        //return wfidsetcomplete;
                                        if(true){
                                            clientconfig = {
                                                    "clientId": clientconfig.clientId,
                                                    "dataCaptureMode": clientconfig.dataCaptureMode,
                                                    "pocounterNumber" : clientconfig.pocounterNumber,
                                                    "facName": clientconfig.facName,
                                                    "loginMode": clientconfig.loginMode,
                                                    "opCode1": clientconfig.opCode1,
                                                    "opCode2": clientconfig.opCode2,
                                                    "operationName": clientconfig.operationName,
                                                    "recStatus": clientconfig.recStatus,
                                                    "selectMode": clientconfig.selectMode,
                                                    "teamId": clientconfig.teamId,
                                                    "teamName": clientconfig.teamName,
                                                    "facName": clientconfig.facName,
                                                    "wfdepinstId": clientconfig.wfdepinstId,
                                                    "wfId": clientconfig.wfId,
                                                    "clientIP": clientconfig.clientIP
                                                };

                                            ScanBackupWholeData = response;
                                            var usList = [];

                                            $.each(response, function (index, data) {

                                                scannedBarcode = data;
                                                wfid = data.wfId;
                                                //console.log("Quantitiybalid",data.sMode);
                                                //SMode = data.sMode;

                                                usList[0] = usList[0] == undefined ? data.scheduleNo : (!usList[0].includes(data.scheduleNo) ? (usList[0] + " | " + data.scheduleNo) : usList[0]);
                                                usList[1] = usList[1] == undefined ? data.poNo : (!usList[1].includes(data.poNo) ? (usList[1] + " | " + data.poNo) : usList[1]);
                                                usList[2] = usList[2] == undefined ? data.zfeature : (!usList[2].includes(data.zfeature) ? (usList[2] + " | " + data.zfeature) : usList[2]);
                                                //usList[3] = usList[3] == undefined ? data.sizeDesc : (!usList[3].includes(data.sizeDesc) ? (usList[3] + " | " + data.sizeDesc) : usList[3]);
                                                usList[4] = usList[4] == undefined ? data.colorDesc : (!usList[4].includes(data.colorDesc) ? (usList[4] + " | " + data.colorDesc) : usList[4]);

                                                qty01 = qty01 + scannedBarcode.qty01;
                                                qty02 = qty02 + scannedBarcode.qty02;
                                                qty03 = qty03 + scannedBarcode.qty03;

                                                //Check whether barcode style is matched with the user input
                                                if (scanMode == 1 && scannedBarcode.bagBarcode != $("#barcodeGroupTagTxt").val()) { //scanmode: 0 = bulk, 1 = individual
                                                    msgBox.show('තෝරාගත් ටැගය තීරු කේතය සමඟ නොගැලපේ. කරුණාකර නැවත පරීක්ෂා කරන්න (' + scannedBarcode.bagBarcode + ').', 'Seleted tag does not match with barcode. please chech again (' + scannedBarcode.bagBarcode + ').', 'අවවාදයයි / Warning', 'BS10', 'Warning', function () {
                                                        scannedBarcode = null;
                                                        $("#quantitiyTxt").val("");
                                                        $("#quantitiyTxt").select();
                                                        $("#quantitiyTxt").focus();
                                                    });
                                                    errorbeforestauscomplete = errorbeforestauscomplete + ' ' + 'Selected Style does not match with Barcode.'
                                                    sacanComplete = false;
                                                    EnableControllers();
                                                    return;
                                                }
                                                else if (selectedWfConfig.validateSheduleChange == 1 && scanMode == 1 && $("#lastBarcodeDataLabel").html() != ""  &&   scannedBarcode.scheduleNo != $("#lastBarcodeDataLabel").html().substring(0, 6)) {  //scanmode: 0 = bulk, 1 = individual                        
                                                        msgBoxConfirm.show('මෙතෙක් ස්කෑන් කරගෙන ආ ෂෙඩියුල් අංකය හා මෙම බාර් කොඩයේ ෂෙඩියුල් අංකය වෙනස්ය. ඉදිරියට යන්න ..',
                                                            'Sdule no is differant from the one was scanning, continue with new shedule no..',
                                                            'තහවුරු කරන්න / Confirm',
                                                            'BS24',
                                                            'Confirm',
                                                            function () {
                                                                isValidBarcode = true;
                                                                $('#scheduleDataLabel').html(usList[0]);
                                                                $('#poDataLabel').html(usList[1]);
                                                                $('#dataLabelzFeature').html(usList[2]);
                                                                $('#sizeDataLabel').html(wfid);
                                                                $('#bcColorDataLabel').html(usList[4]);
                                                                $('#Quantitiy').html(parseInt(qty01) - parseInt(qty02) - parseInt(qty03));
                                                                TotalQuantitiy = scannedBarcode.qty01 + TotalQuantitiy;  

                                                                if (selectedScanOption == ScanOption.After) {
                                                                    $('#trxModeReworkBtn').removeAttr("disabled");
                                                                    $('#trxModeGoodBtn').removeAttr("disabled");
                                                                    $('#trxModeScrapBtn').removeAttr("disabled");
                                                                    $("#barcodeBcodeTxt").attr("disabled", "disabled");
                                                                    $('#scannedStatusDataLabel').html("");
                                                                    EnableControllers();
                                                                }
                                                                else if (selectedScanOption == ScanOption.Continue) {
                                                                    updateBarcodeScan();
                                                                    $('#trxModeReworkBtn').removeAttr("disabled");
                                                                    $('#trxModeGoodBtn').removeAttr("disabled");
                                                                    $('#trxModeScrapBtn').removeAttr("disabled");
                                                                }
                                                            },
                                                            function () {
                                                                $("#quantitiyTxt").val("");
                                                                $("#quantitiyTxt").select();
                                                                $("#quantitiyTxt").focus();
                                                                errorbeforestauscomplete = errorbeforestauscomplete + ' ' + 'Shedule conffirmation : cancelled.'
                                                                sacanComplete = false;
                                                                EnableControllers();
                                                                return;
                                                            });
                                                        beeponce();                        
                                                }
                                                else {
                                                    isValidBarcode = true;
                                                    //console.log(usList[3], data.sizeDesc);
                                                    $('#scheduleDataLabel').html(usList[0]);
                                                    $('#poDataLabel').html(usList[1]);
                                                    $('#dataLabelzFeature').html(usList[2]);
                                                    $('#sizeDataLabel').html(wfid);
                                                    $('#bcColorDataLabel').html(usList[4]);
                                                    $('#Quantitiy').html(parseInt(qty01) - parseInt(qty02) - parseInt(qty03));
                                                        
                                                    TotalQuantitiy = scannedBarcode.qty01 + TotalQuantitiy;  

                                                    if (selectedScanOption == ScanOption.After) {
                                                        $('#trxModeReworkBtn').removeAttr("disabled");
                                                        $('#trxModeGoodBtn').removeAttr("disabled");
                                                        $('#trxModeScrapBtn').removeAttr("disabled");
                                                        $("#barcodeBcodeTxt").attr("disabled", "disabled");
                                                        $('#scannedStatusDataLabel').html("");
                                                        EnableControllers();
                                                    }
                                                    else if (selectedScanOption == ScanOption.Continue) {
                                                        $('#trxModeReworkBtn').removeAttr("disabled");
                                                        $('#trxModeGoodBtn').removeAttr("disabled");
                                                        $('#trxModeScrapBtn').removeAttr("disabled");
                                                        updateBarcodeScan();
                                                        $('#quantitiyTxt').focus();
                                                    }
                                                }

                                                tagDataBackup = data;                 
                                                selectedGroupTagNo = data.styleNo;
                                                selectedGroupDesc = data.StyleDesc;
                                            });
                                        }
                                        else
                                        {
                                            $("#quantitiyTxt").val("");
                                            $("#quantitiyTxt").select();
                                            $("#quantitiyTxt").focus();
                                            sacanComplete = false;
                                            EnableControllers();
                                            return;
                                        }
                                }  
                                else {
                                        msgBox.show('කාර්ය ප්‍රවාහයට අවසර නැත. කරුණාකර තොරතුරු තාක්ෂණ නිලධාරියෙකු අමතන්න.',
                                                'Client is not configured for this Workflow..WFID = '+ wfid + ' Please contact a IT helpdesk officer' ,
                                                'අවවාදයයි / Warning',
                                                'BS22',
                                                'Warning',
                                                null);
                                        $("#quantitiyTxt").val("");
                                        $("#quantitiyTxt").sellect();
                                        $("#quantitiyTxt").focus();
                                        
                                        sacanComplete = false;
                                        //return wfidsetcomplete;
                                        errorbeforestauscomplete = errorbeforestauscomplete + ' ' + 'Client is not configured for this Workflow..WFID'
                                    }          
                                },
                                error: function (jqXHR, textStatus, errorThrown) {
                                    formatErrorMessage(jqXHR, errorThrown, "BFLProductionBarcode");
                                    //return wfidsetcomplete;
                                }
                            }); 
                        }

            
                    }
                    else {
                        //console.log('Barcode ' + $("#barcodeBcodeTxt").val() + ' not exists.');
                        isValidBarcode = false;
                        msgBox.show('මෙම බාර්කෝඩ් අගය වලංගු නැත.', 'This barcode is not valid.', 'අවවාදයයි / Warning', 'BS12', 'Warning', function () {
                            scannedBarcode = null;
                            errorbeforestauscomplete = errorbeforestauscomplete + ' ' + 'This barcode is not valid.'
                            sacanComplete = false;
                            EnableControllers();
                            $('#quantitiyTxt').val('');
                            $('#quantitiyTxt').select();
                            $('#quantitiyTxt').focus();
                        });
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    formatErrorMessage(jqXHR, errorThrown, "BFLProductionBarcode");
                    errorbeforestauscomplete = errorbeforestauscomplete + ' ' + 'Get Shedulle by Barcode API Error.'
                    sacanComplete = false;
                    EnableControllers();
                    $('#quantitiyTxt').val('');
                    $('#quantitiyTxt').select();
                    $('#quantitiyTxt').focus();
                }
            });
        } else {
            msgBox.show('ස්කෑන් පද්ධතිය නවතා දමා ඇත. කවුන්ටර හෝ වෙනත් වලංගු කිරීම් සඳහා පරීක්ෂා කරන්න',
                        'The scan system is on halt. check for counter or other validations',
                        'අවවාදයයි / Warning',
                        'BS22',
                        'Warning',
                        function(){
                            EnableControllers();
                            $('#quantitiyTxt').val('');
                            $('#quantitiyTxt').select();
                            $('#quantitiyTxt').focus();
                        });
        }      
    } 

    function checkBarcodeIsValid() {
        TotalQuantitiy = 0;
        $("#ajaxBusy").show();
        DisableControllers();
        if(!haltsystem) {
            refreshmsgBoxHeaderStyle();
            sacanComplete = true;
            errorbeforestauscomplete = '';
            var StyleNo = "";
            //console.log('Calling GetColorSheduleByTravelBarcode API by Barcode:' + $("#barcodeBcodeTxt").val());
            //scanmode: 0 = bulk, 1 = individual
        
            $.ajax({
                url: '@ViewBag.APIURL/Lookup/GetColorSheduleByTravelBarcode?Barcode=' + $("#barcodeBcodeTxt").val() + "&Option=" + scanMode,
                type: 'GET',
                dataType: 'json',
                //async: false,
                contentType: 'application/json; charset=utf-8',
                beforeSend: function () {
                    $("#ajaxBusy").show();
                },
                complete: function () {
                    $("#ajaxBusy").hide();
                },
                success: function (response) {
                    //console.log("Calling GetStyleScheduleByBarcode API succeded")
                    //If the barcode is exist in the db
                    if (response.length != 0) {
                        //console.log('Barcode ' + $("#barcodeBcodeTxt").val() + ' exists. Returned value..');
                        //console.log(response);
                        var qty01 = 0;
                        var qty02 = 0;
                        var qty03 = 0;

                        //scanmode: 0 = bulk, 1 = individual
                        var ttwfid = response[0].wfId;
                        
                        //GetClientByWF(response[0].wfId, scanMode);
                        if (ttwfid != null){ 
                            $.ajax({
                            url: '@ViewBag.APIURL/Security/GetClientByWfIdandIP?clientIP=' + clientconfig.clientIP + '&wfid=' + ttwfid + '&clientId=' + clientconfig.clientId + '&scanmode=' + scanMode,
                            type: 'GET',
                            dataType: 'json',
                            async: false,
                            contentType: 'application/json',
                            beforeSend: function () {
                                $("#ajaxBusy").show();
                            },
                            complete: function () {
                                $("#ajaxBusy").hide();
                            },
                            success: function (response2) {
                                if (response2 != null) {
                                var temwfdepinstId = clientconfig.wfdepinstId;

                                    clientconfig = {
                                            "userid": response2.userid,
                                            "clientId": response2.clientId,
                                            "dataCaptureMode": response2.dataCaptureMode,
                                            "facName": response2.facName,
                                            "loginMode": response2.loginMode,
                                            "opCode1": response2.opCode1,
                                            "opCode2": response2.opCode2,
                                            "operationName": response2.operationName,
                                            "recStatus": response2.recStatus,
                                            "selectMode": response2.selectMode,
                                            "teamId": response2.teamId,
                                            "teamName": response2.teamName,
                                            "facName": response2.facName,
                                            "wfdepinstId": response2.wfdepinstId,
                                            "wfId": ttwfid,
                                            "clientIP": clientconfig.clientIP
                                        };   
                                    
            
                                        if (clientconfig.teamId == 0 || clientconfig.teamId == null) {
                                            setMainOperationVisibility();
                                        }

                                        if(temwfdepinstId !=  clientconfig.wfdepinstId) {
                                            if (clientconfig.wfdepinstId != 0){
                                                // console.log('Calling GetWFConfigurationbyWFOpp by WFId:' + wfid + ', OperationCode:' + clientconfig.opCode1 + ', TeamId:' + clientconfig.teamId);
                                                $.ajax({
                                                    url: '@ViewBag.APIURL/Lookup/GetConfigurationWFDEPInstId?WFDEPInstId=' + clientconfig.wfdepinstId,  
                                                    //url: '@ViewBag.APIURL/Lookup/GetWFConfigurationbyWFOpp?WFId=' + wfid + '&OperationCode=' + clientconfig.opCode1 + '&TeamId=' + clientconfig.teamId,
                                                    type: 'GET',
                                                    dataType: 'json',
                                                    async: false,
                                                    contentType: 'application/json; charset=utf-8',
                                                    beforeSend: function () {
                                                        $("#ajaxBusy").show();
                                                    },
                                                    complete: function () {
                                                        $("#ajaxBusy").hide();
                                                    },
                                                    success: function (data2) {
                                                        //Check whether barcode is exist in the db
                                                        //console.log('Calling GetWFConfigurationbyWFOpp succeded.');
                                                        if (data2 != null) {
                                                            //console.log('GetWFConfigurationbyWFOpp API result received from DCAP db..');
                                                            //console.log(data);
                                                            sessionStorage.setItem("ScanOpMode", data2.scanOpMode);
                                                            selectedWfConfig = data2;

                                                            $('#dataLabelScanCounter').html(selectedWfConfig.scanCounter);
                                                            
                                                            initializeDivisons();

                                                            clientconfig = {
                                                                "clientId": clientconfig.clientId,
                                                                "dataCaptureMode": clientconfig.dataCaptureMode,
                                                                "pocounterNumber" : clientconfig.pocounterNumber,
                                                                "facName": clientconfig.facName,
                                                                "loginMode": clientconfig.loginMode,
                                                                "opCode1": clientconfig.opCode1,
                                                                "opCode2": clientconfig.opCode2,
                                                                "operationName": clientconfig.operationName,
                                                                "recStatus": clientconfig.recStatus,
                                                                "selectMode": clientconfig.selectMode,
                                                                "teamId": clientconfig.teamId,
                                                                "teamName": clientconfig.teamName,
                                                                "facName": clientconfig.facName,
                                                                "wfdepinstId": selectedWfConfig.wfdepinstId,
                                                                "wfId": clientconfig.wfId,
                                                                "clientIP": clientconfig.clientIP
                                                            };


                                                            setClientConfigInfo();

                                                            if (data2.scanOpMode == ScanOption.Continue) {
                                                                selectedScanOption = ScanOption.Continue;
                                                                $('#trxModeBtnPanel').show();
                                                                $('#scanActionButton').show();
                                                                //$('#dataLabelScanOpt').html('Continue');
                                                                var LblVal = clientconfig.operationName + ' / Continue'
                                                                $('#dataLabelOperation').html(LblVal);
                                                                $('#helpSin').html("ස්කෑන් කිරීමට පෙර ස්කෑන් ක්‍රමය සහ ස්කෑන් අකාරය තෝරන්න.");
                                                                $('#helpEng').html("Select Scan Action and Transaction before scanning the barcode.");
                                                                $('#barcodeBcodeTxt').attr("disabled", "disabled");
                                                                scanMode == 0 ? selectTrxModeGood() : selectTrxModeScrap(); //0 = bulk, 1 = individual
                                                            }
                                                            else if (data2.scanOpMode == ScanOption.Before) {
                                                                selectedScanOption = ScanOption.Before;
                                                                $('#trxModeBtnPanel').show();
                                                                $('#scanActionButton').show();
                                                                //$('#dataLabelScanOpt').html('Before'); 
                                                                var LblVal1 = clientconfig.operationName + ' / Before'
                                                                $('#dataLabelOperation').html(LblVal1);
                                                                $('#helpSin').html("ස්කෑන් කිරීමට පෙර ස්කෑන් ක්‍රමය සහ ස්කෑන් අකාරය තෝරන්න.");
                                                                $('#helpEng').html("Select Scan Action and Transaction before scanning the barcode.");
                                                            }
                                                            else if (data2.scanOpMode == ScanOption.After) {
                                                                selectedScanOption = ScanOption.After;
                                                                $('#trxModeBtnPanel').show();
                                                                $('#scanActionButton').show();
                                                                //$('#dataLabelScanOpt').html('After');
                                                                var LblVal2 = clientconfig.operationName + ' / After'
                                                                $('#dataLabelOperation').html(LblVal2);
                                                                $('#trxModeReworkBtn').attr("disabled", "disabled");
                                                                $('#trxModeGoodBtn').attr("disabled", "disabled");
                                                                $('#trxModeScrapBtn').attr("disabled", "disabled");
                                                                //$('#helpSin').html("ස්කෑන් කිරීමෙන් පසු ස්කෑන් ක්‍රමය සහ ස්කෑන් අකාරය තෝරන්න.");
                                                                //$('#helpEng').html("Select Scan Action and Transaction after scanning the barcode.");
                                                                $("#barcodeBcodeTxt").removeAttr("disabled");
                                                                $("#barcodeBcodeTxt").select();
                                                                $("#barcodeBcodeTxt").focus();
                                                            }

                                                            if (data2.poCounterEnable == 1) {
                                                                $('#counterLables').show();
                                                                loadPOcounterValues();
                                                            }
                                                            else {
                                                                $('#counterLables').hide();
                                                            }

                                                            //Don't change below order as default has to be set for "Add"
                                                            if (userPermissionList.some(permission => permission.functionId === AccessibleFunctions.GoodReverse)) {
                                                                $('#trxModeGoodBtn').show();
                                                                $('#scanActionReverseBtn').show();

                                                                selectActionReverse();
                                                            }
                                                            if (userPermissionList.some(permission => permission.functionId === AccessibleFunctions.GoodAdd)) {
                                                                $('#trxModeGoodBtn').show();
                                                                $('#scanActionAddBtn').show();

                                                                selectActionAdd();
                                                            }
                                                            if (userPermissionList.some(permission => permission.functionId === AccessibleFunctions.ScrapReverse)) {
                                                                $('#trxModeScrapBtn').show();
                                                                $('#scanActionReverseBtn').show();

                                                                selectActionReverse();
                                                            }
                                                            if (userPermissionList.some(permission => permission.functionId === AccessibleFunctions.ScrapAdd)) {
                                                                $('#trxModeScrapBtn').show();
                                                                $('#scanActionAddBtn').show();

                                                                selectActionAdd();
                                                            }
                                                            if (userPermissionList.some(permission => permission.functionId === AccessibleFunctions.ReworkReverse)) {
                                                                $('#trxModeReworkBtn').show();
                                                                $('#scanActionReverseBtn').show();

                                                                selectActionReverse();
                                                            }

                                                            if (userPermissionList.some(permission => permission.functionId === AccessibleFunctions.ReworkAdd)) {
                                                                $('#trxModeReworkBtn').show();
                                                                $('#scanActionAddBtn').show();

                                                                selectActionAdd();
                                                            }
                                                            //console.log('Calling GetWFDetailByID API by wfid:' + wfid);
                                                            if(wfid == null)
                                                                wfid = clientconfig.wfId

                                                            $.ajax({
                                                                url: '@ViewBag.APIURL/Lookup/GetWFDetailByID?WFId=' + wfid,
                                                                type: 'GET',
                                                                dataType: 'json',
                                                                async: false,
                                                                contentType: 'application/json; charset=utf-8',
                                                                beforeSend: function () {
                                                                    $("#ajaxBusy").show();
                                                                },
                                                                complete: function () {
                                                                    $("#ajaxBusy").hide();
                                                                },
                                                                success: function (data3) {
                                                                    //console.log('Calling GetWFDetailByID API succeded.');
                                                                    if (data3 != null) {
                                                                        //console.log('GetWFDetailByID API result received from DCAP db..');
                                                                        selectedWorkflow = data3;
                                                                        //console.log(selectedWorkflow);
                                                                    }
                                                                    else {
                                                                        msgBox.show('කාර්ය ප්‍රවාහයට අදාල තොරතුරු නැත. කරුණාකර තොරතුරු තාක්ෂණ නිලධාරියෙකු අමතන්න.',
                                                                            'Workflow details not found. Please contact a IT helpdesk officer',
                                                                            'අවවාදයයි / Warning',
                                                                            'BS22',
                                                                            'Warning',
                                                                            null);
                                                                    }

                                                                },
                                                                error: function (jqXHR, textStatus, errorThrown) {
                                                                    formatErrorMessage(jqXHR, errorThrown, "BFLProductionBarcode");
                                                                }
                                                            });
                                                        }
                                                        else {
                                                            //console.log('No configuration details available for selected style.');
                                                            msgBox.show('තෝරන ලද ස්ටයිල් සඳහා වින්‍යාස තොරතුරු නොමැත. කරුණාකර තොරතුරු තාක්ෂණ නිලධාරියෙකු අමතන්න.',
                                                                'No configuration details available for selected style. Please contact a IT helpdesk officer',
                                                                'අවවාදයයි / Warning',
                                                                'BS23',
                                                                'Warning',
                                                                null);
                                                        }
                                                    },
                                                    error: function (jqXHR, textStatus, errorThrown) {
                                                        formatErrorMessage(jqXHR, errorThrown, "BFLProductionBarcode");
                                                    }
                                                });
                                            }
                                        }

                                        setClientConfigInfo();
                                        wfidsetcomplete = true;
                                        //return wfidsetcomplete;
                                        if(true){
                                            clientconfig = {
                                                    "clientId": clientconfig.clientId,
                                                    "dataCaptureMode": clientconfig.dataCaptureMode,
                                                    "pocounterNumber" : clientconfig.pocounterNumber,
                                                    "facName": clientconfig.facName,
                                                    "loginMode": clientconfig.loginMode,
                                                    "opCode1": clientconfig.opCode1,
                                                    "opCode2": clientconfig.opCode2,
                                                    "operationName": clientconfig.operationName,
                                                    "recStatus": clientconfig.recStatus,
                                                    "selectMode": clientconfig.selectMode,
                                                    "teamId": clientconfig.teamId,
                                                    "teamName": clientconfig.teamName,
                                                    "facName": clientconfig.facName,
                                                    "wfdepinstId": clientconfig.wfdepinstId,
                                                    "wfId": clientconfig.wfId,
                                                    "clientIP": clientconfig.clientIP
                                                };

                                            ScanBackupWholeData = response;
                                            var usList = [];

                                            $.each(response, function (index, data) {

                                                scannedBarcode = data;
                                                wfid = data.wfId;
                                                //console.log("checkBarcodeValid",data.sMode);
                                                //SMode = data.sMode;

                                                usList[0] = usList[0] == undefined ? data.scheduleNo : (!usList[0].includes(data.scheduleNo) ? (usList[0] + " | " + data.scheduleNo) : usList[0]);
                                                usList[1] = usList[1] == undefined ? data.poNo : (!usList[1].includes(data.poNo) ? (usList[1] + " | " + data.poNo) : usList[1]);
                                                usList[2] = usList[2] == undefined ? data.zfeature : (!usList[2].includes(data.zfeature) ? (usList[2] + " | " + data.zfeature) : usList[2]);
                                                //usList[3] = usList[3] == undefined ? data.sizeDesc : (!usList[3].includes(data.sizeDesc) ? (usList[3] + " | " + data.sizeDesc) : usList[3]);
                                                usList[4] = usList[4] == undefined ? data.colorDesc : (!usList[4].includes(data.colorDesc) ? (usList[4] + " | " + data.colorDesc) : usList[4]);

                                                qty01 = qty01 + scannedBarcode.qty01;
                                                qty02 = qty02 + scannedBarcode.qty02;
                                                qty03 = qty03 + scannedBarcode.qty03;

                                                //Check whether barcode style is matched with the user input
                                                if (scanMode == 1 && scannedBarcode.bagBarcode != $("#barcodeGroupTagTxt").val() && selectedScanAction != Action.Reverse) { //scanmode: 0 = bulk, 1 = individual
                                                    msgBox.show('තෝරාගත් ටැගය තීරු කේතය සමඟ නොගැලපේ. කරුණාකර නැවත පරීක්ෂා කරන්න (' + scannedBarcode.bagBarcode + ').', 'Seleted tag does not match with barcode. please chech again (' + scannedBarcode.bagBarcode + ').', 'අවවාදයයි / Warning', 'BS10', 'Warning', function () {
                                                        scannedBarcode = null;
                                                        $("#barcodeBcodeTxt").val("");
                                                        $("#barcodeBcodeTxt").focus();
                                                    });
                                                    errorbeforestauscomplete = errorbeforestauscomplete + ' ' + 'Selected Style does not match with Barcode.'
                                                    sacanComplete = false;
                                                    EnableControllers();
                                                    return;
                                                }
                                                else if (selectedWfConfig.validateSheduleChange == 1 && scanMode == 1 && $("#lastBarcodeDataLabel").html() != ""  &&   scannedBarcode.scheduleNo != $("#lastBarcodeDataLabel").html().substring(0, 6)) {  //scanmode: 0 = bulk, 1 = individual                        
                                                        msgBoxConfirm.show('මෙතෙක් ස්කෑන් කරගෙන ආ ෂෙඩියුල් අංකය හා මෙම බාර් කොඩයේ ෂෙඩියුල් අංකය වෙනස්ය. ඉදිරියට යන්න ..',
                                                            'Sdule no is differant from the one was scanning, continue with new shedule no..',
                                                            'තහවුරු කරන්න / Confirm',
                                                            'BS24',
                                                            'Confirm',
                                                            function () {
                                                                isValidBarcode = true;
                                                                $('#scheduleDataLabel').html(usList[0]);
                                                                $('#poDataLabel').html(usList[1]);
                                                                $('#dataLabelzFeature').html(usList[2]);
                                                                $('#sizeDataLabel').html(wfid);
                                                                $('#bcColorDataLabel').html(usList[4]);
                                                                $('#Quantitiy').html(parseInt(qty01) - parseInt(qty02) - parseInt(qty03));
                                                                TotalQuantitiy = scannedBarcode.qty01 + TotalQuantitiy;  

                                                                if (selectedScanOption == ScanOption.After) {
                                                                    $('#trxModeReworkBtn').removeAttr("disabled");
                                                                    $('#trxModeGoodBtn').removeAttr("disabled");
                                                                    $('#trxModeScrapBtn').removeAttr("disabled");
                                                                    $("#barcodeBcodeTxt").attr("disabled", "disabled");
                                                                    $('#scannedStatusDataLabel').html("");
                                                                    EnableControllers();
                                                                }
                                                                else if (selectedScanOption == ScanOption.Continue) {
                                                                    updateBarcodeScan();
                                                                    $('#trxModeReworkBtn').removeAttr("disabled");
                                                                    $('#trxModeGoodBtn').removeAttr("disabled");
                                                                    $('#trxModeScrapBtn').removeAttr("disabled");
                                                                }
                                                            },
                                                            function () {
                                                                $("#barcodeBcodeTxt").val("");
                                                                $("#barcodeBcodeTxt").focus();
                                                                errorbeforestauscomplete = errorbeforestauscomplete + ' ' + 'Shedule conffirmation : cancelled.'
                                                                sacanComplete = false;
                                                                EnableControllers();
                                                                return;
                                                            });
                                                        beeponce();                        
                                                }
                                                else {
                                                    isValidBarcode = true;
                                                    //console.log(usList[3], data.sizeDesc);
                                                    $('#scheduleDataLabel').html(usList[0]);
                                                    $('#poDataLabel').html(usList[1]);
                                                    $('#dataLabelzFeature').html(usList[2]);
                                                    $('#sizeDataLabel').html(wfid);
                                                    $('#bcColorDataLabel').html(usList[4]);
                                                    $('#Quantitiy').html(parseInt(qty01) - parseInt(qty02) - parseInt(qty03));
                                                        
                                                    TotalQuantitiy = scannedBarcode.qty01 + TotalQuantitiy;  

                                                    if (selectedScanOption == ScanOption.After) {
                                                        $('#trxModeReworkBtn').removeAttr("disabled");
                                                        $('#trxModeGoodBtn').removeAttr("disabled");
                                                        $('#trxModeScrapBtn').removeAttr("disabled");
                                                        $("#barcodeBcodeTxt").attr("disabled", "disabled");
                                                        $('#scannedStatusDataLabel').html("");
                                                        EnableControllers();
                                                    }
                                                    else if (selectedScanOption == ScanOption.Continue) {
                                                        $('#trxModeReworkBtn').removeAttr("disabled");
                                                        $('#trxModeGoodBtn').removeAttr("disabled");
                                                        $('#trxModeScrapBtn').removeAttr("disabled");
                                                        updateBarcodeScan();
                                                        $('#bagBarcodeBcodeTxt').focus();
                                                    }
                                                }

                                                tagDataBackup = data;                 
                                                selectedGroupTagNo = data.styleNo;
                                                selectedGroupDesc = data.StyleDesc;
                                            });
                                        }
                                        else
                                        {
                                            $("#barcodeBcodeTxt").val("");
                                            $("#barcodeBcodeTxt").focus();
                                            sacanComplete = false;
                                            EnableControllers();
                                            return;
                                        }
                                }  
                                else {
                                        msgBox.show('කාර්ය ප්‍රවාහයට අවසර නැත. කරුණාකර තොරතුරු තාක්ෂණ නිලධාරියෙකු අමතන්න.',
                                                'Client is not configured for this Workflow..WFID = '+ wfid + ' Please contact a IT helpdesk officer' ,
                                                'අවවාදයයි / Warning',
                                                'BS22',
                                                'Warning',
                                                null);
                                        $("#barcodeBcodeTxt").val("");
                                        $("#barcodeBcodeTxt").focus();
                                        
                                        sacanComplete = false;
                                        //return wfidsetcomplete;
                                        errorbeforestauscomplete = errorbeforestauscomplete + ' ' + 'Client is not configured for this Workflow..WFID'
                                    }          
                                },
                                error: function (jqXHR, textStatus, errorThrown) {
                                    formatErrorMessage(jqXHR, errorThrown, "BFLProductionBarcode");
                                    //return wfidsetcomplete;
                                }
                            }); 
                        }

            
                    }
                    else {
                        //console.log('Barcode ' + $("#barcodeBcodeTxt").val() + ' not exists.');
                        isValidBarcode = false;
                        msgBox.show('මෙම බාර්කෝඩ් අගය වලංගු නැත.', 'This barcode is not valid.', 'අවවාදයයි / Warning', 'BS12', 'Warning', function () {
                            scannedBarcode = null;
                            $("#barcodeBcodeTxt").val("");
                            $("#barcodeBcodeTxt").focus();
                            errorbeforestauscomplete = errorbeforestauscomplete + ' ' + 'This barcode is not valid.'
                            sacanComplete = false;
                            EnableControllers();
                            $('#barcodeBcodeTxt').val('');
                            $('#barcodeBcodeTxt').focus();
                            $('#barcodeBcodeTxt').select();
                        });
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    formatErrorMessage(jqXHR, errorThrown, "BFLProductionBarcode");
                    errorbeforestauscomplete = errorbeforestauscomplete + ' ' + 'Get Shedulle by Barcode API Error.'
                    sacanComplete = false;
                    EnableControllers();
                    $('#barcodeBcodeTxt').val('');
                    $('#barcodeBcodeTxt').focus();
                    $('#barcodeBcodeTxt').select();
                }
            });
        } else {
            msgBox.show('ස්කෑන් පද්ධතිය නවතා දමා ඇත. කවුන්ටර හෝ වෙනත් වලංගු කිරීම් සඳහා පරීක්ෂා කරන්න',
                        'The scan system is on halt. check for counter or other validations',
                        'අවවාදයයි / Warning',
                        'BS22',
                        'Warning',
                        null);
            $('#barcodeBcodeTxt').val('');
            $('#barcodeBcodeTxt').focus();
            EnableControllers();
        }      
    }

    function updateBarcodeScan() {
        refreshmsgBoxHeaderStyle();
        var UserInList = [];
        ProdScanType = 0;

        if (selectedScanAction == Answer.Null) {
            EnableControllers();
            return;
            errorbeforestauscomplete = errorbeforestauscomplete + ' ' + 'selected Scan Action Answer in null.'
            sacanComplete = false;
        }

        var sModeQuantitiyText = 0;
        var tagQuantiity = ((scannedBarcode.qty01 - (scannedBarcode.qty02 + scannedBarcode.qty03)) - (scannedBarcode.qty01NS - (scannedBarcode.qty02NS + scannedBarcode.qty03NS)));
        var useableqty = 0;

        //SMode validations
        if(selectedGroupTag != null) {
            if(scanMode != 0 && selectedGroupTag.sMode == 1) {
                if($('#quantitiyTxt').val() != "") {
                    sModeQuantitiyText = parseInt($('#quantitiyTxt').val());
                } else {
                    msgBox.show('ක්‍රියාවලියට පෙර කරුණාකර ප්‍රමාණයක් ඇතුළත් කරන්න.', 'Please enter a quantity before process.', 'අවවාදයයි / Warning', 'BS15', 'Warning', function () {
                        $('#quantitiyTxt').focus();
                    });
                    errorbeforestauscomplete = errorbeforestauscomplete + ' ' + 'Please enter a quantity before process.'
                    sacanComplete = false;
                    EnableControllers();
                    return; 
                }

                if(sModeQuantitiyText == 0) {
                    msgBox.show('ප්‍රමාණය 0 විය නොහැක.', 'Quantity cannot be 0', 'අවවාදයයි / Warning', 'BS15', 'Warning', function () {
                        $('#quantitiyTxt').focus();
                    });
                    errorbeforestauscomplete = errorbeforestauscomplete + ' ' + 'Quantity cannot be 0.'
                    sacanComplete = false;
                    EnableControllers();
                    return;
                } else if(sModeQuantitiyText > tagQuantiity) {
                    msgBox.show('ඔබට ටැග් ප්‍රමාණයට වඩා ඇතුළත් කළ නොහැක.', 'you cannot enter more than tag quantity', 'අවවාදයයි / Warning', 'BS15', 'Warning', function () {
                        $('#quantitiyTxt').focus();
                    });
                    errorbeforestauscomplete = errorbeforestauscomplete + ' ' + 'you cannot enter more than tag quantity.'
                    sacanComplete = false;
                    EnableControllers();
                    return;
                } else if(selectedGroupSize == null) {
                    msgBox.show('ඉදිරියට යාමට පෙර කරුණාකර Size තෝරන්න.', 'Please select a size before proceed.', 'අවවාදයයි / Warning', 'BS15', 'Warning', function () {
                        $('#quantitiyTxt').focus();
                    });
                    errorbeforestauscomplete = errorbeforestauscomplete + ' ' + 'you cannot enter more than tag quantity.'
                    sacanComplete = false;
                    EnableControllers();
                    return;
                } else if(selectedGroupSize.l5id == 0) {
                    msgBox.show('තෝරාගත් Size අංකය 0 වේ. කරුණාකර නැවත උත්සාහ කරන්න..', 'The selected size no is 0. Please try again.', 'අවවාදයයි / Warning', 'BS15', 'Warning', function () {
                        $('#quantitiyTxt').focus();
                    });
                    errorbeforestauscomplete = errorbeforestauscomplete + ' ' + 'you cannot enter more than tag quantity.'
                    sacanComplete = false;
                    EnableControllers();
                    return;
                }

                useableqty = sModeQuantitiyText;
            } else {
                useableqty = tagQuantiity;
            }
        } else {
            useableqty = tagQuantiity;
        }

        goodQty = 0;
        scrapQty = 0;
        reworkQty = 0;

        //console.log('Called updateBarcodeScan method');

        if (selectedTxnMode == TransactionMode.Good && selectedScanAction == Action.Add) {
            //console.log('selectedTxnMode : Good , SelectedScanAction : Add');
            selectedFunction = AccessibleFunctions.GoodAdd;
            goodQty = useableqty;

            scrapQty = 0;
            reworkQty = 0;
        }
        else if (selectedTxnMode == TransactionMode.Good && selectedScanAction == Action.Reverse) {
            //console.log('selectedTxnMode : Good , SelectedScanAction : Reverse');
            selectedFunction = AccessibleFunctions.GoodReverse;
            goodQty = useableqty;

            scrapQty = 0;
            reworkQty = 0;
        }
        else if (selectedTxnMode == TransactionMode.Scrap && selectedScanAction == Action.Add) {
            //console.log('selectedTxnMode : Scrap , SelectedScanAction : Add');
            selectedFunction = AccessibleFunctions.ScrapAdd;
            scrapQty = useableqty;

            goodQty = 0;
            reworkQty = 0;
        }
        else if (selectedTxnMode == TransactionMode.Scrap && selectedScanAction == Action.Reverse) {
            //console.log('selectedTxnMode : Scrap , SelectedScanAction : Reverse');
            selectedFunction = AccessibleFunctions.ScrapReverse;
            scrapQty = useableqty;

            goodQty = 0;
            reworkQty = 0;
        }
        else if (selectedTxnMode == TransactionMode.Rework && selectedScanAction == Action.Add) {
            //console.log('selectedTxnMode : Rework , SelectedScanAction : Add');
            selectedFunction = AccessibleFunctions.ReworkAdd;
            reworkQty = useableqty;

            scrapQty = 0;
            goodQty = 0;
        }
        else if (selectedTxnMode == TransactionMode.Rework && selectedScanAction == Action.Reverse) {
            //console.log('selectedTxnMode : Rework , SelectedScanAction : Reverse');
            selectedFunction = AccessibleFunctions.ReworkReverse;
            reworkQty = useableqty;

            scrapQty = 0;
            goodQty = 0;
        }
        var selectedUserPermission = $.grep(userPermissionList, function (h) {
            return h.functionId == selectedFunction
        });
        //added || selectedTxnMode == TransactionMode.Rework //Nalinda
        //Check whether Scrap is selected as Transaction Mode but Scrap Rerason is not selected
        if (selectedTxnMode == TransactionMode.Scrap && selectedScrapReason == null && selectedScanAction != Action.Reverse) {
            if (selectedScanOption == ScanOption.Continue) {
                $('#divScrapReason').show();
                $('#scrapReasonSearchBtn').trigger('click');
            }
            else if (selectedScanOption == ScanOption.After) {
                $('#divScrapReason').show();
                $('#scrapReasonSearchBtn').trigger('click');
            }
            EnableControllers();
            return;
        }

        //added || selectedTxnMode == TransactionMode.Rework //Nalinda
        //Check whether Scrap is selected as Transaction Mode but Scrap Rerason is not selected
        if (selectedTxnMode == TransactionMode.Rework && selectedScrapReason == null && selectedScanAction != Action.Reverse) {
            if (selectedScanOption == ScanOption.Continue) {
                $('#divScrapReason').show();
                $('#reworkReasonSearchBtn').trigger('click');
            }
            else if (selectedScanOption == ScanOption.After) {
                $('#divScrapReason').show();
                $('#reworkReasonSearchBtn').trigger('click');
            }
            EnableControllers();
            return;
        }

        //added || selectedTxnMode == TransactionMode.Rework //Nalinda
        //Check whether Rework is selected as Transaction & Rework reason is selected  but Defect Opperation is not selected
        if (selectedTxnMode == TransactionMode.Rework && selectedScrapReason != null && selectedDefectOpp == null && selectedScanAction != Action.Reverse) {
            if (selectedScanOption == ScanOption.Continue) {
                openReworkReasonPannel();
            }
            else if (selectedScanOption == ScanOption.After) {
                openReworkReasonPannel();
            }
            EnableControllers();
            return;
        }



        //Check whether barcode style is matched with the user input
        if (scanMode == 1 && scannedBarcode.bagBarcode != $("#barcodeGroupTagTxt").val()) { //scanmode: 0 = bulk, 1 = individual
            msgBox.show('තෝරාගත් ටැගය තීරු කේතය සමඟ නොගැලපේ. කරුණාකර නැවත පරීක්ෂා කරන්න.', 'Seleted tag does not match with barcode. please chech again.', 'අවවාදයයි / Warning', 'BS15', 'Warning', function () {
                $('#tagSearchBtn').focus();
            });
            errorbeforestauscomplete = errorbeforestauscomplete + ' ' + 'Seleted tag does not matc with barcode.'
            sacanComplete = false;
            EnableControllers();
            return;
        }
        //Scan Option is set to Before but user has not selected either Scan Action and the Transaction Mode or both
        else if ((selectedScanOption == ScanOption.Before) &&
            ((selectedScanAction == Action.Non) || (selectedTxnMode == TransactionMode.Non))) {
            msgBox.show('කරුණාකර ස්කෑන් ක්‍රමය සහ ස්කෑන් අකාරය තෝරන්න.', 'Please select both Scan Action and Transaction Mode.', 'අවවාදයයි / Warning', 'BS17', 'Warning', null);
            errorbeforestauscomplete = errorbeforestauscomplete + ' ' + 'Please select both Scan Action and Transaction Mode.'
            sacanComplete = false;
            EnableControllers();
            return;
        }
        //Scan Option is set to Continue but user has not selected Scan Action and the Transaction Mode
        else if ((selectedScanOption == ScanOption.Continue) &&
            ((selectedScanAction == Action.Non) || (selectedTxnMode == TransactionMode.Non))) {
            msgBox.show('කරුණාකර ස්කෑන් ක්‍රමය සහ ස්කෑන් අකාරය තෝරන්න.', 'Please select both Scan Action and Transaction Mode.', 'අවවාදයයි / Warning', 'BS18', 'Warning', null);
            errorbeforestauscomplete = errorbeforestauscomplete + ' ' + 'Please select both Scan Action and Transaction Mode.'
            sacanComplete = false;
            EnableControllers();
            return;
        }
        else if (!userPermissionList.some(permission => permission.functionId === selectedFunction)) {
            msgBox.show('ඔබට තෝරන ලද ස්කෑන් ක්‍රමය සහ ස්කෑන් අකාරය සඳහා අවසර නැත.', 'You do not have access to selected Scan Action and Transaction Mode.', 'අවවාදයයි / Warning', 'BS19', 'Warning', null);
            errorbeforestauscomplete = errorbeforestauscomplete + ' ' + 'You do not have access to selected Scan Action and Transaction Mode.'
            sacanComplete = false;
            EnableControllers();
            return;
        }
        else if (!userPermissionList.some(permission => permission.functionId === selectedFunction)) {
            msgBox.show('ඔබට තෝරන ලද ස්කෑන් ක්‍රමය සහ ස්කෑන් අකාරය සඳහා අවසර නැත.', 'You do not have access to selected Scan Action and Transaction Mode.', 'අවවාදයයි / Warning', 'BS20', 'Warning', null);
            errorbeforestauscomplete = errorbeforestauscomplete + ' ' + 'You do not have access to selected Scan Action and Transaction Mode.'
            sacanComplete = false;
            EnableControllers();
            return;
        }
        else if (!(selectedUserPermission.some(permission => permission.sbuCode === selectedWorkflow.sbucode)) &&
            !(selectedUserPermission.some(permission => permission.facCode === selectedWorkflow.facCode)) &&
            !(selectedUserPermission.some(permission => permission.depId === clientconfig.opCode1))) {
            msgBox.show('තෝරන ලද SBU Code - ' + selectedWorkflow.sbucode + ' Factory Code - ' + selectedWorkflow.facCode + ' Operation Code - ' + clientconfig.opCode1 + ' සඳහා ඔබට අවසර නැත.', 'You do not have access to selected SBU Code - ' + selectedWorkflow.sbucode + ' Factory Code - ' + selectedWorkflow.facCode + ' Operation Code - ' + clientconfig.opCode1 + '.', 'අවවාදයයි / Warning', 'BS21', 'Warning', null);
            errorbeforestauscomplete = errorbeforestauscomplete + ' ' + 'You do not have access to selected SBU Code.'
            sacanComplete = false;
            EnableControllers();
            return;
        }

        else {
            if (selectedScanAction == Action.Add) {
                var plussminus = 1;
            }
            else if (selectedScanAction == Action.Reverse) {
                var plussminus = 2;
            }

            var ScannedItem = {};
            if(selectedGroupTag != null) {
                if(scanMode != 0 && selectedGroupTag.sMode == 1) {
                    ScannedItem = {
                        "WfdepinstId": selectedWfConfig.wfdepinstId,
                        "WFID": wfid,
                        "FacCode": selectedWorkflow.facCode,
                        "Sbucode": selectedWorkflow.sbucode,
                        "GroupCode": selectedWorkflow.groupCode,
                        "ScanType": scanMode, //scanmode: 0 = bulk, 1 = individual
                        "StyleId": scannedBarcode.styleId,
                        "ScheduleId": scannedBarcode.scheduleId,
                        "ColorId": (scannedBarcode === null ? 0 : scannedBarcode.colorId),
                        "ColorIdUI": (scannedBarcode === null ? 0 : scannedBarcode.l4id),
                        "SizeId": selectedGroupSize.l5id,
                        "EnteredQtyGd": (plussminus === 1 ? goodQty : goodQty * -1),
                        "EnteredQtyScrap": (plussminus === 1 ? scrapQty : scrapQty * -1),
                        "EnteredQtyRw": (plussminus === 1 ? reworkQty : reworkQty * -1),
                        "Barcode": $("#barcodeGroupTagTxt").val(),
                        "BagBarCodeNo": "",
                        "SMode": (selectedGroupTag === null ? 0 : selectedGroupTag.sMode),
                        "CounterNumber": 0,
                        "BagSize": 0,
                        "BagStatus": 1,
                        "HourNo": 0,
                        "RRId": (selectedScrapReason === null ? null : selectedScrapReason.rrid),
                        "DOpsId": (selectedDefectOpp === null ? null : selectedDefectOpp.dopsId),
                        "RRType": selectedTxnMode,
                        "RRName": (selectedScrapReason === null ? null : selectedScrapReason.rrname),
                        "JobNo": "",
                        "CreatedBy": txUser.userId,
                        "TeamId": selectedWfConfig.teamId,
                        "CreatedMachine": clientconfig.clientId,
                        "TxnMode": selectedTxnMode,
                        "PlussMinus": plussminus,
                        "OperationCode": clientconfig.opCode1,
                        "ProdScanType": ProdScanType,
                    };
                } else {
                    ScannedItem = {
                        "WfdepinstId": selectedWfConfig.wfdepinstId,
                        "WFID": wfid,
                        "FacCode": selectedWorkflow.facCode,
                        "Sbucode": selectedWorkflow.sbucode,
                        "GroupCode": selectedWorkflow.groupCode,
                        "ScanType": scanMode, //scanmode: 0 = bulk, 1 = individual
                        "StyleId": scannedBarcode.styleId,
                        "ScheduleId": scannedBarcode.scheduleId,
                        "ColorId": (scannedBarcode === null ? 0 : scannedBarcode.colorId),
                        "ColorIdUI": (scannedBarcode === null ? 0 : scannedBarcode.l4id),
                        "SizeId": (scannedBarcode === null ? 0 : scannedBarcode.sizeId),
                        "EnteredQtyGd": (plussminus === 1 ? goodQty : goodQty * -1),
                        "EnteredQtyScrap": (plussminus === 1 ? scrapQty : scrapQty * -1),
                        "EnteredQtyRw": (plussminus === 1 ? reworkQty : reworkQty * -1),
                        "Barcode": $("#barcodeBcodeTxt").val(),
                        "BagBarCodeNo": "",
                        "SMode": (selectedGroupTag === null ? 0 : selectedGroupTag.sMode),
                        "CounterNumber": 0,
                        "BagSize": 0,
                        "BagStatus": 1,
                        "HourNo": 0,
                        "RRId": (selectedScrapReason === null ? null : selectedScrapReason.rrid),
                        "DOpsId": (selectedDefectOpp === null ? null : selectedDefectOpp.dopsId),
                        "RRType": selectedTxnMode,
                        "RRName": (selectedScrapReason === null ? null : selectedScrapReason.rrname),
                        "JobNo": "",
                        "CreatedBy": txUser.userId,
                        "TeamId": selectedWfConfig.teamId,
                        "CreatedMachine": clientconfig.clientId,
                        "TxnMode": selectedTxnMode,
                        "PlussMinus": plussminus,
                        "OperationCode": clientconfig.opCode1,
                        "ProdScanType": ProdScanType,
                    };
                }
            } else {
                ScannedItem = {
                    "WfdepinstId": selectedWfConfig.wfdepinstId,
                    "WFID": wfid,
                    "FacCode": selectedWorkflow.facCode,
                    "Sbucode": selectedWorkflow.sbucode,
                    "GroupCode": selectedWorkflow.groupCode,
                    "ScanType": scanMode, //scanmode: 0 = bulk, 1 = individual
                    "StyleId": scannedBarcode.styleId,
                    "ScheduleId": scannedBarcode.scheduleId,
                    "ColorId": (scannedBarcode === null ? 0 : scannedBarcode.colorId),
                    "ColorIdUI": (scannedBarcode === null ? 0 : scannedBarcode.l4id),
                    "SizeId": (scannedBarcode === null ? 0 : scannedBarcode.sizeId),
                    "EnteredQtyGd": (plussminus === 1 ? goodQty : goodQty * -1),
                    "EnteredQtyScrap": (plussminus === 1 ? scrapQty : scrapQty * -1),
                    "EnteredQtyRw": (plussminus === 1 ? reworkQty : reworkQty * -1),
                    "Barcode": $("#barcodeBcodeTxt").val(),
                    "BagBarCodeNo": "",
                    "SMode": (selectedGroupTag === null ? 0 : selectedGroupTag.sMode),
                    "CounterNumber": 0,
                    "BagSize": 0,
                    "BagStatus": 1,
                    "HourNo": 0,
                    "RRId": (selectedScrapReason === null ? null : selectedScrapReason.rrid),
                    "DOpsId": (selectedDefectOpp === null ? null : selectedDefectOpp.dopsId),
                    "RRType": selectedTxnMode,
                    "RRName": (selectedScrapReason === null ? null : selectedScrapReason.rrname),
                    "JobNo": "",
                    "CreatedBy": txUser.userId,
                    "TeamId": selectedWfConfig.teamId,
                    "CreatedMachine": clientconfig.clientId,
                    "TxnMode": selectedTxnMode,
                    "PlussMinus": plussminus,
                    "OperationCode": clientconfig.opCode1,
                    "ProdScanType": ProdScanType,
                };
            }

            //console.log('Assigning Bag Barcode Details');
            
            //console.log('Scanned Item (Sent to DCAP db)..');
            console.log(ScannedItem);
            UserInList.push(ScannedItem);
            $('#lastBarcodeDataLabel').html($("#barcodeBcodeTxt").val());

            validateTravelBarcode(UserInList);
        }
    }

    function validateTravelBarcode(UserInList){
        //console.log(selectedWfConfig);
        if(scanMode != 1){ ////scanmode: 0 = bulk, 1 = individual
            if(selectedWfConfig.oppValidationQty == 0){
                checkForScanType(UserInList);
            } else {
                ValidateAlreadyScannedBarcodes = ""; 
                validateBarcodeCount = 0;    
                ScanDataBackupForScanType = UserInList;
                openValidateTypeWindow();
            }
        } else {
            checkForScanType(UserInList);
        }
    }

    function openValidateTypeWindow(){
        //$("#tagScanOk").removeAttr("disabled");
        $("#tagScanOk").attr("disabled", "disabled");
        $('#barcode-count').html('');
        validateBarcodeCount = 0;
        
        tagValidateWindow = $("#prodValidateScanBarcodeWindow").kendoWindow({
                width: "60%",
                title: "Validate Barcode",
                actions: ["Close"],
                modal: true,
                resizable: false,
                draggable: false,
                pinned: true,
                close: resetControlsAfterScan
            }).data("kendoWindow");
        
        tagValidateWindow.wrapper.find('.k-window-titlebar').css({
                'background-color': 'black',
                'font-size': '18px',
                'color': 'white'
            });
        
        var arrows = [38, 40];
        tagValidateWindow.open().center();
    }

    function scanValidateBarcodeTxt(){
        //console.log(ScanDataBackupForScanType);
        var traveltagquantiity = TotalQuantitiy;
        var scanedbarcode = $('#validateBarcodeBcodeTxt').val();
        if(ValidateAlreadyScannedBarcodes.includes(scanedbarcode)){
            msgBox.show('සඳහන් කළ තීරු කේතය දැනටමත් පරිලෝකනය කර ඇත.', 'The mentioned garment barcode is already scanned.', 'අවවාදයයි / Warning', 'APIERR02', 'Warning', null);
            $('#validateBarcodeBcodeTxt').val('');
            $('#validateBarcodeBcodeTxt').focus();
            $('#validateBarcodeBcodeTxt').select();
        } else {
            if(ScanDataBackupForScanType[0] != null){
                var oppValidationQty = selectedWfConfig.oppValidationQty;
                //console.log(selectedWfConfig);
                $.ajax({
                    url: '@ViewBag.APIURL/Lookup/ValidateTravelBarcodebyBarcode?Barcode=' + scanedbarcode + '&TravelBarcode=' + ScanDataBackupForScanType[0].Barcode,
                    type: 'GET',
                    dataType: 'json',
                    //async: false,
                    contentType: 'application/json',
                    beforeSend: function () {
                        //$("#ajaxBusy").show();
                    },
                    complete: function () {
                        //$("#ajaxBusy").hide();
                    },
                    success: function (response) {
                        //Modifed by NimanthaH
                        if(response) {
                            validateBarcodeCount = validateBarcodeCount + 1;
                            ValidateAlreadyScannedBarcodes = ValidateAlreadyScannedBarcodes + " , " + scanedbarcode;
                            $('#barcode-count').html(validateBarcodeCount);
                            if(traveltagquantiity >= oppValidationQty){
                                if(validateBarcodeCount == oppValidationQty){
                                    validateBarcodeCount = 0;
                                    checkForScanType(ScanDataBackupForScanType);
                                    tagValidateWindow.close();
                                }
                            } else {
                                if(validateBarcodeCount == traveltagquantiity){
                                    validateBarcodeCount = 0;
                                    checkForScanType(ScanDataBackupForScanType);
                                    tagValidateWindow.close();
                                }
                            }
                            $('#validateBarcodeBcodeTxt').val('');
                            $('#validateBarcodeBcodeTxt').focus();
                            $('#validateBarcodeBcodeTxt').select();
                        } else {
                            $('#validateBarcodeBcodeTxt').val('');
                            $('#validateBarcodeBcodeTxt').focus();
                            $('#validateBarcodeBcodeTxt').select();
                            msgBox.show('ඇතුළත් කළ තීරු කේතය තෝරාගත් සංචාරක තීරු කේතයේ නොමැත.', 'The entered barcodeis not in selected travel barcode.', 'අවවාදයයි / Warning', 'APIERR02', 'Warning', null);
                        }
                    },

                });
            }
        }
        $('#validateBarcodeBcodeTxt').val('');
            $('#validateBarcodeBcodeTxt').focus();
            $('#validateBarcodeBcodeTxt').select();
    }

    function checkForScanType(UserInList) {
        if ((userPermissionList.some(permission => permission.functionId === AccessibleFunctions.WashingProductionUpdate)) && UserInList[0].PlussMinus == 1) {
            ScanDataBackupForScanType = UserInList;
            openScanTypeWindow();
            /*msgBox.show('ඔබ තෝරාගත් සංචාරක ටැගය නිෂ්පාදනය අවසන් කිරීමට උත්සාහ කරයි. ඔබට ඉදිරියට යාමට අවශ්‍යද?', 'You are trying to finish the production of selected travel tag. do you want to continue?', 'අවවාදයයි / Warning', 'BS15', 'Confirm', function () {
                if(scanMode == 0){ //scanmode: 0 = bulk, 1 = individual
                    UserInList[0].ProdScanType = 1;
                } else {
                    UserInList[0].ProdScanType = 2;
                }
                checkforaongoingbaginlivecounter(UserInList);
            }, 
            function() {
                $("#barcodeBcodeTxt").val("");
                $("#barcodeBcodeTxt").focus();
                EnableControllers();
            });*/
            
        } else {
            checkforaongoingbaginlivecounter(UserInList);
        }
    }

    function openScanTypeWindow(){
        ProdScanType = -1;
        $("input:radio[name=radio2]")[0].checked = false;
        $("input:radio[name=radio2]")[1].checked = false;
        ProdScanTypeWindow = $("#prodScanTypeSelectWindow").kendoWindow({
                width: "40%",
                title: "Scan Type",
                actions: ["Close"],
                modal: true,
                resizable: false,
                draggable: false,
                pinned: true,
                close: onProdScanTypeClose
            }).data("kendoWindow");
        
        ProdScanTypeWindow.wrapper.find('.k-window-titlebar').css({
                'background-color': 'black',
                'font-size': '18px',
                'color': 'white'
            });
        
        var arrows = [38, 40];
        ProdScanTypeWindow.open().center();
    }

    function onProdScanTypeClose() {
        $("#barcodeBcodeTxt").val('');
        $("#barcodeBcodeTxt").focus();
        $("#barcodeBcodeTxt").select();
    }

    function selectProdScanType(n) {
        ProdScanType = n; //0 = bypass 1 = bulk, 2 = individual
    }

    function selectProdScanTypeOk(){
        if(ProdScanType == -1) {
            msgBox.show('', 'Please select a type before procced', 'අවවාදයයි / Warning', 'APIERR02', 'Warning', null);
        } else { 
            ProdScanTypeWindow.close();
            ScanDataBackupForScanType[0].ProdScanType = ProdScanType;
            checkforaongoingbaginlivecounter(ScanDataBackupForScanType);
        }
    }

    //Check For Ongoing Bags in Live Conter : START
    function checkforaongoingbaginlivecounter(UserInList) {
        if(selectedWfConfig.poCounterEnable == 1) {
            if(selectedWfConfig.poCounterNumber == 1){ //
                if(UserInList[0].EnteredQtyGd > 0 ) {
                    sentToDCAPdb(UserInList);
                } else {
                    console.log(UserInList);
                    if(UserInList[0].EnteredQtyRw <= 0 && UserInList[0].EnteredQtyScrap <= 0){
                        //Skip
                        sentToDCAPdb(UserInList);
                    } else {  
                        if(runningPOCounters.length != 0) {
                            var query = {styleId: UserInList[0].StyleId, scheduleId: UserInList[0].ScheduleId, colorId: UserInList[0].ColorId, travelBarCodeNo: scannedBarcode.bagBarcode, rrType: selectedTxnMode, rrId: parseInt(selectedScrapReason.rrid)};
                            var result = runningPOCounters.filter(search, query);

                            //console.log("counter search results checker :", runningPOCounters, query, result);

                            if(result.length != 0){
                                sentToDCAPdb(UserInList);
                            } else {
                                ScanDataBackup = UserInList[0];
                                $("#bagBarcodeBcodeTxt").removeAttr("disabled");
                                $('#BAGBtnClear').attr("disabled", "disabled");
                                OpenPOCounterPannel(-1);
                            }
                        } else {
                            ScanDataBackup = UserInList[0];
                            $("#bagBarcodeBcodeTxt").removeAttr("disabled");
                            $('#BAGBtnClear').attr("disabled", "disabled");
                            OpenPOCounterPannel(-1);
                        }
                    }
                }
            } else {
                sentToDCAPdb(UserInList);
            }
        } else {
            sentToDCAPdb(UserInList);
        }
    }

    //Search function to search to arrays
    function search(user){
        return Object.keys(this).every((key) => user[key] === this[key]);
    }
    //Check For Ongoing Bags in Live Conter : END

    //Get Array max value
    function sortByAttribue(arr, attribute) {
        return arr.sort(function(a,b) { 
            return a[attribute] > b[attribute];
        });
    }

    //Changed by NimanthaH
    function OpenPOCounterPannel(arg) {
        if(arg != -1){
            selectedScanCounterId = $('#POCuntID' + arg).text()
            $('#bagBarcodeBcodeTxt').val($('#BagBarcodeVal' + arg).text());
            $('#bagSizeTxt').val($('#BagSizeVal' + arg).text());
            $("#bagBarcodeBcodeTxt").attr("disabled", "disabled");
            $('#counterNumber').val($('#counterNumber' + arg).text());
            $("#counterNumber").attr("disabled", "disabled");
        }
        else {
            var cpunterNumber = 1;
            if(runningPOCounters.length != 0) {
                cpunterNumber = sortByAttribue(runningPOCounters, "counterNumber")[0].counterNumber;
            }
            selectedScanCounterId = "new counter";
            $("#bagBarcodeBcodeTxt").attr("disabled", "disabled");
            $("#counterNumber").removeAttr("disabled");
            $('#bagBarcodeBcodeTxt').val("");
            $('#bagSizeTxt').val("");
            $('#counterNumber').val(parseInt(cpunterNumber) + 1);

            $.ajax({
                url: '@ViewBag.APIURL/Lookup/GetBuddyBarcodeByInstId?WfdepinstId=' + selectedWfConfig.wfdepinstId + '&CounterNumber=' + (parseInt(cpunterNumber) + 1),
                type: 'GET',
                dataType: 'json',
                async: false,
                contentType: 'application/json',
                beforeSend: function () {
                    $("#ajaxBusy").show();
                },
                complete: function () {
                    $("#ajaxBusy").hide();
                },
                success: function (response) {
                    if(response == null || response == ""){
                        msgBox.show('Buddy tag generation failed.','ටැග් අංක උත්පාදනය අසාර්ථක විය' ,'අවවාදයයි / Warning','BS22','Warning',null);
                        $("#barcodeBcodeTxt").val("");
                    } else {
                        $("#bagBarcodeBcodeTxt").val(response);
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    formatErrorMessage(jqXHR, errorThrown, "BFLProductionBarcode");
                }
            });
        }

        if (selectedScanCounterId != "") {
            poCounterResetWindow = $("#poCounterResetWindow").kendoWindow({
                width: "60%",
                //height: "64%",
                title: "Counter Start / Reset",
                visible: false,
                actions: [
                    "Close"
                ],
                close: function(e) {
                    $("#barcodeBcodeTxt").val("");
                    resetControlsAfterScan();
                    EnableInputs();
                    EnableControllers();
                    $("#barcodeBcodeTxt").focus();
                },
                modal: true,
                resizable: false,
                draggable: false,
                activate: function () {
                    $("#bagSizeTxt").select();
                    $("#bagSizeTxt").focus();
                },
                pinned: true,
            }).data("kendoWindow");

            poCounterResetWindow.wrapper.find('.k-window-titlebar').css({
                'background-color': 'black',
                'font-size': '18px',
                'color': 'white'
            });

            var arrows = [38, 40];
            poCounterResetWindow.open().center();

            //Declare if any Pass variables
            if(arg != -1) {
                $('#CounterID').html(selectedScanCounterId);
                $('#styleTxt').html($('#Style' + arg).text());
                $('#sheduleTxt').html($('#Shedule' + arg).text());
                $('#zFeatureTxt').html($('#ZFeature' + arg).text());
                $('#poTxt').html($('#PO' + arg).text());
                $('#colorTxt').html($('#Color' + arg).text());
                $('#cutQuantityTxt').html($('#CutQuantity' + arg).text());
                $('#currentQuantityTxt').html($('#POCunt' + arg).text());
                $('#currentQuantityNumber').html($('#POCuntNumber' + arg).text());
                $("#bagSizeTxt").select();

                $('#TravelTagTxt').html($('#TravelTagNo' + arg).text());
                $('#rejectTypeTxt').html($('#RejectType' + arg).text());
                $('#rejectReasonTxt').html($('#RejectReason' + arg).text());
                $('#rejectIdTxt').html($('#RejectId' + arg).text());
            } else {
                $('#CounterID').html(selectedScanCounterId);
                $('#styleTxt').html(scannedBarcode.styleNo);
                $('#sheduleTxt').html(scannedBarcode.scheduleNo);
                $('#zFeatureTxt').html(scannedBarcode.zfeature);
                $('#poTxt').html(scannedBarcode.poNo);
                $('#colorTxt').html(scannedBarcode.colorNo);
                $('#cutQuantityTxt').html('-');
                $('#currentQuantityTxt').html('1');
                $('#currentQuantityNumber').html('1');

                $('#TravelTagTxt').html(scannedBarcode.bagBarcode);
                $('#rejectTypeTxt').html(selectedTxnMode);
                $('#rejectReasonTxt').html(selectedScrapReason.rrname);
                $('#rejectIdTxt').html(selectedScrapReason.rrid);
            }
            return; 
        }
    }

    function sentToDCAPdb(UserInList){
        refreshmsgBoxHeaderStyle();
        if (flag) {
                $.ajax({
                    url: '@ViewBag.APIURL/BusinessLogics/UpdateTravelBCScanData',
                    type: 'POST',
                    dataType: 'json',
                    //async: false,
                    data: JSON.stringify(UserInList),
                    contentType: 'application/json; charset=utf-8',
                    beforeSend: function () {
                        $("#ajaxBusy").show();
                        flag = false;
                    },
                    complete: function () {
                        $("#ajaxBusy").hide();
                        flag = true;
                    },
                    success: function (data) {
                        //Check whether barcode is exist in the db
                        //console.log('Calling UpdateBCScanData API succeded.');
                        if (data[0] != null) {
                            //console.log('UpdateBCScanData API result received from DCAP db..');
                            
                            var checker = true;
                            var databc = null;

                            for (i = 0; i < data.length; i++) {
                                if(checker) {
                                    checker = data[i].saveSuccessfull;
                                    databc = data[i];
                                } 
                            }

                            if (checker) {
                                for (i = 0; i < data.length; i++) {
                                    finalizeBarcodeUpdate(data[i], i);
                                }
                                if (selectedScanOption == ScanOption.After || selectedScanOption == ScanOption.Continue) {
                                    $("#barcodeBcodeTxt").focus();
                                }
                                EnableControllers();
                            } else {
                                finalizeBarcodeUpdate(databc);
                                $('#scannedStatusDataLabel').removeClass('control-datalabel-scannedstatus-pass');
                                $('#scannedStatusDataLabel').addClass('blinktext');
                                $('#scannedStatusDataLabel').addClass('control-datalabel-scannedstatus-fail');
                                $('#scannedStatusDataLabel').html('Fail');
                                scannedStatus = ScannedStatus.Fail;

                                if(scanMode == 0) {
                                    showResult(data);
                                } else {
                                    msgBox.show('', data[0].responce[1], 'අවවාදයයි / Warning', 'APIERR01', 'Warning', function () {
                                        if (selectedScanOption == ScanOption.After || selectedScanOption == ScanOption.Continue) {
                                            if(selectedGroupTag != null) {
                                                if(selectedGroupTag.sMode == 1) {
                                                    $("#quantitiyTxt").val("");
                                                    $("#quantitiyTxt").select();
                                                    $("#quantitiyTxt").focus(); 
                                                } else {
                                                    $("#barcodeBcodeTxt").val("");
                                                    $("#barcodeBcodeTxt").select();
                                                    $("#barcodeBcodeTxt").focus();
                                                }
                                            } else {
                                                $("#barcodeBcodeTxt").val("");
                                                $("#barcodeBcodeTxt").select();
                                                $("#barcodeBcodeTxt").focus();
                                            }
                                        }
                                        if (selectedScanOption == ScanOption.Continue || selectedScanOption == ScanOption.After) {
                                            isValidBarcode = false;
                                        }
                                    });
                                }

                                
                                EnableControllers();
                                if (selectedScanOption == ScanOption.After || selectedScanOption == ScanOption.Continue) {
                                    if(selectedGroupTag != null) {
                                        if(selectedGroupTag.sMode == 1) {
                                            $("#quantitiyTxt").val("");
                                            $("#quantitiyTxt").select();
                                            $("#quantitiyTxt").focus(); 
                                        } else {
                                            $("#barcodeBcodeTxt").val("");
                                            $("#barcodeBcodeTxt").select();
                                            $("#barcodeBcodeTxt").focus();
                                        }
                                    } else {
                                        $("#barcodeBcodeTxt").val("");
                                        $("#barcodeBcodeTxt").select();
                                        $("#barcodeBcodeTxt").focus();
                                    }
                                }
                                if (selectedScanOption == ScanOption.Continue || selectedScanOption == ScanOption.After) {
                                    isValidBarcode = false;
                                }
                            }

                        } else {
                            $('#scannedStatusDataLabel').removeClass('control-datalabel-scannedstatus-pass');
                            $('#scannedStatusDataLabel').addClass('blinktext');
                            $('#scannedStatusDataLabel').addClass('control-datalabel-scannedstatus-fail');
                            $('#scannedStatusDataLabel').html('Fail');

                            scannedStatus = ScannedStatus.Fail;
                            msgBox.show('Return Array length from API is [0]', 'Error in Save', 'අවවාදයයි / Warning', 'APIERR02', 'Warning', function () {
                                if (selectedScanOption == ScanOption.After || selectedScanOption == ScanOption.Continue) {
                                    $("#barcodeBcodeTxt").val("");
                                    $("#barcodeBcodeTxt").focus();
                                }
                                if (selectedScanOption == ScanOption.Continue || selectedScanOption == ScanOption.After) {
                                    isValidBarcode = false;
                                    EnableControllers();
                                }
                            });

                        }
                        isScanCompleted = true;
                        if(selectedWfConfig.rejectReasonSelectMode == 0) {
                            resetControls();
                        } else {
                            resetControlsAfterScan();
                        }
                        
                        goodQty = 0;
                        scrapQty = 0;
                        reworkQty = 0;
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        formatErrorMessage(jqXHR, errorThrown, "BFLProductionBarcode");
                        EnableControllers();
                    }
                });

            }
    }

    function finalizeBarcodeUpdate(data, i) {
        //console.log(data, i);
        if(i == 0){
            $('#scannedStatusDataLabel').removeClass('blinktext');
            $('#scannedStatusDataLabel').removeClass('control-datalabel-scannedstatus-fail');
            $('#scannedStatusDataLabel').addClass('control-datalabel-scannedstatus-pass');

            if (data.txnMode == TransactionMode.Good) {
                $('#scannedStatusDataLabel').html('Good');
            }
            else if (data.txnMode == TransactionMode.Scrap) {
                $('#scannedStatusDataLabel').html('Scrap');
            }
            else if (data.txnMode == TransactionMode.Rework) {
                $('#scannedStatusDataLabel').html('Rework');
            }

            scannedStatus = ScannedStatus.Pass;
            //scannedCount += 1;
            //$('#scannedCountDataLabel').html(scannedCount);

            if((new Date()).getHours() == previoushour) {
                $('#crntHGood').html(parseInt($('#crntHGood').html()) + data.qtytoSaveGd);
                $('#crntHRework').html(parseInt($('#crntHScrap').html()) + data.qtytoSaveRw);
                $('#crntHScrap').html(parseInt($('#crntHRework').html()) + data.qtytoSaveScrap);
            } else {
                //$('#prevHGood').html($('#crntHGood').html());
                //$('#prevHRework').html($('#crntHRework').html());
                //$('#prevHScrap').html($('#crntHScrap').html());

                $('#crntHGood').html(data.qtytoSaveGd);
                $('#crntHRework').html(data.qtytoSaveRw);
                $('#crntHScrap').html(data.qtytoSaveScrap);

                previoushour = (new Date()).getHours();
            }

            $('#totQty').html(data.qtytoSaveGd + data.qtytoSaveRw + data.qtytoSaveScrap);

            $('#dataLabelScanCounter').html(data.scanCount);

            $("#BAGBtnClear").removeAttr("disabled");
            $('#bagBarcodeBcodeTxt').attr("disabled", "disabled");

            if(data.newCounter) {
                loadPOcounterValues();
            }

            if(data.isUpdateAvilable && data.counterId != 0) {
                updatePOcounterValues(data.counterId);
            }

            if(selectedWfConfig.poCounterNumber == 0) {
                loadPOcounterValues();
            }
        } else {
            $('#totQty').html(parseInt($('#totQty').html()) + (data.enteredqtytoSaveGdQtyGd + data.qtytoSaveRw + data.qtytoSaveScrap));

            $('#crntHGood').html(parseInt($('#crntHGood').html()) + data.qtytoSaveGd);
            $('#crntHRework').html(parseInt($('#crntHScrap').html()) + data.qtytoSaveRw);
            $('#crntHScrap').html(parseInt($('#crntHRework').html()) + data.qtytoSaveScrap);

            if(data.newCounter) {
                loadPOcounterValues();
            }

            if(data.isUpdateAvilable && data.counterId != 0) {
                updatePOcounterValues(data.counterId);
            }
        }

        EnableControllers();
        ScanDataBackup = null;
    }

    function viewFailData(data) {
        //if(ProdScanType == 2) {
            //var txt = true;
            //var person = prompt("Please enter the password:", "");

            /*if (person == null || person == "") {
                txt = false;
            } else if (person == "bulk123") {
                txt = true;
            }*/
            
            //if(txt) {
                showResult(data);
            //} else {
                //msgBox.show('Tag is not ready to dispatch as single barcodes.', 'Incorrect password', 'අවවාදයයි / Warning', 'APIERR02', 'Warning', null)
            //}
        //} else {
            showResult(data);
        //}
    }

    function showResult(data) {
        if(data.length > 0) {
            
            var gridData = [];
            $("#finalResultTableData").data('kendoGrid').dataSource.data([]);

            $.each(data, function (index, elements) {
                var object = {
                    Key: elements.styleId,
                    Style: elements.styleId,
                    Shedule: elements.scheduleId,
                    Color: elements.colorId,
                    PO: elements.pono,
                    Size: elements.sizeId,
                    Quantity: elements.qtytoSaveGd,
                    Status: (elements.saveSuccessfull == 1 ? "Can Report" : "Can't Report"),
                    Remark: (elements.responce.length != 0 ? elements.responce[0] : "")
                }

                gridData.push(object);
                        //EnableInputs();
            });

            $("#finalResultTableData").data('kendoGrid').dataSource.data(gridData);

            resultView = $("#finaleResultTable").kendoWindow({
                width: "55%",
                title: "Status",
                actions: ["Close"],
                modal: true,
                resizable: false,
                draggable: false,
                pinned: true,
                close: onProdScanTypeClose
            }).data("kendoWindow");

            var arrows = [38, 40];
            resultView.open().center();
        }
    }

    //Counter Window Controllers: START
    function DisableInputs() {
        $("#BAGBtnClear").attr('disabled', 'disabled');
        $("#BAGBtnReset").attr('disabled', 'disabled');

        $("#POBtnClear").attr('disabled', 'disabled');
        $("#POBtnReset").attr('disabled', 'disabled');
    }

    function EnableInputs() {
        $("#BAGBtnClear").removeAttr('disabled');
        $("#BAGBtnReset").removeAttr('disabled');

        $("#POBtnClear").removeAttr('disabled');
        $("#POBtnReset").removeAttr('disabled');
    }
    //Counter Window Controllers: END

    function checkForBagBarcodeExistence () {
        if($('#bagBarcodeBcodeTxt').val() != "" && sacanComplete) {
            $.ajax({
                url: '@ViewBag.APIURL/Lookup/CheckForBuddyBarcode?bagbarcode=' + $('#bagBarcodeBcodeTxt').val(),
                type: 'GET',
                dataType: 'json',
                async: false,
                contentType: 'application/json',
                beforeSend: function () {
                    $("#ajaxBusy").show();
                },
                complete: function () {
                    $("#ajaxBusy").hide();
                },
                success: function (response) {
                    return response.nobarcodes;
                },

            });
        }
    }
    // Added following function //Nalinda
    // Defect Operation selection pannel
    function closeTheBag() {
         $.ajax({
            url: '@ViewBag.APIURL/BusinessLogics/UpdateBuddyCounter?CounterId=' + selectedScanCounterId + '&Action=1&BagSize=' + $("#bagSizeTxt").val() + '&BagBarcode=' + $("#bagBarcodeBcodeTxt").val() + '&WfdepinstId=' + clientconfig.wfdepinstId + '&WFId=' + clientconfig.wfId + '&OperationCode=' + clientconfig.opCode1,
            type: 'POST',
            dataType: 'json',
            async: false,
            contentType: 'application/json; charset=utf-8',
            beforeSend: function () {
                $("#ajaxBusy").show();
            },
            complete: function () {
                $("#ajaxBusy").hide();
            },
            success: function (data) {
                //console.log('Calling Remove PO Counter API succeded.');
                if(!data.saveSuccessfull){
                    msgBox.show('වෙන් කිරීම අසාර්ථක විය.', 'Update failed.', 'අවවාදයයි / Warning', 'BS13', 'Warning', null)
                }
                else {
                    msgBox.show(data.responce, 'Buddy ටැගය සාර්ථකව නිර්මාණය කරන ලදි. Buddy tag successfully created.', 'අවවාදයයි / Warning', 'BS13', 'Warning', null)
                }

                if(data.message){
                    msgBox.show('', data.response, 'අවවාදයයි / Warning', 'APIERR01', 'Warning', null);
                }

                loadPOcounterValues();
                haltsystem = false;
                if(poCounterResetWindow != null) {
                    poCounterResetWindow.close();}
                EnableInputs();
                
            },
            error: function (jqXHR, textStatus, errorThrown) {
                formatErrorMessage(jqXHR, errorThrown, "BFLProductionBarcode");
            }
        });
    }

    function resetTheBag(BagSize, bagbarcode) {
        //console.log(bagbarcode, BagSize, selectedScanCounterId);
        $.ajax({
            url: '@ViewBag.APIURL/BusinessLogics/UpdateBuddyCounter?CounterId=' + selectedScanCounterId + '&Action=2&BagSize=' + BagSize + '&BagBarcode=' + bagbarcode + '&WfdepinstId=' + clientconfig.wfdepinstId + '&WFId=' + clientconfig.wfId + '&OperationCode=' + clientconfig.opCode1,
            type: 'POST',
            dataType: 'json',
            async: false,
            contentType: 'application/json; charset=utf-8',
            beforeSend: function () {
                $("#ajaxBusy").show();
            },
            complete: function () {
                $("#ajaxBusy").hide();
            },
            success: function (response) {
                //console.log('Calling Reset PO Counter API succeded.');
                if(!response.saveSuccessfull){
                    msgBox.show('වෙන් කිරීම අසාර්ථක විය.', 'Update failed.', 'අවවාදයයි / Warning', 'BS13', 'Warning', null)
                }
                    
                loadPOcounterValues();
                poCounterResetWindow.close();
            },
            error: function (jqXHR, textStatus, errorThrown) {
                formatErrorMessage(jqXHR, errorThrown, "BFLProductionBarcode");
            }
        });
    }

    function openReworkReasonPannel(arg) {
        reworkReasonSearchWindow = $("#reworkReasonSearchWindow").kendoWindow({
            width: "90%",
            height: "90%",
            title: "Rework Reason Search",
            visible: false,
            actions: [
                "Close"
            ],
            modal: true,
            resizable: false,
            draggable: false,
            pinned: true,
            activate: function () {
                $("#reworkReasonSearchWindowScrapTxt").select();
            },
            open: function (e) { $("html, body").css("overflow", "hidden"); },
            close: onReworkReasonSearchClose
        }).data("kendoWindow");
        reworkReasonSearchWindow.wrapper.find('.k-window-titlebar').css({
            'background-color': 'black',
            'font-size': '18px',
            'color': 'white'
        });
        GetRejectCat();
        reworkReasonSearchGrid = $("#reworkReasonSearchGrid").kendoGrid({
            autoBind: true,
            dataSource: {
                transport: {
                    read: {
                        url: '@ViewBag.APIURL/Lookup/GetReworkReasonsByCategory?RRType=4&DopsId=' + selectedDefectOpp.dopsId,
                        type: 'GET',
                        dataType: 'json',
                        async: false,
                        contentType: 'application/json; charset=utf-8'
                    }
                },
                schema: {
                    model: {
                        fields: {
                            rrid: { type: "string" },
                            scode: { type: "string" },
                            rrname: { type: "string" },
                            rrdesc: { type: "string" },
                            rrdescSin: { type: "string" },
                            rrdescTem: { type: "string" }
                        }
                    }
                }
            },
            height: "85%",
            width: "70%",
            scrollable: true,
            change: onChangeReworkReason,
            navigatable: true,
            selectable: "multiple cell",
            dataBound: function (e) {
                var cell = this.tbody.find("tr[role='row'] td:first");
                this.current(cell);
            },
            columns: [
                { field: "rrid", title: "Rework Reason Id", hidden: true },
                { field: "scode", title: "Short Code", width: "20%" },
                { field: "rrname", title: "Rework Reason Name", width: "20%" },
                { field: "rrdesc", title: "Rework Reason Description", width: "20%" },
                { field: "rrdescSin", title: "Rework Reason Sin", width: "20%", hidden: true },
                { field: "rrdescTem", title: "Rework Reason Tam", width: "20%", hidden: true }
            ]
        }).data("kendoGrid");
        var arrows = [38, 40];
        reworkReasonSearchGrid.table.on("keydown", function (e) {
            if (arrows.indexOf(e.keyCode) >= 0) {
                setTimeout(function () {
                    reworkReasonSearchGrid.select($("#rowSelection_active_cell").closest("tr"));
                }, 10);
            }
        });
        reworkReasonSearchWindow.one("activate", function () {
            reworkReasonSearchGrid.resize();
        });
        reworkReasonSearchWindow.open().center();
        $("#reworkReasonSearchWindowScrapTxt").keydown(function (e) {
            if (e.keyCode == 13) {
                reworkReasonSearchGrid.table.focus();
            }
        });
        $("#trxModeScrapBtn").attr("disabled", "disabled");
        $("#trxModeGoodBtn").attr("disabled", "disabled");

    }

    function resetToStartUp() {
        if (selectedScanOption != ScanOption.Non) {
            if (selectedScanOption == ScanOption.After) {
                $('#trxModeReworkBtn').removeClass('bs-buttonPressed-rework');
                $('#trxModeGoodBtn').removeClass('bs-buttonPressed-good');
                $('#trxModeScrapBtn').removeClass('bs-buttonPressed-scrap');
                $('#trxModeReworkBtn').addClass('bs-btn-primary-rework');
                $('#trxModeGoodBtn').addClass('bs-btn-primary-good');
                $('#trxModeScrapBtn').addClass('bs-btn-primary-scrap');
                $("#trxModeReworkBtn").attr("disabled", "disabled");
                $("#trxModeGoodBtn").attr("disabled", "disabled");
                $("#trxModeScrapBtn").attr("disabled", "disabled");

                $('#scanActionReverseBtn').removeClass('bs-buttonPressed-action');
                $('#scanActionAddBtn').addClass('bs-buttonPressed-action');
                $('#scanActionAddBtn').removeClass('bs-btn-primary-action');
                $('#scanActionReverseBtn').addClass('bs-btn-primary-action');

                $('#divScrapReason').hide();
                $("#barcodeScrapReasonTxt").val("");

                $("#barcodeBcodeTxt").removeAttr("disabled");
                $("#barcodeBcodeTxt").val("");
                $("#barcodeBcodeTxt").focus();

                $("#tagScanOk").attr("disabled", "disabled");

                selectedTxnMode = TransactionMode.Non;
                selectedScrapReason = Answer.Null;
                selectedFunction = Answer.Null;
                setPageControlsStartupStatus();
            }

            else if (selectedScanOption == ScanOption.Continue) {
                $('#trxModeReworkBtn').removeClass('bs-buttonPressed-rework');
                $('#trxModeGoodBtn').removeClass('bs-buttonPressed-good');
                $('#trxModeScrapBtn').removeClass('bs-buttonPressed-scrap');
                $('#trxModeReworkBtn').addClass('bs-btn-primary-rework');
                $('#trxModeGoodBtn').addClass('bs-btn-primary-good');
                $('#trxModeScrapBtn').addClass('bs-btn-primary-scrap');

                $('#scanActionReverseBtn').removeClass('bs-buttonPressed-action');
                $('#scanActionAddBtn').addClass('bs-buttonPressed-action');
                $('#scanActionAddBtn').removeClass('bs-btn-primary-action');
                $('#scanActionReverseBtn').addClass('bs-btn-primary-action');

                $('#divScrapReason').hide();
                $("#barcodeScrapReasonTxt").val("");

                $("#barcodeBcodeTxt").attr("disabled", "disabled");
                $("#barcodeBcodeTxt").val("");
                $('#trxModeGoodBtn').focus();

                $("#tagScanOk").attr("disabled", "disabled");

                selectedTxnMode = TransactionMode.Non;
                selectedScrapReason = Answer.Null;
                selectedFunction = Answer.Null;
                setPageControlsStartupStatus();
            }
        }
    }

    function resetControls() {
        //Scan Option is set to Before but user has not selected Scan Action and the Transaction Mode
        ValidateAlreadyScannedBarcodes = ""; 
        validateBarcodeCount = 0;

        sModeTagSelectDivisionRender(selectedGroupTag);         

        $('#lastTxMode').html(searchRefractive(selectedTxnMode, TransactionMode));
        $('#lastAction').html(searchRefractive(selectedScanAction, Action));

        if (selectedScanOption == ScanOption.Before) {
            $('#trxModeReworkBtn').removeClass('bs-buttonPressed-rework');
            $('#trxModeGoodBtn').removeClass('bs-buttonPressed-good');
            $('#trxModeScrapBtn').removeClass('bs-buttonPressed-scrap');
            $('#trxModeReworkBtn').addClass('bs-btn-primary-rework');
            $('#trxModeGoodBtn').addClass('bs-btn-primary-good');
            $('#trxModeScrapBtn').addClass('bs-btn-primary-scrap');

            $('#scanActionReverseBtn').removeClass('bs-buttonPressed-action');
            $('#scanActionAddBtn').removeClass('bs-buttonPressed-action');
            $('#scanActionReverseBtn').addClass('bs-btn-primary-action');
            $('#scanActionAddBtn').addClass('bs-btn-primary-action');

            $('#divScrapReason').hide();
            $("#barcodeScrapReasonTxt").val("");
            $("#barcodeBcodeTxt").attr("disabled", "disabled");
            $("#barcodeBcodeTxt").val("");


            selectedTxnMode = TransactionMode.Non;
            selectedScrapReason = Answer.Null;
            selectedFunction = Answer.Null;
        }
        else if (selectedScanOption == ScanOption.After) {
            //$('#dataLabelzFeature').html("");
            //$('#poDataLabel').html("");
            //$('#scheduleDataLabel').html("");
            //$('#sizeDataLabel').html("");
            //$('#bcColorDataLabel').html("");
            //$('#Quantitiy').html("");        


            $('#trxModeReworkBtn').removeClass('bs-buttonPressed-rework');
            $('#trxModeGoodBtn').removeClass('bs-buttonPressed-good');
            $('#trxModeScrapBtn').removeClass('bs-buttonPressed-scrap');
            $('#trxModeReworkBtn').addClass('bs-btn-primary-rework');
            $('#trxModeGoodBtn').addClass('bs-btn-primary-good');
            $('#trxModeScrapBtn').addClass('bs-btn-primary-scrap');
            $("#trxModeReworkBtn").attr("disabled", "disabled");
            $("#trxModeGoodBtn").attr("disabled", "disabled");
            $("#trxModeScrapBtn").attr("disabled", "disabled");

            $('#scanActionReverseBtn').removeClass('bs-buttonPressed-action');
            $('#scanActionAddBtn').addClass('bs-buttonPressed-action');
            $('#scanActionAddBtn').removeClass('bs-btn-primary-action');
            $('#scanActionReverseBtn').addClass('bs-btn-primary-action');

            $('#divScrapReason').hide();
            $("#barcodeScrapReasonTxt").val("");

            $("#barcodeBcodeTxt").removeAttr("disabled");
            $("#barcodeBcodeTxt").val("");
            $("#barcodeBcodeTxt").focus();
            $("#scrapReasonDataLabel").val("");
            $("#defectOpperation").val("");

            isValidBarcode = false;
            selectedTxnMode = TransactionMode.Non;
            selectedScrapReason = Answer.Null;
            selectedFunction = Answer.Null;

            selectActionAdd();
        }
        else if (selectedScanOption == ScanOption.Continue) {
            if (!isScanCompleted) {
                $('#dataLabelzFeature').html("");
                $('#poDataLabel').html("");
                $('#scheduleDataLabel').html("");
                $('#sizeDataLabel').html("");
                $('#bcColorDataLabel').html("");
                $('#Quantitiy').html("");        

            }
            $('#divScrapReason').hide();
            $("#barcodeScrapReasonTxt").val("");
            selectedScrapReason = Answer.Null;
            isValidBarcode = false;

            $("#barcodeBcodeTxt").removeAttr("disabled");
            $("#tagScanOk").attr("disabled", "disabled");
            $("#barcodeBcodeTxt").val("");
            $("#barcodeBcodeTxt").focus();
        }
        isScanCompleted = false;

    }

    function resetControlsAfterScan() {
        //Scan Option is set to Before but user has not selected Scan Action and the Transaction Mode  
        ValidateAlreadyScannedBarcodes = ""; 
        validateBarcodeCount = 0;                   

        $('#lastTxMode').html(searchRefractive(selectedTxnMode, TransactionMode));
        $('#lastAction').html(searchRefractive(selectedScanAction, Action));

        if (selectedScanOption == ScanOption.Before) {
            $('#trxModeReworkBtn').removeClass('bs-buttonPressed-rework');
            $('#trxModeGoodBtn').removeClass('bs-buttonPressed-good');
            $('#trxModeScrapBtn').removeClass('bs-buttonPressed-scrap');
            $('#trxModeReworkBtn').addClass('bs-btn-primary-rework');
            $('#trxModeGoodBtn').addClass('bs-btn-primary-good');
            $('#trxModeScrapBtn').addClass('bs-btn-primary-scrap');

            $('#scanActionReverseBtn').removeClass('bs-buttonPressed-action');
            $('#scanActionAddBtn').removeClass('bs-buttonPressed-action');
            $('#scanActionReverseBtn').addClass('bs-btn-primary-action');
            $('#scanActionAddBtn').addClass('bs-btn-primary-action');

            $("#barcodeBcodeTxt").attr("disabled", "disabled");
            $("#quantitiyTxt").val("");
            $("#barcodeBcodeTxt").val("");

            if(selectedTxnMode == TransactionMode.Good) {
                selectedTxnMode = TransactionMode.Non;
                selectedScrapReason = Answer.Null;
                $('#divScrapReason').hide();
                $("#barcodeScrapReasonTxt").val("");
            }

            selectedFunction = Answer.Null;
        }
        else if (selectedScanOption == ScanOption.After) {
            //$('#dataLabelzFeature').html("");
            //$('#poDataLabel').html("");
            //$('#scheduleDataLabel').html("");
            //$('#sizeDataLabel').html("");
            //$('#bcColorDataLabel').html("");
            //$('#Quantitiy').html("");        


            $('#trxModeReworkBtn').removeClass('bs-buttonPressed-rework');
            $('#trxModeGoodBtn').removeClass('bs-buttonPressed-good');
            $('#trxModeScrapBtn').removeClass('bs-buttonPressed-scrap');
            $('#trxModeReworkBtn').addClass('bs-btn-primary-rework');
            $('#trxModeGoodBtn').addClass('bs-btn-primary-good');
            $('#trxModeScrapBtn').addClass('bs-btn-primary-scrap');
            $("#trxModeReworkBtn").attr("disabled", "disabled");
            $("#trxModeGoodBtn").attr("disabled", "disabled");
            $("#trxModeScrapBtn").attr("disabled", "disabled");

            $('#scanActionReverseBtn').removeClass('bs-buttonPressed-action');
            $('#scanActionAddBtn').addClass('bs-buttonPressed-action');
            $('#scanActionAddBtn').removeClass('bs-btn-primary-action');
            $('#scanActionReverseBtn').addClass('bs-btn-primary-action');

            $("#barcodeBcodeTxt").removeAttr("disabled");
            $("#quantitiyTxt").val("");
            $("#barcodeBcodeTxt").val("");
            $("#barcodeBcodeTxt").focus();
            $("#scrapReasonDataLabel").val("");
            $("#defectOpperation").val("");

            if(selectedTxnMode == TransactionMode.Good) {
                selectedTxnMode = TransactionMode.Non;
                selectedScrapReason = Answer.Null;
                $('#divScrapReason').hide();
                $("#barcodeScrapReasonTxt").val("");
            }

            isValidBarcode = false;
            selectedFunction = Answer.Null;

            selectActionAdd();
        }
        else if (selectedScanOption == ScanOption.Continue) {
            if (!isScanCompleted) {
                $('#dataLabelzFeature').html("");
                $('#poDataLabel').html("");
                $('#scheduleDataLabel').html("");
                $('#sizeDataLabel').html("");
                $('#bcColorDataLabel').html("");
                $('#Quantitiy').html("");        

            }

            if(selectedTxnMode == TransactionMode.Good) {
                selectedScrapReason = Answer.Null;
                $('#divScrapReason').hide();
                $("#barcodeScrapReasonTxt").val("");
            }

            isValidBarcode = false;

            $("#barcodeBcodeTxt").removeAttr("disabled");
            $("#tagScanOk").attr("disabled", "disabled");
            $("#quantitiyTxt").val("");
            $("#barcodeBcodeTxt").val("");
            $("#barcodeBcodeTxt").focus();
        }
        isScanCompleted = false;

    }

    function populatePermissionList() {

        userPermissionList = JSON.parse(sessionStorage.getItem("UserPermissionList"));
        //console.log('Called populatePermissionList method. List is..');
        //console.log(userPermissionList);
        var uniqueUserPermissionList = [];
        for (i = 0; i < userPermissionList.length; i++) {
            if (uniqueUserPermissionList.indexOf(userPermissionList[i].funcName) === -1) {
                uniqueUserPermissionList.push(userPermissionList[i].funcName);
                $('#userpermissionlist').append('<div class="row"><label class="control-datalabel">' + userPermissionList[i].funcName + '</label></div>');
            }
        }
    }

    function getSessionInfo() {
        isValidClient = sessionStorage.getItem("IsValidClient");
        clientconfig = JSON.parse(sessionStorage.getItem("Clientconfig"));
        userPermissionList = JSON.parse(sessionStorage.getItem("UserPermissionList"));
        clientIP = sessionStorage.getItem("ClientIP");
        txUser = JSON.parse(sessionStorage.getItem("TxUser"));
        //console.log('Called getSessionInfo method. IsValidClient = ' + isValidClient);
    }

    function setPageControlsStartupStatus() {
        $('#trxModeBtnPanel').hide();
        $('#divScrapReason').hide();
        $('#scanActionButton').hide();
        $('#trxModeGoodBtn').hide();
        $('#trxModeScrapBtn').hide();
        $('#trxModeReworkBtn').hide();
        $('#scanActionAddBtn').hide();
        $('#scanActionReverseBtn').hide();
        $('#scannedCountDataLabel').html(scannedCount);
        $("#barcodeBcodeTxt").attr("disabled", "disabled");
        $('#scannedStatusDataLabel').html("");
        $('#lastBarcodeDataLabel').html("");
        $('#lastAction').html("");
        $('#lastTxMode').html("");

        sModeTagSelectDivisionRender(null);

        //Added during "After"
        $("#barcodeGroupTagTxt").val("");
        $("#groupTagDataLabel").html("");
        $("#barcodeColorTxt").val("");
        $("#colorDataLabel").html("");

        $("#pocounterdiv").hide();

        $("#tagScanOk").attr("disabled", "disabled");

        selectedGroupTag = null;
        selectedGroupSize = null;
        selectedGroupTagNo = null;
        selectedGroupDesc = null;
        selectedScanCounterId = null;
    }    

    function setMainOperationVisibility() {
        if (clientconfig.teamId == 0 || clientconfig.teamId == null) {
            $('#dvMainOpp').show();
        }
        else {
            $("#ddlMainOperation").data("kendoDropDownList").dataSource.data([]);
            $('#dvMainOpp').hide();
        }
    }

    function setClientConfigInfo() {
        //console.log(clientconfig.wfId);
        if(clientconfig.wfId == 0) {
            $('#main').hide();
            msgBox.show('සංචාරක ටැග් ක්‍රියාකාරිත්වය යාවත්කාලීන කිරීමට ඔබට අවසර නැත.', 'you dont ave permission to update travel tag operation.', 'අවවාදයයි / Warning', 'BS01', 'Warning', function(){window.location.href = "Menu";});
            //window.location.href = "Menu";
        }
        $('#dataLabelFactory').html(clientconfig.facName);
        $('#dataLabelTeam').html(clientconfig.teamName + '-[' + clientconfig.wfdepinstId + ']');
        //$('#dataLabelOperation').html(clientconfig.operationName);
        $('#dataLabelOperation').html(clientconfig.operationName);
        $('#dataLabelClientIP').html(clientIP);

    }    

    function onChangeGroupTag(arg) {
        var row = $(this.select()).closest("tr");
        var dataItem = groupTagSearchGrid.dataItem(row);

        if (dataItem == null)
            return;
        selectedGroupTag = dataItem;
        selectedGroupTagNo = dataItem.travelBarCodeNo;
        selectedGroupDesc = dataItem.color;
        //console.log(selectedGroupTag);

        if ($("#groupTagSearchWindowStyleTxt").val().length > 0) {
            GetClientByWF(dataItem.wfId, scanMode);
            refresValues();

            $("#barcodeGroupTagTxt").val(selectedGroupTagNo);
            $('#groupTagDataLabel').html(selectedGroupDesc);
            $('#trxModeScrapBtn').focus();
            sModeTagSelectDivisionRender(selectedGroupTag);
            //selectTrxModeScrap();         
        }
        else {
            $("#barcodeGroupTagTxt").val("");
            $("#groupTagSearchWindowStyleTxt").val("");
            $('#groupTagDataLabel').val("");
            $("#barcodeColorTxt").val("");
            selectedGroupTag = null;

        }
        groupTagSearchGrid.dataSource.data([]);
        groupTagSearchWindow.close();
    }

    function onChangeTagSize(arg) {
        var row = $(this.select()).closest("tr");
        var dataItem = tagSizeSearchGrid.dataItem(row);

        if (dataItem == null)
            return;
        selectedGroupSize = dataItem;

        if ($("#groupTagSearchWindowStyleTxt").val().length > 0) {
            $("#tagSizesTxt").val(selectedGroupSize.l5no);
            $('#tagSizeLabel').html(selectedGroupSize.l5desc);
            $('#trxModeScrapBtn').focus();
            //selectTrxModeScrap();         
        }
        else {
            $("#tagSizesTxt").val("");
            $("#groupTagSearchWindowStyleTxt").val("");
            $('#tagSizeLabel').val("");
            //selectedGroupSize = null;

        }
        
        tagSizeSearchGrid.dataSource.data([]);
        tagSizeSearchWindow.close();
    }

    function GetClientByWF(ttwfid, scanmode) {    //scanmode: 0 = bulk, 1 = individual 
        refreshmsgBoxHeaderStyle();
        if (ttwfid != null){ 
                $.ajax({
                url: '@ViewBag.APIURL/Security/GetClientByWfIdandIP?clientIP=' + clientconfig.clientIP + '&wfid=' + ttwfid + '&clientId=' + clientconfig.clientId + '&scanmode=' + scanmode,
                type: 'GET',
                dataType: 'json',
                async: false,
                contentType: 'application/json',
                beforeSend: function () {
                    $("#ajaxBusy").show();
                },
                complete: function () {
                    $("#ajaxBusy").hide();
                },
                success: function (response) {
                    if (response != null) {
                       var temwfdepinstId = clientconfig.wfdepinstId;

                        clientconfig = {
                                "userid": response.userid,
                                "clientId": response.clientId,
                                "dataCaptureMode": response.dataCaptureMode,
                                "facName": response.facName,
                                "loginMode": response.loginMode,
                                "opCode1": response.opCode1,
                                "opCode2": response.opCode2,
                                "operationName": response.operationName,
                                "recStatus": response.recStatus,
                                "selectMode": response.selectMode,
                                "teamId": response.teamId,
                                "teamName": response.teamName,
                                "facName": response.facName,
                                "wfdepinstId": response.wfdepinstId,
                                "wfId": ttwfid,
                                "clientIP": clientconfig.clientIP
                            };   
                           
 
                            if (clientconfig.teamId == 0 || clientconfig.teamId == null) {
                                setMainOperationVisibility();
                            }

                            if(temwfdepinstId !=  clientconfig.wfdepinstId) {
                                if(scanMode == 0) {
                                    refresValues();
                                }
                            }

                            setClientConfigInfo();
                            wfidsetcomplete = true;
                            return wfidsetcomplete;
                       }  
                       else {
                            msgBox.show('කාර්ය ප්‍රවාහයට අවසර නැත. කරුණාකර තොරතුරු තාක්ෂණ නිලධාරියෙකු අමතන්න.',
                                    'Client is not configured for this Workflow..WFID = '+ wfid + ' Please contact a IT helpdesk officer' ,
                                    'අවවාදයයි / Warning',
                                    'BS22',
                                    'Warning',
                                    null);
                            $("#barcodeBcodeTxt").val("");
                            $("#barcodeBcodeTxt").focus();
                            
                            sacanComplete = false;
                            return wfidsetcomplete;
                            errorbeforestauscomplete = errorbeforestauscomplete + ' ' + 'Client is not configured for this Workflow..WFID'
                        }          
                    },
                     error: function (jqXHR, textStatus, errorThrown) {
                        formatErrorMessage(jqXHR, errorThrown, "BFLProductionBarcode");
                        return wfidsetcomplete;
                     }
                }); 
        }   
    }

    function refresValues(arg) {
        refreshmsgBoxHeaderStyle();
        if (clientconfig.wfdepinstId != 0){
            // console.log('Calling GetWFConfigurationbyWFOpp by WFId:' + wfid + ', OperationCode:' + clientconfig.opCode1 + ', TeamId:' + clientconfig.teamId);
            $.ajax({
                url: '@ViewBag.APIURL/Lookup/GetConfigurationWFDEPInstId?WFDEPInstId=' + clientconfig.wfdepinstId,  
                //url: '@ViewBag.APIURL/Lookup/GetWFConfigurationbyWFOpp?WFId=' + wfid + '&OperationCode=' + clientconfig.opCode1 + '&TeamId=' + clientconfig.teamId,
                type: 'GET',
                dataType: 'json',
                //async: false,
                contentType: 'application/json; charset=utf-8',
                beforeSend: function () {
                    $("#ajaxBusy").show();
                },
                complete: function () {
                    $("#ajaxBusy").hide();
                },
                success: function (data) {
                    //Check whether barcode is exist in the db
                    //console.log('Calling GetWFConfigurationbyWFOpp succeded.');
                    if (data != null) {
                        //console.log('GetWFConfigurationbyWFOpp API result received from DCAP db..');
                        //console.log(data);
                        sessionStorage.setItem("ScanOpMode", data.scanOpMode);
                        selectedWfConfig = data;
                        
                        $('#dataLabelScanCounter').html(selectedWfConfig.scanCounter);
                        
                        initializeDivisons();

                        clientconfig = {
                            "clientId": clientconfig.clientId,
                            "dataCaptureMode": clientconfig.dataCaptureMode,
                            "pocounterNumber" : clientconfig.pocounterNumber,
                            "facName": clientconfig.facName,
                            "loginMode": clientconfig.loginMode,
                            "opCode1": clientconfig.opCode1,
                            "opCode2": clientconfig.opCode2,
                            "operationName": clientconfig.operationName,
                            "recStatus": clientconfig.recStatus,
                            "selectMode": clientconfig.selectMode,
                            "teamId": clientconfig.teamId,
                            "teamName": clientconfig.teamName,
                            "facName": clientconfig.facName,
                            "wfdepinstId": selectedWfConfig.wfdepinstId,
                            "wfId": clientconfig.wfId,
                            "clientIP": clientconfig.clientIP
                        };


                        setClientConfigInfo();

                        if (data.scanOpMode == ScanOption.Continue) {
                            selectedScanOption = ScanOption.Continue;
                            $('#trxModeBtnPanel').show();
                            $('#scanActionButton').show();
                            //$('#dataLabelScanOpt').html('Continue');
                            var LblVal = clientconfig.operationName + ' / Continue'
                            $('#dataLabelOperation').html(LblVal);
                            $('#helpSin').html("ස්කෑන් කිරීමට පෙර ස්කෑන් ක්‍රමය සහ ස්කෑන් අකාරය තෝරන්න.");
                            $('#helpEng').html("Select Scan Action and Transaction before scanning the barcode.");
                            $('#barcodeBcodeTxt').attr("disabled", "disabled");
                            scanMode == 0 ? selectTrxModeGood() : selectTrxModeScrap(); //0 = bulk, 1 = individual
                        }
                        else if (data.scanOpMode == ScanOption.Before) {
                            selectedScanOption = ScanOption.Before;
                            $('#trxModeBtnPanel').show();
                            $('#scanActionButton').show();
                            //$('#dataLabelScanOpt').html('Before'); 
                            var LblVal1 = clientconfig.operationName + ' / Before'
                            $('#dataLabelOperation').html(LblVal1);
                            $('#helpSin').html("ස්කෑන් කිරීමට පෙර ස්කෑන් ක්‍රමය සහ ස්කෑන් අකාරය තෝරන්න.");
                            $('#helpEng').html("Select Scan Action and Transaction before scanning the barcode.");
                        }
                        else if (data.scanOpMode == ScanOption.After) {
                            selectedScanOption = ScanOption.After;
                            $('#trxModeBtnPanel').show();
                            $('#scanActionButton').show();
                            //$('#dataLabelScanOpt').html('After');
                            var LblVal2 = clientconfig.operationName + ' / After'
                            $('#dataLabelOperation').html(LblVal2);
                            $('#trxModeReworkBtn').attr("disabled", "disabled");
                            $('#trxModeGoodBtn').attr("disabled", "disabled");
                            $('#trxModeScrapBtn').attr("disabled", "disabled");
                            //$('#helpSin').html("ස්කෑන් කිරීමෙන් පසු ස්කෑන් ක්‍රමය සහ ස්කෑන් අකාරය තෝරන්න.");
                            //$('#helpEng').html("Select Scan Action and Transaction after scanning the barcode.");
                            $("#barcodeBcodeTxt").removeAttr("disabled");
                            $("#barcodeBcodeTxt").select();
                            $("#barcodeBcodeTxt").focus();
                        }

                        if (data.poCounterEnable == 1) {
                            $('#counterLables').show();
                            loadPOcounterValues();
                        }
                        else {
                            $('#counterLables').hide();
                        }

                        //Don't change below order as default has to be set for "Add"
                        if (userPermissionList.some(permission => permission.functionId === AccessibleFunctions.GoodReverse)) {
                            $('#trxModeGoodBtn').show();
                            $('#scanActionReverseBtn').show();

                            selectActionReverse();
                        }
                        if (userPermissionList.some(permission => permission.functionId === AccessibleFunctions.GoodAdd)) {
                            $('#trxModeGoodBtn').show();
                            $('#scanActionAddBtn').show();

                            selectActionAdd();
                        }
                        if (userPermissionList.some(permission => permission.functionId === AccessibleFunctions.ScrapReverse)) {
                            $('#trxModeScrapBtn').show();
                            $('#scanActionReverseBtn').show();

                            selectActionReverse();
                        }
                        if (userPermissionList.some(permission => permission.functionId === AccessibleFunctions.ScrapAdd)) {
                            $('#trxModeScrapBtn').show();
                            $('#scanActionAddBtn').show();

                            selectActionAdd();
                        }
                        if (userPermissionList.some(permission => permission.functionId === AccessibleFunctions.ReworkReverse)) {
                            $('#trxModeReworkBtn').show();
                            $('#scanActionReverseBtn').show();

                            selectActionReverse();
                        }

                        if (userPermissionList.some(permission => permission.functionId === AccessibleFunctions.ReworkAdd)) {
                            $('#trxModeReworkBtn').show();
                            $('#scanActionAddBtn').show();

                            selectActionAdd();
                        }
                        //console.log('Calling GetWFDetailByID API by wfid:' + wfid);
                        if(wfid == null)
                             wfid = clientconfig.wfId

                        $.ajax({
                            url: '@ViewBag.APIURL/Lookup/GetWFDetailByID?WFId=' + wfid,
                            type: 'GET',
                            dataType: 'json',
                            async: false,
                            contentType: 'application/json; charset=utf-8',
                            beforeSend: function () {
                                $("#ajaxBusy").show();
                            },
                            complete: function () {
                                $("#ajaxBusy").hide();
                            },
                            success: function (data) {
                                //console.log('Calling GetWFDetailByID API succeded.');
                                if (data != null) {
                                    //console.log('GetWFDetailByID API result received from DCAP db..');
                                    selectedWorkflow = data;
                                    //console.log(selectedWorkflow);
                                }
                                else {
                                    msgBox.show('කාර්ය ප්‍රවාහයට අදාල තොරතුරු නැත. කරුණාකර තොරතුරු තාක්ෂණ නිලධාරියෙකු අමතන්න.',
                                        'Workflow details not found. Please contact a IT helpdesk officer',
                                        'අවවාදයයි / Warning',
                                        'BS22',
                                        'Warning',
                                        null);
                                }

                            },
                            error: function (jqXHR, textStatus, errorThrown) {
                                formatErrorMessage(jqXHR, errorThrown, "BFLProductionBarcode");
                            }
                        });
                    }
                    else {
                        //console.log('No configuration details available for selected style.');
                        msgBox.show('තෝරන ලද ස්ටයිල් සඳහා වින්‍යාස තොරතුරු නොමැත. කරුණාකර තොරතුරු තාක්ෂණ නිලධාරියෙකු අමතන්න.',
                            'No configuration details available for selected style. Please contact a IT helpdesk officer',
                            'අවවාදයයි / Warning',
                            'BS23',
                            'Warning',
                            null);
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    formatErrorMessage(jqXHR, errorThrown, "BFLProductionBarcode");
                }
            });
        }
    }

    function refreshmsgBoxHeaderStyle() {
        $('#msgWindow').removeClass("msgWindowWarning");
        $('#msgWindow').removeClass("msgWindowConfirm");
    }

    function onChangeScrapReason(arg) {
        var row = $(this.select()).closest("tr");
        var dataItem = scrapReasonSearchGrid.dataItem(row);
        selectedScrapReason = dataItem;
        scrapReasonSearchGrid.dataSource.data([]);
        $("#scrapReasonSearchWindow").data("kendoWindow").close();

        if (selectedScanOption == ScanOption.After) {
            if (selectedScrapReason != null) {
                $('#trxModeScrapBtn').focus();
            }
        }
        else if (selectedScanOption == ScanOption.Continue) {
            if (selectedScrapReason != null) {
                $('#trxModeScrapBtn').focus();
                $("#barcodeBcodeTxt").attr("disabled", "disabled");
                $('#trxModeReworkBtn').attr("disabled", "disabled");
                $('#trxModeGoodBtn').attr("disabled", "disabled");
            }
        }
        //console.log('User selected Scrap Reason..');
        //console.log(selectedScrapReason);
    }

    function onGroupTagSearchClose() {
        //console.log(selectedGroupTag);
        if (selectedGroupTag != null) {
            $("#barcodeGroupTagTxt").val(selectedGroupTagNo);
            $('#groupTagDataLabel').html(selectedGroupDesc);
            sModeTagSelectDivisionRender(selectedGroupTag);
        }
        else {
            $("#barcodeGroupTagTxt").val("");
            $('#groupTagDataLabel').html("");
        }
        $("#groupTagSearchWindowStyleTxt").val("");
        groupTagSearchGrid.dataSource.data([]);
        //console.log("ongrouptagclose",SMode);
    }

    function onGroupTagSizeSearchClose() {
        if (selectedGroupSize != null) {
            $("#tagSizesTxt").val(selectedGroupSize.l5no);
            $('#tagSizeLabel').html(selectedGroupSize.l5desc);
            $("#quantitiyTxt").val("");
            $("#quantitiyTxt").select();
            $("#quantitiyTxt").focus();
        }
        else {
            $("#tagSizesTxt").val("");
            $('#tagSizesTxt').html("");
        }
        $("#tagSizeSearchWindowStyleTxt").val("");
        tagSizeSearchGrid.dataSource.data([]);
    }

    function sModeTagSelectDivisionRender(selectedGroupTag) {
        if(selectedGroupTag != null) {
            if(selectedGroupTag.sMode == 1) {
                $("#BarcodeScanRow").hide();
                $("#OSQuantitiyRow").show();
                $("#tagSizes").show();
                $("#tagSizesTxt").val("");
                $('#tagSizeLabel').html("");
            } else {
                $("#BarcodeScanRow").show();
                $("#OSQuantitiyRow").hide();
                $("#tagSizes").hide();
            }
        } else {
            $("#BarcodeScanRow").show();
            $("#OSQuantitiyRow").hide();
            $("#tagSizes").hide();
        }
    }

    function onScrapReasonSearchClose() {
        selectedDefectOpp = null;
        $("#defectOpperation").html("");

        if ($("#scrapReasonSearchWindowScrapTxt").val().length = 0) {
            selectedScrapReason = null;
        }
        if (selectedScrapReason != null) {
            $("#barcodeScrapReasonTxt").val(selectedScrapReason.rrname);
            $("#scrapReasonDataLabel").html(selectedScrapReason.rrid);
        }
        else {
            $("#barcodeScrapReasonTxt").val("");
            $("#scrapReasonDataLabel").html("");
        }
        $("#scrapReasonSearchWindowScrapTxt").val("");
        scrapReasonSearchGrid.dataSource.data([]);

        if (selectedScanOption == ScanOption.After) {
            if (selectedScrapReason != null) {
                $('#trxModeScrapBtn').focus();
            }
        }
        if (selectedScanOption == ScanOption.Continue) {
            if (selectedScrapReason != null) {
                $('#trxModeScrapBtn').focus();
            }
            else {
                $("#scrapReasonSearchBtn").focus();
            }
        }
    }

    function onChangeReworkReason(arg) {

        var row = $(this.select()).closest("tr");
        var dataItem = reworkReasonSearchGrid.dataItem(row);
        selectedScrapReason = dataItem;
        reworkReasonSearchGrid.dataSource.data([]);
        $("#reworkReasonSearchWindow").data("kendoWindow").close();
        if (selectedScanOption == ScanOption.After) {
            if (selectedScrapReason != null) {
                $('#trxModeScrapBtn').focus();
            }
        }
        else if (selectedScanOption == ScanOption.Continue) {
            if (selectedScrapReason != null) {
                $('#trxModeScrapBtn').focus();
                $("#barcodeBcodeTxt").attr("disabled", "disabled");
                $('#trxModeReworkBtn').attr("disabled", "disabled");
                $('#trxModeGoodBtn').attr("disabled", "disabled");
            }
        }
        //console.log('User selected Rework Reason..');
        //console.log(selectedScrapReason);
    }

    function onChangeDefectOpps(arg) {

        var row = $(this.select()).closest("tr");
        var dataItem = defectOppSearchGrid.dataItem(row);
        selectedDefectOpp = dataItem;
        defectOppSearchGrid.dataSource.data([]);
        $("#defectOppSearchWindow").data("kendoWindow").close();

        if (selectedScanOption == ScanOption.After) {
            if (selectedDefectOpp != null) {

                $('#trxModeScrapBtn').focus();
            }
        }
        else if (selectedScanOption == ScanOption.Continue) {
            if (selectedDefectOpp != null) {
                $('#trxModeScrapBtn').focus();
                $("#barcodeBcodeTxt").attr("disabled", "disabled");
                $('#trxModeReworkBtn').attr("disabled", "disabled");
                $('#trxModeGoodBtn').attr("disabled", "disabled");
            }
        }
        //console.log('User selected Defect Opreration..');
        //console.log(selectedDefectOpp);
    }

    function onReworkReasonSearchClose() {
        if ($("#reworkReasonSearchWindowScrapTxt").val().length = 0) {
            selectedScrapReason = null;
        }
        if (selectedScrapReason != null) {
            $("#barcodeScrapReasonTxt").val(selectedScrapReason.rrname);
            $("#scrapReasonDataLabel").html(selectedScrapReason.rrid);
            //$("#defectOpperation").html(""); 
            //selectedDefectOpp = null;   
            //openReworkReasonPannel();                    
        }
        else {
            $("#barcodeScrapReasonTxt").val("");
            $("#scrapReasonDataLabel").html("");
            //$("#defectOpperation").html("");               
        }
        $("#reworkReasonSearchWindowScrapTxt").val("");
        reworkReasonSearchGrid.dataSource.data([]);
               
    }

    function onDefectOppsSearchClose() {
        if ($("#defectOppSearchWindowTxt").val().length = 0) {
            selectedDefectOpp = null;
        }
        if (selectedDefectOpp != null) {
            //$("#barcodeScrapReasonTxt").val(selectedDefectOpp.dopsName);           
            $("#defectOpperation").html(selectedDefectOpp.dopsId);
            openReworkReasonPannel();
        }
        else {
            //$("#barcodeScrapReasonTxt").val("");            
            $("#defectOpperation").html("");
            //$('#reworkReasonSearchBtn').trigger('click');
        }
        $("#defectOppSearchWindowTxt").val("");
        defectOppSearchGrid.dataSource.data([]);

        if (selectedScanOption == ScanOption.After) {
            if (selectedScrapReason != null) {
                $('#trxModeScrapBtn').focus();
            }
        }
        if (selectedScanOption == ScanOption.Continue) {
            if (selectedScrapReason != null) {
                $('#trxModeScrapBtn').focus();
            }
            else {
                $("#reworkReasonSearchBtn").focus();
            }
        }
    }

    var ReworkObject;

    function GetRejectCat() {
        $.ajax({
            url: '@ViewBag.APIURL/Lookup/GetRejectReasonCategory?RRType=2',
            type: 'GET',
            dataType: 'json',
            async: false,
            contentType: 'application/json',
            beforeSend: function () {
                $("#ajaxBusy").show();
            },
            complete: function () {
                $("#ajaxBusy").hide();
            },
            success: function (response) {
                ReworkObject = response;
                //var desc= response
                $("#ddlScrapReason").kendoDropDownList({
                    dataTextField: "rrcatName",
                    dataValueField: "rrcatId",
                    dataSource: response,
                    optionLabel: "Select Rework Reason",
                    index: 0,
                    change: function (e) {
                        RejectReasonCatChange();
                    }
                });
            },

        });
    }

    function RejectReasonCatChange() {
        reworkReasonSearchGrid.dataSource.read({ RRCat: $("#ddlScrapReason").val() });
        $("#reworkReasonSearchWindowScrapTxt").val("");
    }

    function operationChange(arg) {
        
        var oppcodeTeamcode = $("#ddlMainOperation").val();
        var operationText = $("#ddlMainOperation").data("kendoDropDownList").text();
        if (oppcodeTeamcode != null && oppcodeTeamcode != "") {
            var operation = oppcodeTeamcode.split('-');

            if (operation.length > 1) {

                var OppCode = operation[0].substring(operation[0].indexOf("[") + 1, operation[0].indexOf("]"));
                var TeamId = operation[1].substring(operation[1].indexOf("[") + 1, operation[1].indexOf("]"));

                // operation[operation.length - 1];
                // TeamId = TeamId.replace(/\[/g, '');               
                // TeamId = TeamId.replace(/\]/g, '');
                // var TeamName = operation[1]; 
                // var OppCode = operation[operation.length - 2];
                // OppCode = OppCode.replace(/\[/g, '');               
                // OppCode = OppCode.replace(/\]/g, '');       $.ajax({                

                //getWFDEPInstId();

                //url: 'http://localhost:5001/api/Security/GetWfDEPInstByClientWF?ClientId=' +  clientconfig.clientId + '&WFId=' + clientconfig.wfId,

                $.ajax({
                    url: '@ViewBag.APIURL/Security/GetWfDEPInstByTeamOppWF?TeamId=' + TeamId + '&OppCode=' + OppCode + '&WFId=' + clientconfig.wfId,

                    type: 'GET',
                    dataType: 'json',
                    async: false,
                    contentType: 'application/json',
                    beforeSend: function () {
                        $("#ajaxBusy").show();
                    },
                    complete: function () {
                        $("#ajaxBusy").hide();
                    },
                    success: function (response) {
                        if (response != null) {
                            WFDEPInstId = response.wfdepinstId;
                           
                            var operationNames = operationText.split('-');

                            if (operationNames.length > 1) {
                                var OppName = operationNames[0]
                                var TeamName = operationNames[1]

                                var clientconfigTemp = {
                                    "clientId": clientconfig.clientId,
                                    "dataCaptureMode": clientconfig.dataCaptureMode,
                                    "pocounterNumber" : clientconfig.pocounterNumber,
                                    "facName": clientconfig.facName,
                                    "loginMode": clientconfig.loginMode,
                                    "opCode1": OppCode,
                                    "opCode2": 0,
                                    "operationName": OppName,
                                    "recStatus": clientconfig.recStatus,
                                    "selectMode": clientconfig.selectMode,
                                    "teamId": TeamId,
                                    "teamName": TeamName,
                                    "wfdepinstId": WFDEPInstId,
                                    "wfId": clientconfig.wfId,
                                    "clientIP": clientconfig.clientIP
                                };

                                clientconfig = null;

                                clientconfig = clientconfigTemp
                                setClientConfigInfo();
                            }


                        }
                    },
                })
            }


            // $('#dataLabelOperation').html(operation[0]);
        }
    }

    function getWFDEPInstId(arg) {
         $.ajax({
                //url: '@ViewBag.APIURL/Security/GetWfDEPInstByClientWF?ClientId=' +  clientconfig.clientId + '&WFId=' + clientconfig.wfId,
                url: '@ViewBag.APIURL/Security/GetWfDEPInstByTeamOppWF?TeamId=' +  TeamId + '&OppCode=' + clientconfig.OppCode + '&WFId=' + clientconfig.wfId ,
                
                type: 'GET',
                dataType: 'json',
                async: false,
                contentType: 'application/json',
                beforeSend: function () {
                    $("#ajaxBusy").show();
                },
                complete: function () {
                    $("#ajaxBusy").hide();
                },
                success: function (response) {
                    if (response != null) {
                        WFDEPInstId =response.wfdepinstId;
                }   
            },
        });
    }

    function getOperation() {
        $.ajax({
            url: '@ViewBag.APIURL/Lookup/GetOpperationsByUser?UserId=' + txUser.userId + '&ClientIp=' +  clientconfig.clientIP ,
            type: 'GET',
            dataType: 'json',
            async: false,
            contentType: 'application/json',
            beforeSend: function () {
                $("#ajaxBusy").show();
            },
            complete: function () {
                $("#ajaxBusy").hide();
            },
            success: function (response) {
                operationList = response;
                $("#ddlMainOperation").data("kendoDropDownList").dataSource.data([]);
                $("#ddlMainOperation").kendoDropDownList({
                    dataTextField: "displayVal",
                    dataValueField: "valueField",                   
                    dataSource: response,
                    index: 0,
                    autoBind: true,
                    optionLabel: {
                        displayVal: "Select Operation",
                        valueField: 0
                    },
                    change: function (e) {
                        operationChange();

                    }
                });
            },
            error: function (jqXHR, textStatus, errorThrown) {
                formatErrorMessage(jqXHR, errorThrown, "BFLProductionBarcode");
            }
        });
    }

    function loadPOcounterValues() {
        $("#counterLables").show();
        refreshmsgBoxHeaderStyle();
        //console.log("pocounterNumber load po counter: ", clientconfig.pocounterNumber);
        //console.log(clientconfig);
        $.ajax({
            url: '@ViewBag.APIURL/Lookup/GetBuddyTagCounters?clientId=' + clientconfig.clientId,
            type: 'GET',
            dataType: 'json',
            async: false,
            contentType: 'application/json',
            beforeSend: function () {
                $("#ajaxBusy").show();
            },
            complete: function () {
                $("#ajaxBusy").hide();
            },
            success: function (response) {
                //Modifed by NimanthaH
                runningPOCounters = [];
                if(response.length != 0) {
                    runningPOCounters = response;
                    var result = "";  
                    $("#counerlabelDetails").html('');  
                    $.each(response, function (id, counter) {
                        
                        if(selectedWfConfig.poCounterNumber == 1){
                            if(counter.qty01 >= counter.bagSize){
                                msgBox.show(counter.scheduleNo + ' - ' + counter.colorDesc + ' (' + counter.counterId + ') කවුන්ටරය පිරී ඇත. කරුණාකර බෑගය වහන්න.',
                                'The counter is full. Please close the bag.','අවවාදයයි / Warning', 'LG03','Warning',null);
                                haltsystem = true; //halt the system 
                            }
                        }

                        result += '<td id="ctd' + (counter.counterId) + '" style="height: 84px;">'+
                                    '<div id="cou' + (counter.counterId) + '" class="col-xs-1 cell">'+
                                        '<table id="counter' + counter.counterId + '">'+
                                            '<tbody>' +
                                                '<tr id= "poCounterNumberDiv">' + 
                                                    '<td class="counter-td counter-round">' +
                                                        '<button class="counter-key-button" type="button" id="POBtn' + counter.counterId + '-key" onClick="OpenPOCounterPannel(' + (counter.counterId) + ')" title="Open Counter Window">' +
                                                        '<span id="counterNumber' + (counter.counterId+1) + '" class="counter-key">' + counter.bagBarCode + '</span>' +
                                                    '</td>' +
                                                '</tr>' +
                                                '<tr>' +
                                                    '<td class="counter-td counter-round">' +
                                                        '<button type="button" id="POBtn' + counter.counterId + '" class="btn btn-primary control-label_PO" onClick="OpenPOCounterPannel(' + (counter.counterId) + ')" title="Open Counter Window"">' +
                                                        '<span id="Style' + (counter.counterId) + '" class="buttonTxt" hidden="hidden">' + counter.styleNo + '</span>' +
                                                        '<span id="PO' + (counter.counterId) + '" class="buttonTxt" hidden="hidden">' + counter.poNo + '</span>' +
                                                        '<span id="ZFeature' + (counter.counterId) + '" class="buttonTxt" hidden="hidden">' + counter.zfeature + '</span>' +
                                                        '<span id="Shedule' + (counter.counterId) + '" class="buttonTxt" hidden="hidden">' + counter.scheduleNo + '</span>' +
                                                        '<span id="Color' + (counter.counterId) + '" class="buttonTxt" hidden="hidden">' + counter.colorDesc + '</span>' +
                                                        '<span id="RejectType' + (counter.counterId) + '" class="buttonTxt">' + counter.rrType + '</span>' +
                                                        '<span id="RejectId' + (counter.counterId) + '" class="buttonTxt">' + counter.rrId + '</span>' +
                                                        '<span id="Separater"> : </span>' +
                                                        '<span id="TravelTagNo' + (counter.counterId) + '" class="buttonTxt">' + counter.travelBarCodeNo + '</span>' +
                                                        '<span id="Separater"> : </span>' +
                                                        '<span id="RejectReason' + (counter.counterId) + '" class="buttonTxt">' + counter.rrName + '</span>' +
                                                        '</button>' +
                                                    '</td>' +
                                                '</tr>' +
                                                '<tr>' +
                                                    '<td class="counter-td counter-round">' +
                                                        '<label id="POCunt' + (counter.counterId) + '" class="control-po_counter" style="width: 100%;">' + counter.qty01 + (selectedWfConfig.poCounterNumber == 1 ? ' / ' + counter.bagSize : '') + '</label> ' +
                                                        '<label id="POCuntNumber' + (counter.counterId) + '" class="cutqty" style="width: 100%;" hidden="hidden">' + counter.qty01 + '</label> ' +
                                                        (selectedWfConfig.poCounterNumber == 1 ? '<label id="CutQuantity' + (counter.counterId) + '" class="cutqty" style="width: 100%;">' + counter.cutQuantity + '</label> ' : '<label id="CutQuantity' + (counter.counterId) + '" class="cutqty" style="width: 100%;" hidden="hidden">' + counter.cutQuantity + '</label> ') +
                                                        '<label id="POCuntID' + (counter.counterId) + '" style="width: 0%;" hidden="hidden">' + counter.counterId + '</label> ' +
                                                        '<label id="BagBarcodeVal' + (counter.counterId) + '" style="width: 0%;" hidden="hidden">' + counter.bagBarCode + '</label> ' +
                                                        '<label id="BagSizeVal' + (counter.counterId) + '" style="width: 0%;" hidden="hidden">' + counter.bagSize + '</label> ' +
                                                    '</td>' +
                                                '</tr>' +
                                            '</tbody>' +
                                        '</table>' +
                                    '</div>' +
                                '</td>'
                    });
                    $("#counerlabelDetails").html(result);
                    focousPOcounterValues();
                } else {
                    $("#counerlabelDetails").html('');
                    $("#counterLables").hide();
                }
            },

        });
    }

    function updatePOcounterValues(counterId) {
        $("#counterLables").show();
        $.ajax({
            url: '@ViewBag.APIURL/Lookup/GetUpdatedBuddyTagcounterValues?WFDEPInstId=' + clientconfig.wfdepinstId + '&CounterId=' + counterId,
            type: 'GET',
            dataType: 'json',
            async: false,
            contentType: 'application/json',
            beforeSend: function () {
                $("#ajaxBusy").show();
            },
            complete: function () {
                $("#ajaxBusy").hide();
            },
            success: function (response) {
                console.log(response);
                if(response == undefined) {
                    loadPOcounterValues();
                } else {
                    if(response != null) {
                        if(selectedWfConfig.poCounterNumber == 1){
                            if(response.qty01 >= response.bagSize){
                                msgBox.show(response.bagBarCode + ' (' + response.counterId + ') කවුන්ටරය පිරී ඇත. කරුණාකර බෑගය වහන්න.',
                                'The counter is full. Please close the bag.','අවවාදයයි / Warning', 'LG03','Warning',null);
                                haltsystem = true; //halt the system 
                            }
                        }

                        $("#POCunt" + response.counterId).html(response.qty01 + ' / ' + response.bagSize);
                        $("#CutQuantity" + response.counterId).html(response.cutQuantity);
                        $("#BagSizeVal" + response.counterId).html(response.bagSize);
                        $("#POCuntNumber" + response.counterId).html(response.qty01);

                        if(lastUpdatedCounterId != response.counterId) {
                            $("id, #POBtn" + lastUpdatedCounterId).removeClass('active');
                            $("id, #POBtn" + lastUpdatedCounterId + "-key").removeClass('active-c');

                            $("id, #POBtn" + response.counterId).addClass('active');
                            $("id, #POBtn" + response.counterId + "-key").addClass('active-c');
                            $("#POBtn" + response.counterId).focus();

                            lastUpdatedCounterId = response.counterId;
                        }

                        $("#barcodeBcodeTxt").focus();
                    } else {
                        loadPOcounterValues();
                        msgBox.show(counter.scheduleNo + ' - ' + counter.colorDesc + ' (' + counter.counterId + ') කවුන්ටරය යාවත්කාලීන කිරීම අසාර්ථක විය. (GetUpdatedPOcounterValues ​​API මඟින් ශුන්‍ය අගයක් ලබා දෙයි).',
                                'counter update failed. (GetUpdatedPOcounterValues API returns null value).','අවවාදයයි / Warning', 'LG03','Warning',null);
                    }
                }
            },
        });
    }

    //Added by NimanthaH
    function focousPOcounterValues() {
        $.ajax({
            url: '@ViewBag.APIURL/Lookup/GetMostUpdatedBuddyTagcounter?WFDEPInstId=' + clientconfig.wfdepinstId,
            type: 'GET',
            dataType: 'json',
            async: false,
            contentType: 'application/json',
            beforeSend: function () {
                $("#ajaxBusy").show();
            },
            complete: function () {
                $("#ajaxBusy").hide();
            },
            success: function (response) {
                //console.log(response);
                if(response != null) {
                    //if(lastUpdatedCounterId != response.counterId) {
                        $("#POBtn" + response.counterId).focus();
                        $("id, #POBtn" + response.counterId).addClass('active');
                        $("id, #POBtn" + response.counterId + "-key").addClass('active-c');
                        $("#barcodeBcodeTxt").focus();
                        lastUpdatedCounterId = response.counterId;
                    //}
                }
            },

        });
    }

    function beep(vol, freq, duration){
                v=a.createOscillator()
                u=a.createGain()
                v.connect(u)
                v.frequency.value=freq
                v.type="square"
                u.connect(a.destination)
                u.gain.value=vol*0.01
                v.start(a.currentTime)
                v.stop(a.currentTime+duration*0.001)
    }

    function beeponce() {   
        var snd = new Audio("data:audio/wav;base64,//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAGDgYtAgAyN+QWaAAihwMWm4G8QQRDiMcCBcH3Cc+CDv/7xA4Tvh9Rz/y8QADBwMWgQAZG/ILNAARQ4GLTcDeIIIhxGOBAuD7hOfBB3/94gcJ3w+o5/5eIAIAAAVwWgQAVQ2ORaIQwEMAJiDg95G4nQL7mQVWI6GwRcfsZAcsKkJvxgxEjzFUgfHoSQ9Qq7KNwqHwuB13MA4a1q/DmBrHgPcmjiGoh//EwC5nGPEmS4RcfkVKOhJf+WOgoxJclFz3kgn//dBA+ya1GhurNn8zb//9NNutNuhz31f////9vt///z+IdAEAAAK4LQIAKobHItEIYCGAExBwe8jcToF9zIKrEdDYIuP2MgOWFSE34wYiR5iqQPj0JIeoVdlG4VD4XA67mAcNa1fhzA1jwHuTRxDUQ//iYBczjHiTJcIuPyKlHQkv/LHQUYkuSi57yQT//uggfZNajQ3Vmz+Zt//+mm3Wm3Q576v////+32///5/EOgAAADVghQAAAAA//uQZAUAB1WI0PZugAAAAAoQwAAAEk3nRd2qAAAAACiDgAAAAAAABCqEEQRLCgwpBGMlJkIz8jKhGvj4k6jzRnqasNKIeoh5gI7BJaC1A1AoNBjJgbyApVS4IDlZgDU5WUAxEKDNmmALHzZp0Fkz1FMTmGFl1FMEyodIavcCAUHDWrKAIA4aa2oCgILEBupZgHvAhEBcZ6joQBxS76AgccrFlczBvKLC0QI2cBoCFvfTDAo7eoOQInqDPBtvrDEZBNYN5xwNwxQRfw8ZQ5wQVLvO8OYU+mHvFLlDh05Mdg7BT6YrRPpCBznMB2r//xKJjyyOh+cImr2/4doscwD6neZjuZR4AgAABYAAAABy1xcdQtxYBYYZdifkUDgzzXaXn98Z0oi9ILU5mBjFANmRwlVJ3/6jYDAmxaiDG3/6xjQQCCKkRb/6kg/wW+kSJ5//rLobkLSiKmqP/0ikJuDaSaSf/6JiLYLEYnW/+kXg1WRVJL/9EmQ1YZIsv/6Qzwy5qk7/+tEU0nkls3/zIUMPKNX/6yZLf+kFgAfgGyLFAUwY//uQZAUABcd5UiNPVXAAAApAAAAAE0VZQKw9ISAAACgAAAAAVQIygIElVrFkBS+Jhi+EAuu+lKAkYUEIsmEAEoMeDmCETMvfSHTGkF5RWH7kz/ESHWPAq/kcCRhqBtMdokPdM7vil7RG98A2sc7zO6ZvTdM7pmOUAZTnJW+NXxqmd41dqJ6mLTXxrPpnV8avaIf5SvL7pndPvPpndJR9Kuu8fePvuiuhorgWjp7Mf/PRjxcFCPDkW31srioCExivv9lcwKEaHsf/7ow2Fl1T/9RkXgEhYElAoCLFtMArxwivDJJ+bR1HTKJdlEoTELCIqgEwVGSQ+hIm0NbK8WXcTEI0UPoa2NbG4y2K00JEWbZavJXkYaqo9CRHS55FcZTjKEk3NKoCYUnSQ0rWxrZbFKbKIhOKPZe1cJKzZSaQrIyULHDZmV5K4xySsDRKWOruanGtjLJXFEmwaIbDLX0hIPBUQPVFVkQkDoUNfSoDgQGKPekoxeGzA4DUvnn4bxzcZrtJyipKfPNy5w+9lnXwgqsiyHNeSVpemw4bWb9psYeq//uQZBoABQt4yMVxYAIAAAkQoAAAHvYpL5m6AAgAACXDAAAAD59jblTirQe9upFsmZbpMudy7Lz1X1DYsxOOSWpfPqNX2WqktK0DMvuGwlbNj44TleLPQ+Gsfb+GOWOKJoIrWb3cIMeeON6lz2umTqMXV8Mj30yWPpjoSa9ujK8SyeJP5y5mOW1D6hvLepeveEAEDo0mgCRClOEgANv3B9a6fikgUSu/DmAMATrGx7nng5p5iimPNZsfQLYB2sDLIkzRKZOHGAaUyDcpFBSLG9MCQALgAIgQs2YunOszLSAyQYPVC2YdGGeHD2dTdJk1pAHGAWDjnkcLKFymS3RQZTInzySoBwMG0QueC3gMsCEYxUqlrcxK6k1LQQcsmyYeQPdC2YfuGPASCBkcVMQQqpVJshui1tkXQJQV0OXGAZMXSOEEBRirXbVRQW7ugq7IM7rPWSZyDlM3IuNEkxzCOJ0ny2ThNkyRai1b6ev//3dzNGzNb//4uAvHT5sURcZCFcuKLhOFs8mLAAEAt4UWAAIABAAAAAB4qbHo0tIjVkUU//uQZAwABfSFz3ZqQAAAAAngwAAAE1HjMp2qAAAAACZDgAAAD5UkTE1UgZEUExqYynN1qZvqIOREEFmBcJQkwdxiFtw0qEOkGYfRDifBui9MQg4QAHAqWtAWHoCxu1Yf4VfWLPIM2mHDFsbQEVGwyqQoQcwnfHeIkNt9YnkiaS1oizycqJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=");       
            snd.play(); 
    }

    //Disable Enabale Barcode Scan Textbox
    function DisableControllers() {
        $("#barcodeBcodeTxt").attr('disabled', 'disabled');
        $("#quantitiyTxt").attr('disabled', 'disabled');
    }

    function EnableControllers() {
        $("#barcodeBcodeTxt").removeAttr('disabled');
        $("#quantitiyTxt").removeAttr('disabled');
        $("#ajaxBusy").hide();
    }

</script>

<!-- Main Window: START -->
<div class="form-group" id="main">    
    <div class="row">
        <div class="col-xs-6" style="width: 47%; /*border-radius: 15px; border: #ffffff63 solid 2px; top: 10px; box-shadow: 6px 7px 5px #00000075;*/">
            <div class="row" id="dvMainOpp"> 
                <label class="col-xs-2 control-label control-label-main" style="width: 34%;">Operation :</label> 
                <div class="col-md-6">
                    <div id="ddlMainOperation" class="form-control" style="width: 120%;"></div>
                </div>
                <div class="col-md-2"></div>
            </div>
            <div class="row" id="dvScanOption"> 
                <label class="col-xs-2 control-label control-label-main" style="width: 34%;">Scan Option :</label> 
                <div class="col-md-6" style="margin-left: -100px; margin-top: 12px;">
                    <form class="form cf">
                        <section class="plan cf">
                            <div id="bulkSelectDiv">
                                <input type="radio" name="radio1" id="bulk" value="true" onclick="selectScanMode(0)" checked><label class="free-label four col" for="bulk">Group Tag</label>
                            </div>
                            <div id="garmentSelectDiv">
                                <input type="radio" name="radio1" id="individual" onclick="selectScanMode(1)" value="false"><label class="basic-label four col" for="individual">Garment</label>
                            </div>
                        </section>
                    </form>
                </div>
                <div class="col-md-2"></div>
            </div>
            <div class="row" id="groupTag">
                <label class="col-xs-2 control-label control-label-main" style="width: 22%;">Tag :</label>
                <div class="col-xs-3">
                    <input type="text" id="barcodeGroupTagTxt" class="travel-barcode-text form-control" style="height: 44px;" placeholder="Select a Tag" readonly>
                </div>
                <div class="col-xs-1">
                    <button type="button" id="tagSearchBtn" class="btn btn-primary searchButton" style="margin-left: 15px; margin-top: 19px; margin-left: 175px; margin-top: 19px; height: 52px !important; width: 52px !important;" title="Tag Search">
                        <span><i class="fas fa-search"></i></span>                            
                    </button>
                </div>
                <div class="col-xs-5">
                    <label class="control-datalabel control-datalabel-search" id="groupTagDataLabel" hidden="hidden"></label>
                </div>
            </div>
            <div class="row" id="tagSizes">
                <label class="col-xs-2 control-label control-label-main" style="width: 22%;">Size :</label>
                <div class="col-xs-3">
                    <input type="text" id="tagSizesTxt" class="travel-barcode-text form-control" style="height: 44px;" placeholder="Select a size" readonly>
                </div>
                <div class="col-xs-1">
                    <button type="button" id="tagSizeBtn" class="btn btn-primary searchButton" style="margin-left: 15px; margin-top: 19px; margin-left: 175px; margin-top: 19px; height: 52px !important; width: 52px !important;" title="Size Search">
                        <span><i class="fas fa-search"></i></span>                            
                    </button>
                </div>
                <div class="col-xs-5">
                    <label class="control-datalabel control-datalabel-search" id="tagSizeLabel" hidden="hidden"></label>
                </div>
            </div>                      
            <div class="row" id="BarcodeScanRow">
                <label class="col-xs-2 control-label control-label-main" style="width: 22%;">Barcode :</label>
                <div class="col-xs-7">
                    <input type="textarea" id="barcodeBcodeTxt" style="font-size: 45px !important" class="form-control textbox-barcode" maxlength="24" placeholder="Scan Barcode">
                </div>
            </div>
            <div class="row" id="OSQuantitiyRow">
                <label class="col-xs-2 control-label control-label-main" style="width: 22%;">Quantitiy :</label>
                <div class="col-xs-7">
                    <input type="textarea" id="quantitiyTxt" style="font-size: 45px !important; width: 268px !important;" class="form-control textbox-barcode" maxlength="24" placeholder="Enter the Quantitiy">
                </div>
            </div>
            <div class="row">
                <div class="col-xs-2"></div>
                <div class="col-xs-3"></div>
                <div class="col-xs-4"></div>
            </div>

            <div class="row" id="scanActionButton">
                <label class="col-xs-2 control-label control-label-main" style="width: 22%;">Action :</label>
                <div class="col-xs-5">                    
                    <div class="roundCornerGroupBox roundCornerGroupBox_BC roundCornerGroupBox_BC_Ac">
                        <label class="control-label-submitbtn">
                            <button type="button" id="scanActionAddBtn" class="btn bs-btn-primary-action submitButton" title="Add">
                                <span>Add</span>                            
                            </button>
                        </label>                                                
                        <label class="control-label-submitbtn">
                            <button type="button" id="scanActionReverseBtn" class="btn bs-btn-primary-action submitButton" style="margin-right: 12px;" title="Reverse">
                                <span>Reverse</span>                            
                            </button>
                        </label>                                            
                    </div>  
                </div>
                <div class="col-xs-4" style="padding-top: 18px">
                    <label class="control-label-submitbtn" style="padding-top: 8px !important;">
                            <div class="row">
                        <button type="button" id="resetBtn" class="btn btn-primary submitButton" title="Reset" style="width: 26%; padding-top: 17px;">
                            <span>Reset</span>                            
                        </button>
                        </div>
                    </label>                  
                </div>        
            </div>
                    
            <div class="row" id="trxModeBtnPanel">
                <label class="col-xs-2 control-label control-label-main" style="width: 22%;">Tx Mode :</label>
                <div class="col-xs-8">
                    <div class="roundCornerGroupBox roundCornerGroupBox_BC roundCornerGroupBox_BC_SC">               
                        <label class="control-label-submitbtn">
                            <button type="button" id="trxModeGoodBtn" class="btn bs-btn-primary-good submitButton scanOptionBtn" title="Good">
                                <span>Good</i></span>                            
                            </button>
                        </label>                                                
                        <label class="control-label-submitbtn">
                            <button type="button" id="trxModeScrapBtn" class="btn bs-btn-primary-scrap submitButton scanOptionBtn" title="Scrap">
                                <span>Scrap</span>                            
                            </button>
                        </label>
                        <label class="control-label-submitbtn">
                            <button type="button" id="trxModeReworkBtn" class="btn bs-btn-primary-rework submitButton scanOptionBtn" title="Rework" style="margin-right: 10px;">
                                <span>Rework</span>                            
                            </button>
                        </label>    
                    </div>                      
                </div> 
                <div class="col-xs-2"></div>        
            </div>

            <div class="row" id="divScrapReason">
                <label class="col-xs-2 control-label control-label-main" style="width: 23%; margin-right: -6px;" id="scrapReasonLabel">Scrap Reason :</label>
                <div class="col-xs-3" style="width: 34%;">
                    <input type="text" id="barcodeScrapReasonTxt" class="form-control" placeholder="Select Scrap Reason" readonly>
                </div>
                <div class="col-xs-1">                
                    <button type="button" id="scrapReasonSearchBtn" class="btn btn-primary searchButton" title="Scrap Reason Search">
                        <span><i class="fas fa-search"></i></span>                            
                    </button>                                             
                </div>
                <div class="col-xs-1">   
                    <button type="button" id="reworkReasonSearchBtn" class="btn btn-primary searchButton" title="Rework Reason Search">
                        <span><i class="fas fa-search"></i></span>                            
                    </button>
                </div>  
                <div class="col-xs-2">
                    <label class="control-datalabel control-datalabel-search" id="scrapReasonDataLabel" ></label>
                </div> 
                <div class="col-xs-1">
                    <label class="control-datalabel control-datalabel-search" id="defectOpperation" ></label>
                </div>  
                                        
            </div>                     
        </div>

        <div class="col-xs-6" style="width: 53%;">
            <div class="bc_rightcontent">
                <div class="row">
                    <div class="col-xs-12">
                        <div class="row roundCornerGroupBox" style="margin-right: 3px;">
                            <div class="row" style="margin-top: 8px;">                               
                                <label class="control-scan-status" style="padding-left: 0px;width: 14%;">Barcode :</label>               
                                <label class="control-scan-status-val" style="padding-left: 0px;width: 17%; margin-left: -35px; margin-right: 35px;" id="lastBarcodeDataLabel" ></label>
                                
                                <label class="control-scan-status" style="padding-left: 0px;width: 9%;">Action :</label>               
                                <label class="control-scan-status-val" style="padding-left: 0px;width: 8%;" id="lastAction" ></label>
                                
                                <label class="control-scan-status" style="padding-left: 0px;width: 13%;">Tx Mode :</label>               
                                <label class="control-scan-status-val" style="padding-left: 0px;width: 12%;" id="lastTxMode" ></label>
                                
                                <label class="control-scan-status" style="padding-left: 0px;width: 10%;">Tot Qty :</label>               
                                <label class="control-scan-status-val" style="padding-left: 0px;width:5%;" id="totQty" >0</label>                                                
                            </div>
                            <div class="row">
                                <div class="col-xs-4">
                                    <!--<div class="row" style="text-align: center !important;">
                                        <label class="control-label">Scanned Status</label>
                                    </div>-->
                                    <div class="row" style="text-align: center !important;"> <!--height:10vh; Modified by NimanthaH-->
                                        <label class="control-datalabel-scannedstatus-fail blinktext" id="scannedStatusDataLabel"></label>
                                    </div>                      
                                </div>
                                 <div class="col-xs-8">    
                                    <div class="row" style="text-align: center !important;">
                                        <label class="control-label" style="text-align:left; margin-left: 125px; margin-top: 13px;">Scanned Count (current)</label>
                                    </div>                                          
                                    <!--<div class="row" style="text-align: center !important; visibility: hidden;">
                                        <label class="control-label" style="width: 20%; text-align:left;">Previous hr.</label>
                                        <label class="bs-lbl-counter-good bs-lbl-counter"  id="prevHGood">0</label>
                                        <label class="bs-lbl-counter-scrap bs-lbl-counter" id="prevHScrap">0</label> 
                                        <label class="bs-lbl-counter-rework bs-lbl-counter" id="prevHRework">0</label>
                                    </div> -->
                                    <div class="row" style="text-align: center !important;"> 
                                        <label class="control-label" style="width: 20%; text-align:left;"></label>
                                        <label class="bs-lbl-counter-good bs-lbl-counter" id="crntHGood">0</label>
                                        <label class="bs-lbl-counter-scrap bs-lbl-counter" id="crntHScrap">0</label>
                                        <label class="bs-lbl-counter-rework bs-lbl-counter" id="crntHRework">0</label>
                                    </div>
                                    <div class="row" style="text-align: center !important; height: 10px;"></div>                                                                
                                </div>                                                  
                            </div>                                                             
                        </div>
                    </div>                                                  
                </div>
                <div class="row" style="padding-right: 15px;">
                    <div class="col-xs-12">                    
                        <div class="row  roundCornerGroupBox" style="height:25vh;">                            
                            <div class="col-xs-7" style="padding-left: 0px;">                                 
                                <div class="row" style="height:7vh; overflow: auto;">                                                         
                                    <label class="control-label col-xs-3">PO :</label>               
                                    <label class="bcInfoDataLabel col-xs-8" id="poDataLabel" ></label>                                        
                                </div>                                 
                                <div class="row" style="height:7vh; overflow: auto;">
                                    <label class="control-label col-xs-3">Z Fture. :</label>               
                                    <label class="bcInfoDataLabel col-xs-8" id="dataLabelzFeature" ></label>                    
                                </div>
                                <div class="row" style="height:7vh; overflow: auto;">
                                    <label class="control-label col-xs-3">Color :</label>               
                                    <label class="bcInfoDataLabel col-xs-8" id="bcColorDataLabel" ></label>                                   
                                </div> 
                            </div>
                            <div class="col-xs-5" style="padding-left: 0px;">
                                <div class="row" style="height:7vh; overflow: auto;">                                                    
                                    <label class="control-label col-xs-4" style="padding-left: 0px; width: 160px;">Work Flow ID :</label>               
                                    <label class="bcInfoDataLabel col-xs-3" style="width:140px;" id="sizeDataLabel" ></label>
                                </div>
                                <div class="row" style="height:7vh; overflow: auto;">             
                                    <label class="control-label col-xs-4" style="padding-left: 0px;">Schedule :</label>               
                                    <label class="bcInfoDataLabel col-xs-3" id="scheduleDataLabel" ></label>
                                </div>  
                                <div class="row" style="height:7vh; overflow: auto;">           
                                    <label class="control-label col-xs-4" style="padding-left: 0px; width:155px;">Quantity :</label>               
                                    <label class="bcInfoDataLabel col-xs-3" id="Quantitiy" ></label>
                                </div>                       
                            </div>                                
                        </div>                            
                    </div>                   
                </div>
                <div class="row" style="padding-right: 15px;">
                    <div class="col-xs-12">
                        <div class="row roundCornerGroupBox">
                            <div class="col-xs-6" style="padding-left: 0px;">
                                <div class="row">                   
                                    <label class="control-label col-xs-4" style= "width: 30%" >Factory :</label>
                                    <label class="control-datalabel col-xs-6 pad-remove-loclables" id="dataLabelFactory" ></label>            
                                </div>  
                                <div class="row">                    
                                    <label class="control-label col-xs-4" style= "width: 30%">Team :</label>
                                    <label class="control-datalabel col-xs-6 pad-remove-loclables" id="dataLabelTeam" ></label>
                                </div>
                                <div class="row" style="padding-bottom: 10px;">                    
                                    <label class="control-label col-xs-4" style= "width: 34%">Operation :</label>
                                    <label class="control-datalabel col-xs-6 pad-remove-loclables" id="dataLabelOperation" ></label>
                                </div>                    
                            </div>
                            <div class="col-xs-6" style="padding-left: 0px;">
                                <div class="row">                                
                                    <div class="col-xs-7" >                                                       
                                        <label class="counterlbl" id="dataLabelScanCounter" >0</label>
                                    </div> 
                                    <div class="col-xs-5" >
                                        <button type="button" id="resetCounterBtn" class="btn btn-primary submitButton" title="Reset" style="width: 26%; padding-top: 17px; margin-top: 27px;">
                                            <span>Reset</span>                            
                                        </button>
                                    </div> 
                                <!--     

                                <div class="row">                    
                                    <label class="control-label col-xs-4">Client IP :</label>
                                    <label class="control-datalabel col-xs-6"id="dataLabelClientIP" ></label>
                                </div> 
                                <div class="row">                    
                                    <label class="control-label col-xs-4">Scan Opt :</label>
                                    <label class="control-datalabel col-xs-6"id="dataLabelScanOpt" ></label>
                                </div> 
                                
                                -->
                                </div>
                            </div>                                                                   
                        </div>
                    </div>
                    <div class="col-xs-6">
                        <div class="row roundCornerGroupBox" style="height: 25vh;" hidden="hidden">                            
                            <div class="row" style="text-align:center;">                   
                                <label class="control-label">Accessible Functions</label>                                    
                            </div>
                            <div id="userpermissionlist" style="height: 12vh; overflow-y: scroll;">

                            </div>                                                    
                        </div>
                    </div> 
                </div>          
            </div>        
        </div>
    </div>

    <div class="row">
        <div class="col-xs-5">
            <label class="bc-funckey-help">F1-Good</label> 
            <label class="bc-funckey-help">F2-Scrap</label>
            <label class="bc-funckey-help">F3-Rework</label> 
            <label class="bc-funckey-help">F5-Add</label> 
            <label class="bc-funckey-help">F6-Reverse</label>
        </div>                        
    </div>

    <div class="row" class="m-2"></div>

    <div class="row" class="m-2" style="margin-right: 15px;" id="pocounterdiv">
        <div id="counterLables" class="roundCornerGroupBox_Scrolabale" hidden="hidden" style="padding-bottom: 12px; display: initial;" >
            <div class="row col-md-12 roundCornerGroupBox_PO_Counter" style="width: 99.7% !important; overflow-y: hidden; overflow-x: auto;">
                <table style="margin-top: 6px; margin-bottom: 16px;">
                    <tbody>
                        <tr id="counerlabelDetails" class="scrolable-field"></tr>
                    </tbody>
                </table>
            </div>     
        </div>
    </div>

    <div class="row" class="m-2"></div>
</div>
<!-- MAIN WINDOW: END-->

<!-- GROUP TAG SEARCH WINDOW: START -->
<div id="groupTagSearchWindow" class="styleSearchWindow" hidden="hidden">
    <input type="text" class="form-control" placeholder="Enter Tag ID" id="groupTagSearchWindowStyleTxt" style="width:25%">
    <br>
    <div id="groupTagSearchGrid">
</div>
<!-- GROUP TAG SEARCH WINDOW: END -->

<!-- TAG SIZE SEARCH WINDOW: START -->
<div id="tagSizeSearchWindow" class="styleSearchWindow" hidden="hidden">
    <input type="text" class="form-control" placeholder="Enter Size" id="tagSizeSearchWindowStyleTxt" style="width:25%">
    <br>
    <div id="tagSizeSearchGrid">
</div>
<!-- TAG SIZE SEARCH WINDOW: END -->

<!-- COLOR SEARCH WINDOW: START-->
<div id="colorSearchWindow" class="colorSearchWindow" hidden="hidden">
    <input type="text" class="form-control" placeholder="Enter Color" id="colorSearchWindowColorTxt" style="width:25%">
    <br>
    <div id="colorSearchGrid">
    </div>
</div>
<!-- COLOR SEARCH WINDOW: END-->

<!--SCRAP REASON SEARCH: START-->
<div id="scrapReasonSearchWindow" class="scrapReasonSearchWindow" hidden="hidden">
    <input type="text" class="form-control" placeholder="Enter Scrap Reason" id="scrapReasonSearchWindowScrapTxt" style="width:25%">
    <br>
    <div id="scrapReasonSearchGrid">
    </div>
</div>
<!--SCRAP REASON SEARCH: END-->

<!-- REWORK REASON SEARCH: START-->
<div id="reworkReasonSearchWindow" class="scrapReasonSearchWindow" hidden="hidden"> 
    <div class="row" style="text-align: left !important;">        
        <div class="col-xs-3"  style="height: 8vh;" >
            <div id="divScrapReason">  
                <div class="row" style="width: 90% !important;">          
                    <label class="control-label control-labell-main" style="color: #f3ecec;  margin-right: 10px">Rework Category : </label>
                    <div class="k-rewor-reason-dd" id="ddlScrapReason"  style="width:60% height: 40vh; font-size: 18px"></div>  
                </div>  
            </div>  
        </div>   
        <div class="col-xs-4">
            <input type="text" class="form-control" placeholder="Enter Rework Reason" id="reworkReasonSearchWindowScrapTxt" style="width:50%">
        </div>
    </div>
    <br>    
    <div id="reworkReasonSearchGrid"></div>
    </div>   
</div>
<!-- REWORK REASON SEARCH: END-->

<!-- DEFECT OPERATION SEARCH WINDOW: START-->
<div id="defectOppSearchWindow" class="scrapReasonSearchWindow" hidden="hidden"> 
    <input type="text" class="form-control" placeholder="Enter Defect Operation" id="defectOppSearchWindowTxt" style="width:50%">            
    <br>           
    <div id="defectOppSearchGrid">            
    </div>     
</div>
<!-- DEFECT OPERATION SEARCH WINDOW: END-->

<!-- PO COUNTER POPUP WINDOW: START-->
<div id="poCounterResetWindow" class="scrapReasonSearchWindow" hidden="hidden">
    <!--Added by NimantaH-->
    <div class="row" style="margin-right: 0px !important;">
        <table style="width: 100%" class="table table-po">
            <thead>
                <tr>
                    <th style="text-align: left" colspan="2" class="th-p">Bag Barcode Counter</th>
                    <th style="text-align: right" class="th-p">Counter ID :</th>
                    <th style="text-align: left"><label id="CounterID" class="th-r"></label></th>
                </tr>
            </thead>
            <tbody>
                <tr hidden="hidden">
                    <td style="text-align: right" class="td-p">Counter Number:</td>
                    <td style="text-align: left" colspan="3" class="td-r"><input type="textarea" id="counterNumber" class="is-valid form-control-t" style="width: 45px; font-size: 30px;" placeholder="Enter Counter Number" style="width: 60px;"></td>
                </tr>
                <tr>
                    <td style="text-align: right" class="td-p">Travel Tag :</td>
                    <td colspan="3" id="TravelTagTxt" style="text-align: left" class="td-r"></td>
                </tr>
                <tr>
                    <td style="text-align: right" class="td-p">Reject Type :</td>
                    <td colspan="3" id="rejectTypeTxt" style="text-align: left" class="td-r"></td>
                </tr>
                <tr>
                    <td style="text-align: right" class="td-p">Reject ID :</td>
                    <td colspan="3" id="rejectIdTxt" style="text-align: left" class="td-r"></td>
                </tr>
                <tr>
                    <td style="text-align: right" class="td-p">Reject Reason :</td>
                    <td colspan="3" id="rejectReasonTxt" style="text-align: left" class="td-r"></td>
                </tr>
                <tr>
                    <td style="text-align: right" class="td-p">Style :</td>
                    <td colspan="3" id="styleTxt" style="text-align: left" class="td-r"></td>
                </tr>
                <tr>
                    <td style="text-align: right" class="td-p">Shedule :</td>
                    <td colspan="3" id="sheduleTxt" style="text-align: left" class="td-r"></td>
                </tr>
                <tr>
                    <td style="text-align: right" class="td-p">PO :</td>
                    <td colspan="3" id="poTxt" style="text-align: left" class="td-r"></td>
                </tr>
                <tr>
                    <td style="text-align: right" class="td-p">Z-Feature :</td>
                    <td colspan="3" id="zFeatureTxt" style="text-align: left" class="td-r"></td>
                </tr>
                <tr>
                    <td style="text-align: right" class="td-p">Color :</td>
                    <td colspan="3" style="text-align: left" class="td-r"><label id="colorTxt"></td>
                </tr>
                <tr id="bagbarcode-row">
                    <td style="text-align: right" class="td-p">Barcode :</td>
                    <td style="text-align: left" colspan="3" class="td-r">
                        <input type="textarea" id="bagBarcodeBcodeTxt" class="is-valid form-control-t" placeholder="Scan bag barcode" style="font-size: 30px; width: 365px;" autofocus>
                    </td>
                </tr>
                <tr id="bagqty-row">
                    <td style="text-align: right" class="td-p">Job Quantity :</td>
                    <td style="text-align: left" colspan="3" class="td-r"><input type="textarea" id="bagSizeTxt" class="is-valid form-control-t" placeholder="Nos" style="width: 60px;"></td>
                </tr>
                <tr>
                    <td style="text-align: right" class="td-p"><label>Current Quantity :</label><label id="currentQuantityNumber" hidden="hidden"></label></td>
                    <td colspan="3" id="currentQuantityTxt" style="text-align: left" class="td-r"></td>
                </tr>
                <tr hidden="hidden">
                    <td style="text-align: right" class="td-p">WIP :</td>
                    <td colspan="3" id="cutQuantityTxt" style="text-align: left" class="td-r"></td>
                </tr>
            </tbody>
        </table>
        <table style="width: 100%" class="table table-po" id="bagcounter-action-buttons">
            <tbody>
                <tr>
                    <td colspan="2" style="text-align: center">
                        <button type="button" id="BAGBtnClear" class="m-2 btn btn-danger width-button" title="Remove" style="font-size: 30px; font-weight: 600;">
                        <span>Close Buddy Tag</span>
                    </td>
                    <td colspan="2" style="text-align: center">
                        <button type="button" id="BAGBtnReset" class="m-2 btn btn-success width-button" title="Done" style="font-size: 30px; font-weight: 600;">
                        <span>Save</span>
                    </td>
                </tr>
                <tr>
                    <td colspan="2" style="text-align: center">
                        <label Style="text-align: center;">ටැගය ඉවත් කිරීමට.</label>
                    </td>
                    <td colspan="2" style="text-align: center">
                        <label Style="text-align: center;">බෑග් තීරු කේත විස්තර සුරකින්න.</label>
                    </td>
                </tr>
            </tbody>
        </table>
        <table style="width: 100%" class="table table-po" id="pocounter-action-buttons">
            <tbody>
                <tr>
                    <td colspan="2" style="text-align: center">
                        <button type="button" id="POBtnClear" class="m-2 btn btn-danger width-button" title="Remove Counter" style="font-size: 30px; font-weight: 600;">
                            <span>Remove Counter</span>
                        </button>
                    </td>
                    <td colspan="2" style="text-align: center">
                        <button type="button" id="POBtnReset" class="m-2 btn btn-success width-button" title="Reset Counter" style="font-size: 30px; font-weight: 600;">
                            <span>Reset Counter</span>
                        </button>
                    </td>
                </tr>
                <tr>
                    <td colspan="2" style="text-align: center">
                        <label Style="text-align: center;">කවුන්ටරය ඉවත් කරන්න.</label>
                    </td>
                    <td colspan="2" style="text-align: center">
                        <label Style="text-align: center;">කවුන්ටරය 0 වෙත නැවත සකසන්න.</label>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
<!-- PO COUNTER POPUP WINDOW: END-->

<!-- SCAN OPTION SELECT: START-->
<div id="prodScanTypeSelectWindow" class="styleSearchWindow" hidden="hidden">
    <div>
        <form class="form cf" style="margin-right: -70px; !Important">
            <section class="plan cf">
                <div id="ScanBulk">
                    <input type="radio" name="radio2" id="scanTypebulk" value="true" onclick="selectProdScanType(1)">
                    <label class="free-label four col" for="scanTypebulk" style="font-size: 30px; height: 100px; padding-top: 26px; border: 3px #ffffff solid;">BULK</label>
                </div>
                <div id="ScanIndividual">
                    <input type="radio" name="radio2" id="scanTypeindividual" value="false" onclick="selectProdScanType(2)">
                    <label class="basic-label four col" for="scanTypeindividual" style="font-size: 30px; height: 100px; padding-top: 26px; border: 3px #ffffff solid;">SCAN</label>
                </div>
            </section>
        </form>
    </div>
    <div>
        <button type="button" id="prodScanTypeOk" onclick="selectProdScanTypeOk()" class="m-2 btn btn-success width-button" style="margin-left: 100px !important; font-size: 30px;" title="Reset Counter">
        <span>OK</span>
        </button>
    </div>
</div> 
<!-- SCAN OPTION SELECT: END-->

<!-- SCAN OPTION SELECT: START-->
<div id="prodValidateScanBarcodeWindow" class="styleSearchWindow" hidden="hidden">
       <div class="row" style="height: 144px;">
           <div class="col-xs-2">
                <label class="col-xs-2 control-label control-label-main" style="width: 100%; color: white; font-size: 30px !important; padding-top: 30px;">Barcode :</label>
            </div>
            <div class="col-xs-5">
                <input type="textarea" id="validateBarcodeBcodeTxt" style="font-size: 45px !important; height: 80px;" class="form-control textbox-barcode" maxlength="24" placeholder="Scan Barcode">
            </div>
            <div class="col-xs-3" hidden="hidden">
                <button type="button" id="tagScanOk" onclick="" class="m-2 btn btn-success width-button" style="    margin-left: 100px !important; font-size: 30px; margin-top: 20px !important; height: 74px;" title="proceed">
                <span>OK</span>
                </button>
            </div>
            <div class="col-xs-3">
                <label id="barcode-count" class="col-xs-2 control-label control-label-main" style="width: 16%; color: #D4E157; font-size: 85px !important; padding-top: 0px; margin-left: 147px; font-weight: 800 !important;"></label>
            </div>
        </div> 
</div> 
<!-- SCAN OPTION SELECT: END-->

<!-- RESYLT VIEW BARCODE FINALIZED: START -->
<div id="finaleResultTable" hidden="hidden">
    <div style="height: 535px; max-height: 535px; overflow: auto; ">
        <div id="finalResultTableData" style="margin-top: 5px; margin-bottom: 5px; width: 980px; height:515px">
        </div>
    </div>
</div>
<!-- RESYLT VIEW BARCODE FINALIZED: END -->

<!--Page Styles: START-->
<Style>
    /* Scroll Bar */
    /* width */
    ::-webkit-scrollbar {
    width: 10px;
    height: 15px;
    margin-bottom: 7px;
    }

    /* Track */
    ::-webkit-scrollbar-track {
    background: #49505700;
    }
    
    /* Handle */
    ::-webkit-scrollbar-thumb {
    background: #888; 
    border-top-left-radius: 8px;
    border-top-right-radius: 8px;
    border-bottom-right-radius: 8px;
    border-bottom-left-radius: 8px;
    }

    /* Handle on hover */
    ::-webkit-scrollbar-thumb:hover {
    background: #555; 
    }

    /* CONTAINERS */

    .four { width: 45.26%; max-width: 45.26%;}


    /* COLUMNS */

    .col {
    display: block;
    float:left;
    margin: 1% 0 1% 1.6%;
    }

    .col:first-of-type { margin-left: 0; }

    /* CLEARFIX */

    .cf:before,
    .cf:after {
        content: " ";
        display: table;
    }

    .cf:after {
        clear: both;
    }

    .cf {
        *zoom: 1;
    }

    /* FORM */

    .form .plan input, .form .payment-plan input, .form .payment-type input{
        display: none;
    }

    .form label{
        position: relative;
        color: #fff;
        background-color: #474444c7;
        font-size: 22px;
        text-align: center;
        height: 50px;
        line-height: 47px;
        display: block;
        cursor: pointer;
        border: 3px solid transparent;
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
    }

    .form .plan input:checked + label, .form .payment-plan input:checked + label, .form .payment-type input:checked + label{
        border: 1px solid #0277BD;
        background-color: #1976D2;
        font-weight: 600;
    }

    .form .plan input:checked + label:after, form .payment-plan input:checked + label:after, .form .payment-type input:checked + label:after{
        content: "\2713";
        width: 40px;
        height: 40px;
        line-height: 40px;
        border-radius: 100%;
        border: 2px solid #333;
        background-color: #2fcc71;
        z-index: 999;
        position: absolute;
        top: -10px;
        right: -10px;
    }

</Style>
<!--Page Styles: END-->